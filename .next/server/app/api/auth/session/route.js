/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/auth/session/route";
exports.ids = ["app/api/auth/session/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/mysql2/lib sync recursive ^cardinal.*$":
/*!****************************************************!*\
  !*** ./node_modules/mysql2/lib/ sync ^cardinal.*$ ***!
  \****************************************************/
/***/ ((module) => {

function webpackEmptyContext(req) {
	var e = new Error("Cannot find module '" + req + "'");
	e.code = 'MODULE_NOT_FOUND';
	throw e;
}
webpackEmptyContext.keys = () => ([]);
webpackEmptyContext.resolve = webpackEmptyContext;
webpackEmptyContext.id = "(rsc)/./node_modules/mysql2/lib sync recursive ^cardinal.*$";
module.exports = webpackEmptyContext;

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("net");

/***/ }),

/***/ "process":
/*!**************************!*\
  !*** external "process" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("process");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "string_decoder":
/*!*********************************!*\
  !*** external "string_decoder" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("string_decoder");

/***/ }),

/***/ "timers":
/*!*************************!*\
  !*** external "timers" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("timers");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2Fsession%2Froute&page=%2Fapi%2Fauth%2Fsession%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fsession%2Froute.ts&appDir=C%3A%5CReactProjects%5Cmedisuite-pro%5Cfrontend%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CReactProjects%5Cmedisuite-pro%5Cfrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2Fsession%2Froute&page=%2Fapi%2Fauth%2Fsession%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fsession%2Froute.ts&appDir=C%3A%5CReactProjects%5Cmedisuite-pro%5Cfrontend%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CReactProjects%5Cmedisuite-pro%5Cfrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_ReactProjects_medisuite_pro_frontend_src_app_api_auth_session_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/auth/session/route.ts */ \"(rsc)/./src/app/api/auth/session/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/auth/session/route\",\n        pathname: \"/api/auth/session\",\n        filename: \"route\",\n        bundlePath: \"app/api/auth/session/route\"\n    },\n    resolvedPagePath: \"C:\\\\ReactProjects\\\\medisuite-pro\\\\frontend\\\\src\\\\app\\\\api\\\\auth\\\\session\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_ReactProjects_medisuite_pro_frontend_src_app_api_auth_session_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/auth/session/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhdXRoJTJGc2Vzc2lvbiUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGYXV0aCUyRnNlc3Npb24lMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZhdXRoJTJGc2Vzc2lvbiUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDUmVhY3RQcm9qZWN0cyU1Q21lZGlzdWl0ZS1wcm8lNUNmcm9udGVuZCU1Q3NyYyU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q1JlYWN0UHJvamVjdHMlNUNtZWRpc3VpdGUtcHJvJTVDZnJvbnRlbmQmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDa0M7QUFDL0c7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSx1R0FBdUc7QUFDL0c7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUM2Sjs7QUFFN0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tZWRpc3VpdGUtcHJvLz82NDRhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkM6XFxcXFJlYWN0UHJvamVjdHNcXFxcbWVkaXN1aXRlLXByb1xcXFxmcm9udGVuZFxcXFxzcmNcXFxcYXBwXFxcXGFwaVxcXFxhdXRoXFxcXHNlc3Npb25cXFxccm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2F1dGgvc2Vzc2lvbi9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2F1dGgvc2Vzc2lvblwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvYXV0aC9zZXNzaW9uL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiQzpcXFxcUmVhY3RQcm9qZWN0c1xcXFxtZWRpc3VpdGUtcHJvXFxcXGZyb250ZW5kXFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXGF1dGhcXFxcc2Vzc2lvblxcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBoZWFkZXJIb29rcywgc3RhdGljR2VuZXJhdGlvbkJhaWxvdXQgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9hdXRoL3Nlc3Npb24vcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0LCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2Fsession%2Froute&page=%2Fapi%2Fauth%2Fsession%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fsession%2Froute.ts&appDir=C%3A%5CReactProjects%5Cmedisuite-pro%5Cfrontend%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CReactProjects%5Cmedisuite-pro%5Cfrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/auth/session/route.ts":
/*!*******************************************!*\
  !*** ./src/app/api/auth/session/route.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/db */ \"(rsc)/./src/lib/db.ts\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./src/lib/auth.ts\");\n// app/api/auth/session/route.ts\n// ‚úÖ Verificaci√≥n de sesi√≥n (JWT) + chequeo en tabla sesiones_usuarios\n// Compatible con Next.js 14 (App Router)\nconst runtime = \"nodejs\";\n\n\n\n// ----------------------------------------\n// Helpers\n// ----------------------------------------\nfunction normalizeRole(s) {\n    return (s || \"\").normalize(\"NFD\").replace(/\\p{Diacritic}/gu, \"\").toLowerCase().trim();\n}\nfunction prettyRole(s) {\n    const n = normalizeRole(s);\n    if (n.includes(\"medico\")) return \"M\\xe9dico\";\n    if (n.includes(\"secretaria\")) return \"Secretaria\";\n    if (n.includes(\"tecnico\")) return \"T\\xe9cnico\";\n    if (n.includes(\"superadmin\")) return \"SuperAdministrador\";\n    if (n.includes(\"administrativo\")) return \"Administrativo\";\n    return s || \"Usuario\";\n}\n// toma token desde cookie o desde Authorization\nfunction getTokenFromRequest(req) {\n    // 1) cookie \"session\"\n    const cookieToken = req.cookies.get(\"session\")?.value;\n    if (cookieToken) return cookieToken;\n    // 2) Authorization: Bearer ...\n    const authLower = req.headers.get(\"authorization\");\n    const authUpper = req.headers.get(\"Authorization\");\n    const auth = authLower || authUpper;\n    if (auth && auth.startsWith(\"Bearer \")) {\n        return auth.slice(7);\n    }\n    return null;\n}\n// ----------------------------------------\n// Handler principal\n// ----------------------------------------\nasync function GET(req) {\n    try {\n        // 1Ô∏è‚É£ leer token de la request\n        const token = getTokenFromRequest(req);\n        if (!token) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"No hay sesi\\xf3n activa\"\n            }, {\n                status: 401\n            });\n        }\n        // 2Ô∏è‚É£ verificar JWT\n        const payload = (0,_lib_auth__WEBPACK_IMPORTED_MODULE_2__.verifyToken)(token);\n        if (!payload) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"Sesi\\xf3n inv\\xe1lida o expirada (token)\"\n            }, {\n                status: 401\n            });\n        }\n        // id dentro del JWT (seg√∫n tu login)\n        const idUsuario = Number(payload.id ?? payload.userId ?? payload.uid);\n        if (!idUsuario) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"Token sin id de usuario\"\n            }, {\n                status: 401\n            });\n        }\n        // 3Ô∏è‚É£ comprobar que esa sesi√≥n est√° viva en tu tabla sesiones_usuarios\n        // (esto lo hicimos en el login nuevo, as√≠ que lo chequeamos aqu√≠ tambi√©n)\n        const [sesRows] = await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`\r\n      SELECT su.id_usuario\r\n      FROM sesiones_usuarios su\r\n      INNER JOIN usuarios u ON u.id_usuario = su.id_usuario\r\n      WHERE su.token = ?\r\n        AND su.activa = 1\r\n        AND su.fecha_expiracion > NOW()\r\n        AND u.estado = 'activo'\r\n      LIMIT 1\r\n      `, [\n            token\n        ]);\n        if (sesRows.length === 0) {\n            // hay token JWT, pero no hay sesi√≥n en tabla ‚Üí la consideramos expirada\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"Sesi\\xf3n inv\\xe1lida o expirada\"\n            }, {\n                status: 401\n            });\n        }\n        // opcional: actualizar √∫ltima actividad\n        await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`UPDATE sesiones_usuarios SET ultima_actividad = NOW() WHERE token = ?`, [\n            token\n        ]);\n        // 4Ô∏è‚É£ Cargar usuario + roles\n        const [rolesUsuario] = await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`\r\n      SELECT\r\n        u.id_usuario,\r\n        u.username,\r\n        u.email,\r\n        u.nombre,\r\n        u.apellido_paterno,\r\n        u.apellido_materno,\r\n        u.foto_perfil_url,\r\n        u.estado,\r\n        r.id_rol,\r\n        r.nombre AS rol_nombre,\r\n        r.nivel_jerarquia\r\n      FROM usuarios u\r\n      INNER JOIN usuarios_roles ur ON ur.id_usuario = u.id_usuario AND ur.activo = 1\r\n      INNER JOIN roles r ON r.id_rol = ur.id_rol AND r.estado = 'activo'\r\n      WHERE u.id_usuario = ? AND u.estado = 'activo'\r\n      ORDER BY\r\n        CASE\r\n          WHEN LOWER(r.nombre) LIKE '%medico%' THEN 1\r\n          WHEN LOWER(r.nombre) LIKE '%super%' THEN 2\r\n          ELSE 3\r\n        END,\r\n        r.nivel_jerarquia DESC\r\n      `, [\n            idUsuario\n        ]);\n        if (rolesUsuario.length === 0) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"Usuario no encontrado o inactivo\"\n            }, {\n                status: 404\n            });\n        }\n        const u = rolesUsuario[0];\n        // 5Ô∏è‚É£ Permisos del rol\n        const [permRows] = await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`\r\n      SELECT p.codigo\r\n      FROM roles_permisos rp\r\n      INNER JOIN permisos p ON p.id_permiso = rp.id_permiso\r\n      WHERE rp.id_rol = ? AND p.estado = 'activo'\r\n      `, [\n            u.id_rol\n        ]);\n        const permisos = permRows.map((p)=>String(p.codigo));\n        const usuarioSesion = {\n            id_usuario: u.id_usuario,\n            username: u.username,\n            email: u.email,\n            nombre: u.nombre,\n            apellido_paterno: u.apellido_paterno,\n            apellido_materno: u.apellido_materno,\n            foto_perfil_url: u.foto_perfil_url,\n            rol: {\n                id_rol: u.id_rol,\n                nombre: prettyRole(u.rol_nombre),\n                nivel_jerarquia: u.nivel_jerarquia,\n                permisos\n            }\n        };\n        // 6Ô∏è‚É£ Si el rol principal es m√©dico ‚Üí anexar info de m√©dico y centro (con plan premium/profesional)\n        if (normalizeRole(u.rol_nombre).includes(\"medico\")) {\n            const [medRows] = await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`\r\n        SELECT\r\n          m.id_medico,\r\n          m.numero_registro_medico,\r\n          m.titulo_profesional,\r\n          m.id_centro_principal,\r\n          cm.nombre AS centro_nombre,\r\n          cm.plan,\r\n          cm.logo_url,\r\n          cm.ciudad,\r\n          cm.region\r\n        FROM medicos m\r\n        LEFT JOIN centros_medicos cm ON cm.id_centro = m.id_centro_principal\r\n        WHERE m.id_usuario = ? AND m.estado IN ('activo', 'habilitado')\r\n        ORDER BY m.id_medico DESC\r\n        LIMIT 1\r\n        `, [\n                idUsuario\n            ]);\n            if (medRows.length > 0) {\n                const med = medRows[0];\n                const [espRows] = await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`\r\n          SELECT e.id_especialidad, e.nombre, me.es_principal\r\n          FROM medicos_especialidades me\r\n          INNER JOIN especialidades e ON e.id_especialidad = me.id_especialidad\r\n          WHERE me.id_medico = ?\r\n          ORDER BY me.es_principal DESC, e.nombre ASC\r\n          `, [\n                    med.id_medico\n                ]);\n                // normalizamos el plan a los que usas en FE\n                const planDb = med.plan || \"basico\";\n                const planNormalizado = planDb === \"premium\" || planDb === \"profesional\" || planDb === \"empresarial\" || planDb === \"basico\" ? planDb : \"basico\";\n                usuarioSesion.medico = {\n                    id_medico: med.id_medico,\n                    numero_registro_medico: med.numero_registro_medico ?? \"SIN-REGISTRO\",\n                    titulo_profesional: med.titulo_profesional ?? \"M\\xe9dico\",\n                    especialidades: espRows.map((e)=>({\n                            id_especialidad: e.id_especialidad,\n                            nombre: e.nombre,\n                            es_principal: Boolean(e.es_principal)\n                        })),\n                    id_centro_principal: med.id_centro_principal ?? 0,\n                    centro_principal: {\n                        id_centro: med.id_centro_principal ?? 0,\n                        nombre: med.centro_nombre ?? \"Centro M\\xe9dico No Asignado\",\n                        plan: planNormalizado,\n                        logo_url: med.logo_url ?? null,\n                        ciudad: med.ciudad ?? \"No definida\",\n                        region: med.region ?? \"No definida\"\n                    }\n                };\n            } else {\n                console.warn(`‚ö†Ô∏è Usuario ${idUsuario} tiene rol M√âDICO pero no registro en tabla 'medicos'.`);\n            }\n        }\n        // 7Ô∏è‚É£ responder\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: true,\n            usuario: usuarioSesion\n        }, {\n            status: 200\n        });\n    } catch (err) {\n        console.error(\"‚ùå Error en GET /api/auth/session:\", err);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: false,\n            error: \"Error interno del servidor\",\n            details:  true ? String(err?.message ?? err) : 0\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RjtRQUVBLGdCQUFnQjtRQUNoQixPQUFPL0Isa0ZBQVlBLENBQUMwQixJQUFJLENBQ3RCO1lBQUVDLFNBQVM7WUFBTXdELFNBQVNuQztRQUFjLEdBQ3hDO1lBQUVuQixRQUFRO1FBQUk7SUFFbEIsRUFBRSxPQUFPdUQsS0FBVTtRQUNqQkgsUUFBUXJELEtBQUssQ0FBQyxxQ0FBcUN3RDtRQUNuRCxPQUFPcEYsa0ZBQVlBLENBQUMwQixJQUFJLENBQ3RCO1lBQ0VDLFNBQVM7WUFDVEMsT0FBTztZQUNQeUQsU0FDRUMsS0FBc0MsR0FDbEN4QyxPQUFPc0MsS0FBS0csV0FBV0gsT0FDdkJJLENBQVNBO1FBQ2pCLEdBQ0E7WUFBRTNELFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbWVkaXN1aXRlLXByby8uL3NyYy9hcHAvYXBpL2F1dGgvc2Vzc2lvbi9yb3V0ZS50cz9jMmI2Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGFwcC9hcGkvYXV0aC9zZXNzaW9uL3JvdXRlLnRzXHJcbi8vIOKchSBWZXJpZmljYWNpw7NuIGRlIHNlc2nDs24gKEpXVCkgKyBjaGVxdWVvIGVuIHRhYmxhIHNlc2lvbmVzX3VzdWFyaW9zXHJcbi8vIENvbXBhdGlibGUgY29uIE5leHQuanMgMTQgKEFwcCBSb3V0ZXIpXHJcblxyXG5leHBvcnQgY29uc3QgcnVudGltZSA9IFwibm9kZWpzXCI7XHJcblxyXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XHJcbmltcG9ydCBwb29sIGZyb20gXCJAL2xpYi9kYlwiO1xyXG5pbXBvcnQgeyBSb3dEYXRhUGFja2V0IH0gZnJvbSBcIm15c3FsMlwiO1xyXG5pbXBvcnQgeyB2ZXJpZnlUb2tlbiB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XHJcblxyXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbi8vIFRpcG9zXHJcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuaW50ZXJmYWNlIFVzdWFyaW9TZXNpb24ge1xyXG4gIGlkX3VzdWFyaW86IG51bWJlcjtcclxuICB1c2VybmFtZTogc3RyaW5nO1xyXG4gIGVtYWlsOiBzdHJpbmc7XHJcbiAgbm9tYnJlOiBzdHJpbmc7XHJcbiAgYXBlbGxpZG9fcGF0ZXJubzogc3RyaW5nO1xyXG4gIGFwZWxsaWRvX21hdGVybm86IHN0cmluZyB8IG51bGw7XHJcbiAgZm90b19wZXJmaWxfdXJsOiBzdHJpbmcgfCBudWxsO1xyXG4gIHJvbDoge1xyXG4gICAgaWRfcm9sOiBudW1iZXI7XHJcbiAgICBub21icmU6IHN0cmluZztcclxuICAgIG5pdmVsX2plcmFycXVpYTogbnVtYmVyO1xyXG4gICAgcGVybWlzb3M6IHN0cmluZ1tdO1xyXG4gIH07XHJcbiAgbWVkaWNvPzoge1xyXG4gICAgaWRfbWVkaWNvOiBudW1iZXI7XHJcbiAgICBudW1lcm9fcmVnaXN0cm9fbWVkaWNvOiBzdHJpbmc7XHJcbiAgICB0aXR1bG9fcHJvZmVzaW9uYWw6IHN0cmluZztcclxuICAgIGVzcGVjaWFsaWRhZGVzOiBBcnJheTx7XHJcbiAgICAgIGlkX2VzcGVjaWFsaWRhZDogbnVtYmVyO1xyXG4gICAgICBub21icmU6IHN0cmluZztcclxuICAgICAgZXNfcHJpbmNpcGFsOiBib29sZWFuO1xyXG4gICAgfT47XHJcbiAgICBpZF9jZW50cm9fcHJpbmNpcGFsOiBudW1iZXI7XHJcbiAgICBjZW50cm9fcHJpbmNpcGFsOiB7XHJcbiAgICAgIGlkX2NlbnRybzogbnVtYmVyO1xyXG4gICAgICBub21icmU6IHN0cmluZztcclxuICAgICAgLy8gYW1wbGlhbW9zIGxvcyBwbGFuZXMgcXVlIHVzYXMgZW4gRkVcclxuICAgICAgcGxhbjogXCJiYXNpY29cIiB8IFwicHJvZmVzaW9uYWxcIiB8IFwicHJlbWl1bVwiIHwgXCJlbXByZXNhcmlhbFwiO1xyXG4gICAgICBsb2dvX3VybDogc3RyaW5nIHwgbnVsbDtcclxuICAgICAgY2l1ZGFkOiBzdHJpbmc7XHJcbiAgICAgIHJlZ2lvbjogc3RyaW5nO1xyXG4gICAgfTtcclxuICB9O1xyXG59XHJcblxyXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbi8vIEhlbHBlcnNcclxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5mdW5jdGlvbiBub3JtYWxpemVSb2xlKHM6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgcmV0dXJuIChzIHx8IFwiXCIpXHJcbiAgICAubm9ybWFsaXplKFwiTkZEXCIpXHJcbiAgICAucmVwbGFjZSgvXFxwe0RpYWNyaXRpY30vZ3UsIFwiXCIpXHJcbiAgICAudG9Mb3dlckNhc2UoKVxyXG4gICAgLnRyaW0oKTtcclxufVxyXG5cclxuZnVuY3Rpb24gcHJldHR5Um9sZShzOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gIGNvbnN0IG4gPSBub3JtYWxpemVSb2xlKHMpO1xyXG4gIGlmIChuLmluY2x1ZGVzKFwibWVkaWNvXCIpKSByZXR1cm4gXCJNw6lkaWNvXCI7XHJcbiAgaWYgKG4uaW5jbHVkZXMoXCJzZWNyZXRhcmlhXCIpKSByZXR1cm4gXCJTZWNyZXRhcmlhXCI7XHJcbiAgaWYgKG4uaW5jbHVkZXMoXCJ0ZWNuaWNvXCIpKSByZXR1cm4gXCJUw6ljbmljb1wiO1xyXG4gIGlmIChuLmluY2x1ZGVzKFwic3VwZXJhZG1pblwiKSkgcmV0dXJuIFwiU3VwZXJBZG1pbmlzdHJhZG9yXCI7XHJcbiAgaWYgKG4uaW5jbHVkZXMoXCJhZG1pbmlzdHJhdGl2b1wiKSkgcmV0dXJuIFwiQWRtaW5pc3RyYXRpdm9cIjtcclxuICByZXR1cm4gcyB8fCBcIlVzdWFyaW9cIjtcclxufVxyXG5cclxuLy8gdG9tYSB0b2tlbiBkZXNkZSBjb29raWUgbyBkZXNkZSBBdXRob3JpemF0aW9uXHJcbmZ1bmN0aW9uIGdldFRva2VuRnJvbVJlcXVlc3QocmVxOiBOZXh0UmVxdWVzdCk6IHN0cmluZyB8IG51bGwge1xyXG4gIC8vIDEpIGNvb2tpZSBcInNlc3Npb25cIlxyXG4gIGNvbnN0IGNvb2tpZVRva2VuID0gcmVxLmNvb2tpZXMuZ2V0KFwic2Vzc2lvblwiKT8udmFsdWU7XHJcbiAgaWYgKGNvb2tpZVRva2VuKSByZXR1cm4gY29va2llVG9rZW47XHJcblxyXG4gIC8vIDIpIEF1dGhvcml6YXRpb246IEJlYXJlciAuLi5cclxuICBjb25zdCBhdXRoTG93ZXIgPSByZXEuaGVhZGVycy5nZXQoXCJhdXRob3JpemF0aW9uXCIpO1xyXG4gIGNvbnN0IGF1dGhVcHBlciA9IHJlcS5oZWFkZXJzLmdldChcIkF1dGhvcml6YXRpb25cIik7XHJcbiAgY29uc3QgYXV0aCA9IGF1dGhMb3dlciB8fCBhdXRoVXBwZXI7XHJcbiAgaWYgKGF1dGggJiYgYXV0aC5zdGFydHNXaXRoKFwiQmVhcmVyIFwiKSkge1xyXG4gICAgcmV0dXJuIGF1dGguc2xpY2UoNyk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gbnVsbDtcclxufVxyXG5cclxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4vLyBIYW5kbGVyIHByaW5jaXBhbFxyXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxOiBOZXh0UmVxdWVzdCkge1xyXG4gIHRyeSB7XHJcbiAgICAvLyAx77iP4oOjIGxlZXIgdG9rZW4gZGUgbGEgcmVxdWVzdFxyXG4gICAgY29uc3QgdG9rZW4gPSBnZXRUb2tlbkZyb21SZXF1ZXN0KHJlcSk7XHJcbiAgICBpZiAoIXRva2VuKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJObyBoYXkgc2VzacOzbiBhY3RpdmFcIiB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIDLvuI/ig6MgdmVyaWZpY2FyIEpXVFxyXG4gICAgY29uc3QgcGF5bG9hZCA9IHZlcmlmeVRva2VuKHRva2VuKTtcclxuICAgIGlmICghcGF5bG9hZCkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiU2VzacOzbiBpbnbDoWxpZGEgbyBleHBpcmFkYSAodG9rZW4pXCIgfSxcclxuICAgICAgICB7IHN0YXR1czogNDAxIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBpZCBkZW50cm8gZGVsIEpXVCAoc2Vnw7puIHR1IGxvZ2luKVxyXG4gICAgY29uc3QgaWRVc3VhcmlvID0gTnVtYmVyKHBheWxvYWQuaWQgPz8gcGF5bG9hZC51c2VySWQgPz8gcGF5bG9hZC51aWQpO1xyXG4gICAgaWYgKCFpZFVzdWFyaW8pIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlRva2VuIHNpbiBpZCBkZSB1c3VhcmlvXCIgfSxcclxuICAgICAgICB7IHN0YXR1czogNDAxIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyAz77iP4oOjIGNvbXByb2JhciBxdWUgZXNhIHNlc2nDs24gZXN0w6Egdml2YSBlbiB0dSB0YWJsYSBzZXNpb25lc191c3Vhcmlvc1xyXG4gICAgLy8gKGVzdG8gbG8gaGljaW1vcyBlbiBlbCBsb2dpbiBudWV2bywgYXPDrSBxdWUgbG8gY2hlcXVlYW1vcyBhcXXDrSB0YW1iacOpbilcclxuICAgIGNvbnN0IFtzZXNSb3dzXSA9IGF3YWl0IHBvb2wucXVlcnk8Um93RGF0YVBhY2tldFtdPihcclxuICAgICAgYFxyXG4gICAgICBTRUxFQ1Qgc3UuaWRfdXN1YXJpb1xyXG4gICAgICBGUk9NIHNlc2lvbmVzX3VzdWFyaW9zIHN1XHJcbiAgICAgIElOTkVSIEpPSU4gdXN1YXJpb3MgdSBPTiB1LmlkX3VzdWFyaW8gPSBzdS5pZF91c3VhcmlvXHJcbiAgICAgIFdIRVJFIHN1LnRva2VuID0gP1xyXG4gICAgICAgIEFORCBzdS5hY3RpdmEgPSAxXHJcbiAgICAgICAgQU5EIHN1LmZlY2hhX2V4cGlyYWNpb24gPiBOT1coKVxyXG4gICAgICAgIEFORCB1LmVzdGFkbyA9ICdhY3Rpdm8nXHJcbiAgICAgIExJTUlUIDFcclxuICAgICAgYCxcclxuICAgICAgW3Rva2VuXVxyXG4gICAgKTtcclxuXHJcbiAgICBpZiAoc2VzUm93cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgLy8gaGF5IHRva2VuIEpXVCwgcGVybyBubyBoYXkgc2VzacOzbiBlbiB0YWJsYSDihpIgbGEgY29uc2lkZXJhbW9zIGV4cGlyYWRhXHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJTZXNpw7NuIGludsOhbGlkYSBvIGV4cGlyYWRhXCIgfSxcclxuICAgICAgICB7IHN0YXR1czogNDAxIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBvcGNpb25hbDogYWN0dWFsaXphciDDumx0aW1hIGFjdGl2aWRhZFxyXG4gICAgYXdhaXQgcG9vbC5xdWVyeShcclxuICAgICAgYFVQREFURSBzZXNpb25lc191c3VhcmlvcyBTRVQgdWx0aW1hX2FjdGl2aWRhZCA9IE5PVygpIFdIRVJFIHRva2VuID0gP2AsXHJcbiAgICAgIFt0b2tlbl1cclxuICAgICk7XHJcblxyXG4gICAgLy8gNO+4j+KDoyBDYXJnYXIgdXN1YXJpbyArIHJvbGVzXHJcbiAgICBjb25zdCBbcm9sZXNVc3VhcmlvXSA9IGF3YWl0IHBvb2wucXVlcnk8Um93RGF0YVBhY2tldFtdPihcclxuICAgICAgYFxyXG4gICAgICBTRUxFQ1RcclxuICAgICAgICB1LmlkX3VzdWFyaW8sXHJcbiAgICAgICAgdS51c2VybmFtZSxcclxuICAgICAgICB1LmVtYWlsLFxyXG4gICAgICAgIHUubm9tYnJlLFxyXG4gICAgICAgIHUuYXBlbGxpZG9fcGF0ZXJubyxcclxuICAgICAgICB1LmFwZWxsaWRvX21hdGVybm8sXHJcbiAgICAgICAgdS5mb3RvX3BlcmZpbF91cmwsXHJcbiAgICAgICAgdS5lc3RhZG8sXHJcbiAgICAgICAgci5pZF9yb2wsXHJcbiAgICAgICAgci5ub21icmUgQVMgcm9sX25vbWJyZSxcclxuICAgICAgICByLm5pdmVsX2plcmFycXVpYVxyXG4gICAgICBGUk9NIHVzdWFyaW9zIHVcclxuICAgICAgSU5ORVIgSk9JTiB1c3Vhcmlvc19yb2xlcyB1ciBPTiB1ci5pZF91c3VhcmlvID0gdS5pZF91c3VhcmlvIEFORCB1ci5hY3Rpdm8gPSAxXHJcbiAgICAgIElOTkVSIEpPSU4gcm9sZXMgciBPTiByLmlkX3JvbCA9IHVyLmlkX3JvbCBBTkQgci5lc3RhZG8gPSAnYWN0aXZvJ1xyXG4gICAgICBXSEVSRSB1LmlkX3VzdWFyaW8gPSA/IEFORCB1LmVzdGFkbyA9ICdhY3Rpdm8nXHJcbiAgICAgIE9SREVSIEJZXHJcbiAgICAgICAgQ0FTRVxyXG4gICAgICAgICAgV0hFTiBMT1dFUihyLm5vbWJyZSkgTElLRSAnJW1lZGljbyUnIFRIRU4gMVxyXG4gICAgICAgICAgV0hFTiBMT1dFUihyLm5vbWJyZSkgTElLRSAnJXN1cGVyJScgVEhFTiAyXHJcbiAgICAgICAgICBFTFNFIDNcclxuICAgICAgICBFTkQsXHJcbiAgICAgICAgci5uaXZlbF9qZXJhcnF1aWEgREVTQ1xyXG4gICAgICBgLFxyXG4gICAgICBbaWRVc3VhcmlvXVxyXG4gICAgKTtcclxuXHJcbiAgICBpZiAocm9sZXNVc3VhcmlvLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVXN1YXJpbyBubyBlbmNvbnRyYWRvIG8gaW5hY3Rpdm9cIiB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDQgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHUgPSByb2xlc1VzdWFyaW9bMF07XHJcblxyXG4gICAgLy8gNe+4j+KDoyBQZXJtaXNvcyBkZWwgcm9sXHJcbiAgICBjb25zdCBbcGVybVJvd3NdID0gYXdhaXQgcG9vbC5xdWVyeTxSb3dEYXRhUGFja2V0W10+KFxyXG4gICAgICBgXHJcbiAgICAgIFNFTEVDVCBwLmNvZGlnb1xyXG4gICAgICBGUk9NIHJvbGVzX3Blcm1pc29zIHJwXHJcbiAgICAgIElOTkVSIEpPSU4gcGVybWlzb3MgcCBPTiBwLmlkX3Blcm1pc28gPSBycC5pZF9wZXJtaXNvXHJcbiAgICAgIFdIRVJFIHJwLmlkX3JvbCA9ID8gQU5EIHAuZXN0YWRvID0gJ2FjdGl2bydcclxuICAgICAgYCxcclxuICAgICAgW3UuaWRfcm9sXVxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBwZXJtaXNvcyA9IHBlcm1Sb3dzLm1hcCgocCkgPT4gU3RyaW5nKHAuY29kaWdvKSk7XHJcblxyXG4gICAgY29uc3QgdXN1YXJpb1Nlc2lvbjogVXN1YXJpb1Nlc2lvbiA9IHtcclxuICAgICAgaWRfdXN1YXJpbzogdS5pZF91c3VhcmlvLFxyXG4gICAgICB1c2VybmFtZTogdS51c2VybmFtZSxcclxuICAgICAgZW1haWw6IHUuZW1haWwsXHJcbiAgICAgIG5vbWJyZTogdS5ub21icmUsXHJcbiAgICAgIGFwZWxsaWRvX3BhdGVybm86IHUuYXBlbGxpZG9fcGF0ZXJubyxcclxuICAgICAgYXBlbGxpZG9fbWF0ZXJubzogdS5hcGVsbGlkb19tYXRlcm5vLFxyXG4gICAgICBmb3RvX3BlcmZpbF91cmw6IHUuZm90b19wZXJmaWxfdXJsLFxyXG4gICAgICByb2w6IHtcclxuICAgICAgICBpZF9yb2w6IHUuaWRfcm9sLFxyXG4gICAgICAgIG5vbWJyZTogcHJldHR5Um9sZSh1LnJvbF9ub21icmUpLFxyXG4gICAgICAgIG5pdmVsX2plcmFycXVpYTogdS5uaXZlbF9qZXJhcnF1aWEsXHJcbiAgICAgICAgcGVybWlzb3MsXHJcbiAgICAgIH0sXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIDbvuI/ig6MgU2kgZWwgcm9sIHByaW5jaXBhbCBlcyBtw6lkaWNvIOKGkiBhbmV4YXIgaW5mbyBkZSBtw6lkaWNvIHkgY2VudHJvIChjb24gcGxhbiBwcmVtaXVtL3Byb2Zlc2lvbmFsKVxyXG4gICAgaWYgKG5vcm1hbGl6ZVJvbGUodS5yb2xfbm9tYnJlKS5pbmNsdWRlcyhcIm1lZGljb1wiKSkge1xyXG4gICAgICBjb25zdCBbbWVkUm93c10gPSBhd2FpdCBwb29sLnF1ZXJ5PFJvd0RhdGFQYWNrZXRbXT4oXHJcbiAgICAgICAgYFxyXG4gICAgICAgIFNFTEVDVFxyXG4gICAgICAgICAgbS5pZF9tZWRpY28sXHJcbiAgICAgICAgICBtLm51bWVyb19yZWdpc3Ryb19tZWRpY28sXHJcbiAgICAgICAgICBtLnRpdHVsb19wcm9mZXNpb25hbCxcclxuICAgICAgICAgIG0uaWRfY2VudHJvX3ByaW5jaXBhbCxcclxuICAgICAgICAgIGNtLm5vbWJyZSBBUyBjZW50cm9fbm9tYnJlLFxyXG4gICAgICAgICAgY20ucGxhbixcclxuICAgICAgICAgIGNtLmxvZ29fdXJsLFxyXG4gICAgICAgICAgY20uY2l1ZGFkLFxyXG4gICAgICAgICAgY20ucmVnaW9uXHJcbiAgICAgICAgRlJPTSBtZWRpY29zIG1cclxuICAgICAgICBMRUZUIEpPSU4gY2VudHJvc19tZWRpY29zIGNtIE9OIGNtLmlkX2NlbnRybyA9IG0uaWRfY2VudHJvX3ByaW5jaXBhbFxyXG4gICAgICAgIFdIRVJFIG0uaWRfdXN1YXJpbyA9ID8gQU5EIG0uZXN0YWRvIElOICgnYWN0aXZvJywgJ2hhYmlsaXRhZG8nKVxyXG4gICAgICAgIE9SREVSIEJZIG0uaWRfbWVkaWNvIERFU0NcclxuICAgICAgICBMSU1JVCAxXHJcbiAgICAgICAgYCxcclxuICAgICAgICBbaWRVc3VhcmlvXVxyXG4gICAgICApO1xyXG5cclxuICAgICAgaWYgKG1lZFJvd3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGNvbnN0IG1lZCA9IG1lZFJvd3NbMF07XHJcblxyXG4gICAgICAgIGNvbnN0IFtlc3BSb3dzXSA9IGF3YWl0IHBvb2wucXVlcnk8Um93RGF0YVBhY2tldFtdPihcclxuICAgICAgICAgIGBcclxuICAgICAgICAgIFNFTEVDVCBlLmlkX2VzcGVjaWFsaWRhZCwgZS5ub21icmUsIG1lLmVzX3ByaW5jaXBhbFxyXG4gICAgICAgICAgRlJPTSBtZWRpY29zX2VzcGVjaWFsaWRhZGVzIG1lXHJcbiAgICAgICAgICBJTk5FUiBKT0lOIGVzcGVjaWFsaWRhZGVzIGUgT04gZS5pZF9lc3BlY2lhbGlkYWQgPSBtZS5pZF9lc3BlY2lhbGlkYWRcclxuICAgICAgICAgIFdIRVJFIG1lLmlkX21lZGljbyA9ID9cclxuICAgICAgICAgIE9SREVSIEJZIG1lLmVzX3ByaW5jaXBhbCBERVNDLCBlLm5vbWJyZSBBU0NcclxuICAgICAgICAgIGAsXHJcbiAgICAgICAgICBbbWVkLmlkX21lZGljb11cclxuICAgICAgICApO1xyXG5cclxuICAgICAgICAvLyBub3JtYWxpemFtb3MgZWwgcGxhbiBhIGxvcyBxdWUgdXNhcyBlbiBGRVxyXG4gICAgICAgIGNvbnN0IHBsYW5EYiA9IChtZWQucGxhbiBhcyBzdHJpbmcpIHx8IFwiYmFzaWNvXCI7XHJcbiAgICAgICAgY29uc3QgcGxhbk5vcm1hbGl6YWRvID1cclxuICAgICAgICAgIHBsYW5EYiA9PT0gXCJwcmVtaXVtXCIgfHxcclxuICAgICAgICAgIHBsYW5EYiA9PT0gXCJwcm9mZXNpb25hbFwiIHx8XHJcbiAgICAgICAgICBwbGFuRGIgPT09IFwiZW1wcmVzYXJpYWxcIiB8fFxyXG4gICAgICAgICAgcGxhbkRiID09PSBcImJhc2ljb1wiXHJcbiAgICAgICAgICAgID8gKHBsYW5EYiBhcyBcImJhc2ljb1wiIHwgXCJwcm9mZXNpb25hbFwiIHwgXCJwcmVtaXVtXCIgfCBcImVtcHJlc2FyaWFsXCIpXHJcbiAgICAgICAgICAgIDogXCJiYXNpY29cIjtcclxuXHJcbiAgICAgICAgdXN1YXJpb1Nlc2lvbi5tZWRpY28gPSB7XHJcbiAgICAgICAgICBpZF9tZWRpY286IG1lZC5pZF9tZWRpY28sXHJcbiAgICAgICAgICBudW1lcm9fcmVnaXN0cm9fbWVkaWNvOiBtZWQubnVtZXJvX3JlZ2lzdHJvX21lZGljbyA/PyBcIlNJTi1SRUdJU1RST1wiLFxyXG4gICAgICAgICAgdGl0dWxvX3Byb2Zlc2lvbmFsOiBtZWQudGl0dWxvX3Byb2Zlc2lvbmFsID8/IFwiTcOpZGljb1wiLFxyXG4gICAgICAgICAgZXNwZWNpYWxpZGFkZXM6IGVzcFJvd3MubWFwKChlKSA9PiAoe1xyXG4gICAgICAgICAgICBpZF9lc3BlY2lhbGlkYWQ6IGUuaWRfZXNwZWNpYWxpZGFkLFxyXG4gICAgICAgICAgICBub21icmU6IGUubm9tYnJlLFxyXG4gICAgICAgICAgICBlc19wcmluY2lwYWw6IEJvb2xlYW4oZS5lc19wcmluY2lwYWwpLFxyXG4gICAgICAgICAgfSkpLFxyXG4gICAgICAgICAgaWRfY2VudHJvX3ByaW5jaXBhbDogbWVkLmlkX2NlbnRyb19wcmluY2lwYWwgPz8gMCxcclxuICAgICAgICAgIGNlbnRyb19wcmluY2lwYWw6IHtcclxuICAgICAgICAgICAgaWRfY2VudHJvOiBtZWQuaWRfY2VudHJvX3ByaW5jaXBhbCA/PyAwLFxyXG4gICAgICAgICAgICBub21icmU6IG1lZC5jZW50cm9fbm9tYnJlID8/IFwiQ2VudHJvIE3DqWRpY28gTm8gQXNpZ25hZG9cIixcclxuICAgICAgICAgICAgcGxhbjogcGxhbk5vcm1hbGl6YWRvLFxyXG4gICAgICAgICAgICBsb2dvX3VybDogbWVkLmxvZ29fdXJsID8/IG51bGwsXHJcbiAgICAgICAgICAgIGNpdWRhZDogbWVkLmNpdWRhZCA/PyBcIk5vIGRlZmluaWRhXCIsXHJcbiAgICAgICAgICAgIHJlZ2lvbjogbWVkLnJlZ2lvbiA/PyBcIk5vIGRlZmluaWRhXCIsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH07XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKFxyXG4gICAgICAgICAgYOKaoO+4jyBVc3VhcmlvICR7aWRVc3VhcmlvfSB0aWVuZSByb2wgTcOJRElDTyBwZXJvIG5vIHJlZ2lzdHJvIGVuIHRhYmxhICdtZWRpY29zJy5gXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIDfvuI/ig6MgcmVzcG9uZGVyXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgIHsgc3VjY2VzczogdHJ1ZSwgdXN1YXJpbzogdXN1YXJpb1Nlc2lvbiB9LFxyXG4gICAgICB7IHN0YXR1czogMjAwIH1cclxuICAgICk7XHJcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgRXJyb3IgZW4gR0VUIC9hcGkvYXV0aC9zZXNzaW9uOlwiLCBlcnIpO1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IFwiRXJyb3IgaW50ZXJubyBkZWwgc2Vydmlkb3JcIixcclxuICAgICAgICBkZXRhaWxzOlxyXG4gICAgICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwiZGV2ZWxvcG1lbnRcIlxyXG4gICAgICAgICAgICA/IFN0cmluZyhlcnI/Lm1lc3NhZ2UgPz8gZXJyKVxyXG4gICAgICAgICAgICA6IHVuZGVmaW5lZCxcclxuICAgICAgfSxcclxuICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsicnVudGltZSIsIk5leHRSZXNwb25zZSIsInBvb2wiLCJ2ZXJpZnlUb2tlbiIsIm5vcm1hbGl6ZVJvbGUiLCJzIiwibm9ybWFsaXplIiwicmVwbGFjZSIsInRvTG93ZXJDYXNlIiwidHJpbSIsInByZXR0eVJvbGUiLCJuIiwiaW5jbHVkZXMiLCJnZXRUb2tlbkZyb21SZXF1ZXN0IiwicmVxIiwiY29va2llVG9rZW4iLCJjb29raWVzIiwiZ2V0IiwidmFsdWUiLCJhdXRoTG93ZXIiLCJoZWFkZXJzIiwiYXV0aFVwcGVyIiwiYXV0aCIsInN0YXJ0c1dpdGgiLCJzbGljZSIsIkdFVCIsInRva2VuIiwianNvbiIsInN1Y2Nlc3MiLCJlcnJvciIsInN0YXR1cyIsInBheWxvYWQiLCJpZFVzdWFyaW8iLCJOdW1iZXIiLCJpZCIsInVzZXJJZCIsInVpZCIsInNlc1Jvd3MiLCJxdWVyeSIsImxlbmd0aCIsInJvbGVzVXN1YXJpbyIsInUiLCJwZXJtUm93cyIsImlkX3JvbCIsInBlcm1pc29zIiwibWFwIiwicCIsIlN0cmluZyIsImNvZGlnbyIsInVzdWFyaW9TZXNpb24iLCJpZF91c3VhcmlvIiwidXNlcm5hbWUiLCJlbWFpbCIsIm5vbWJyZSIsImFwZWxsaWRvX3BhdGVybm8iLCJhcGVsbGlkb19tYXRlcm5vIiwiZm90b19wZXJmaWxfdXJsIiwicm9sIiwicm9sX25vbWJyZSIsIm5pdmVsX2plcmFycXVpYSIsIm1lZFJvd3MiLCJtZWQiLCJlc3BSb3dzIiwiaWRfbWVkaWNvIiwicGxhbkRiIiwicGxhbiIsInBsYW5Ob3JtYWxpemFkbyIsIm1lZGljbyIsIm51bWVyb19yZWdpc3Ryb19tZWRpY28iLCJ0aXR1bG9fcHJvZmVzaW9uYWwiLCJlc3BlY2lhbGlkYWRlcyIsImUiLCJpZF9lc3BlY2lhbGlkYWQiLCJlc19wcmluY2lwYWwiLCJCb29sZWFuIiwiaWRfY2VudHJvX3ByaW5jaXBhbCIsImNlbnRyb19wcmluY2lwYWwiLCJpZF9jZW50cm8iLCJjZW50cm9fbm9tYnJlIiwibG9nb191cmwiLCJjaXVkYWQiLCJyZWdpb24iLCJjb25zb2xlIiwid2FybiIsInVzdWFyaW8iLCJlcnIiLCJkZXRhaWxzIiwicHJvY2VzcyIsIm1lc3NhZ2UiLCJ1bmRlZmluZWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/auth/session/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   decodeToken: () => (/* binding */ decodeToken),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   refreshSession: () => (/* binding */ refreshSession),\n/* harmony export */   signSession: () => (/* binding */ signSession),\n/* harmony export */   verifyPassword: () => (/* binding */ verifyPassword),\n/* harmony export */   verifyToken: () => (/* binding */ verifyToken)\n/* harmony export */ });\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! bcryptjs */ \"(rsc)/./node_modules/bcryptjs/index.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jsonwebtoken */ \"(rsc)/./node_modules/jsonwebtoken/index.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__);\n// frontend\\src\\lib\\auth.ts\n// üîê M√≥dulo de Autenticaci√≥n - MediSuite Pro\n// ============================================================\n// Compatibilidad total con Next.js 14 App Router\n// Integra bcryptjs para contrase√±as y JWT para sesiones\n// ============================================================\n\n\n// ============================================================\n// üîß Clave secreta JWT (usa variable de entorno en producci√≥n)\n// ============================================================\nconst JWT_SECRET = process.env.JWT_SECRET || \"clave-ultra-secreta-dev\";\n// ============================================================\n// ‚úÖ Funci√≥n: verificar contrase√±a con bcrypt\n// ============================================================\nasync function verifyPassword(plainPassword, hashedPassword) {\n    try {\n        if (!plainPassword || !hashedPassword) return false;\n        // Si est√° en modo de prueba y no se us√≥ hash, comparar directamente\n        if (!hashedPassword.startsWith(\"$2\")) {\n            return plainPassword === hashedPassword;\n        }\n        // Comparaci√≥n segura con bcrypt\n        return await bcryptjs__WEBPACK_IMPORTED_MODULE_0__[\"default\"].compare(plainPassword, hashedPassword);\n    } catch (err) {\n        console.error(\"‚ùå Error al verificar contrase\\xf1a:\", err);\n        return false;\n    }\n}\n// ============================================================\n// ‚úÖ Funci√≥n: generar token de sesi√≥n JWT\n// ============================================================\nfunction signSession(payload) {\n    try {\n        // Firmar token con expiraci√≥n de 8 horas\n        return jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().sign(payload, JWT_SECRET, {\n            expiresIn: \"8h\"\n        });\n    } catch (err) {\n        console.error(\"‚ùå Error al firmar token JWT:\", err);\n        throw new Error(\"No se pudo generar el token JWT\");\n    }\n}\n// ============================================================\n// ‚úÖ Funci√≥n: verificar token JWT\n// ============================================================\nfunction verifyToken(token) {\n    try {\n        if (!token) return null;\n        return jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().verify(token, JWT_SECRET);\n    } catch (err) {\n        console.error(\"‚ö†Ô∏è Token inv\\xe1lido o expirado:\", err);\n        return null;\n    }\n}\n// ============================================================\n// ‚úÖ Funci√≥n: decodificar token sin verificar (solo lectura r√°pida)\n// ============================================================\nfunction decodeToken(token) {\n    try {\n        if (!token) return null;\n        return jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().decode(token);\n    } catch (err) {\n        console.error(\"‚ö†Ô∏è Error al decodificar token:\", err);\n        return null;\n    }\n}\n// ============================================================\n// üîÅ Funci√≥n: refrescar token cuando est√° por expirar\n// ============================================================\nfunction refreshSession(token) {\n    try {\n        const decoded = verifyToken(token);\n        if (!decoded) return null;\n        const { iat, exp, ...payload } = decoded;\n        return signSession(payload);\n    } catch (err) {\n        console.error(\"‚ö†Ô∏è No se pudo refrescar el token:\", err);\n        return null;\n    }\n}\n// ============================================================\n// üß© Exportaci√≥n por defecto\n// ============================================================\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({\n    verifyPassword,\n    signSession,\n    verifyToken,\n    decodeToken,\n    refreshSession\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2F1dGgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUEsMkJBQTJCO0FBQzNCLDZDQUE2QztBQUM3QywrREFBK0Q7QUFDL0QsaURBQWlEO0FBQ2pELHdEQUF3RDtBQUN4RCwrREFBK0Q7QUFFakM7QUFDaUI7QUFFL0MsK0RBQStEO0FBQy9ELCtEQUErRDtBQUMvRCwrREFBK0Q7QUFDL0QsTUFBTUUsYUFBYUMsUUFBUUMsR0FBRyxDQUFDRixVQUFVLElBQUk7QUFFN0MsK0RBQStEO0FBQy9ELDZDQUE2QztBQUM3QywrREFBK0Q7QUFDeEQsZUFBZUcsZUFDcEJDLGFBQXFCLEVBQ3JCQyxjQUFzQjtJQUV0QixJQUFJO1FBQ0YsSUFBSSxDQUFDRCxpQkFBaUIsQ0FBQ0MsZ0JBQWdCLE9BQU87UUFFOUMsb0VBQW9FO1FBQ3BFLElBQUksQ0FBQ0EsZUFBZUMsVUFBVSxDQUFDLE9BQU87WUFDcEMsT0FBT0Ysa0JBQWtCQztRQUMzQjtRQUVBLGdDQUFnQztRQUNoQyxPQUFPLE1BQU1QLHdEQUFjLENBQUNNLGVBQWVDO0lBQzdDLEVBQUUsT0FBT0csS0FBSztRQUNaQyxRQUFRQyxLQUFLLENBQUMsdUNBQW9DRjtRQUNsRCxPQUFPO0lBQ1Q7QUFDRjtBQUVBLCtEQUErRDtBQUMvRCx5Q0FBeUM7QUFDekMsK0RBQStEO0FBQ3hELFNBQVNHLFlBQVlDLE9BQTRCO0lBQ3RELElBQUk7UUFDRix5Q0FBeUM7UUFDekMsT0FBT2Isd0RBQVEsQ0FBQ2EsU0FBU1osWUFBWTtZQUFFYyxXQUFXO1FBQUs7SUFDekQsRUFBRSxPQUFPTixLQUFLO1FBQ1pDLFFBQVFDLEtBQUssQ0FBQyxnQ0FBZ0NGO1FBQzlDLE1BQU0sSUFBSU8sTUFBTTtJQUNsQjtBQUNGO0FBRUEsK0RBQStEO0FBQy9ELGlDQUFpQztBQUNqQywrREFBK0Q7QUFDeEQsU0FBU0MsWUFBWUMsS0FBYTtJQUN2QyxJQUFJO1FBQ0YsSUFBSSxDQUFDQSxPQUFPLE9BQU87UUFDbkIsT0FBT2xCLDBEQUFVLENBQUNrQixPQUFPakI7SUFDM0IsRUFBRSxPQUFPUSxLQUFLO1FBQ1pDLFFBQVFDLEtBQUssQ0FBQyxvQ0FBaUNGO1FBQy9DLE9BQU87SUFDVDtBQUNGO0FBRUEsK0RBQStEO0FBQy9ELG1FQUFtRTtBQUNuRSwrREFBK0Q7QUFDeEQsU0FBU1csWUFBWUYsS0FBYTtJQUN2QyxJQUFJO1FBQ0YsSUFBSSxDQUFDQSxPQUFPLE9BQU87UUFDbkIsT0FBT2xCLDBEQUFVLENBQUNrQjtJQUNwQixFQUFFLE9BQU9ULEtBQUs7UUFDWkMsUUFBUUMsS0FBSyxDQUFDLGtDQUFrQ0Y7UUFDaEQsT0FBTztJQUNUO0FBQ0Y7QUFFQSwrREFBK0Q7QUFDL0Qsc0RBQXNEO0FBQ3RELCtEQUErRDtBQUN4RCxTQUFTYSxlQUFlSixLQUFhO0lBQzFDLElBQUk7UUFDRixNQUFNSyxVQUFVTixZQUFZQztRQUM1QixJQUFJLENBQUNLLFNBQVMsT0FBTztRQUVyQixNQUFNLEVBQUVDLEdBQUcsRUFBRUMsR0FBRyxFQUFFLEdBQUdaLFNBQVMsR0FBR1U7UUFDakMsT0FBT1gsWUFBWUM7SUFDckIsRUFBRSxPQUFPSixLQUFLO1FBQ1pDLFFBQVFDLEtBQUssQ0FBQyxxQ0FBcUNGO1FBQ25ELE9BQU87SUFDVDtBQUNGO0FBRUEsK0RBQStEO0FBQy9ELDZCQUE2QjtBQUM3QiwrREFBK0Q7QUFDL0QsaUVBQWU7SUFDYkw7SUFDQVE7SUFDQUs7SUFDQUc7SUFDQUU7QUFDRixDQUFDLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tZWRpc3VpdGUtcHJvLy4vc3JjL2xpYi9hdXRoLnRzPzY2OTIiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gZnJvbnRlbmRcXHNyY1xcbGliXFxhdXRoLnRzXHJcbi8vIPCflJAgTcOzZHVsbyBkZSBBdXRlbnRpY2FjacOzbiAtIE1lZGlTdWl0ZSBQcm9cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIENvbXBhdGliaWxpZGFkIHRvdGFsIGNvbiBOZXh0LmpzIDE0IEFwcCBSb3V0ZXJcclxuLy8gSW50ZWdyYSBiY3J5cHRqcyBwYXJhIGNvbnRyYXNlw7FhcyB5IEpXVCBwYXJhIHNlc2lvbmVzXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuaW1wb3J0IGJjcnlwdCBmcm9tIFwiYmNyeXB0anNcIjtcclxuaW1wb3J0IGp3dCwgeyBKd3RQYXlsb2FkIH0gZnJvbSBcImpzb253ZWJ0b2tlblwiO1xyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIPCflKcgQ2xhdmUgc2VjcmV0YSBKV1QgKHVzYSB2YXJpYWJsZSBkZSBlbnRvcm5vIGVuIHByb2R1Y2Npw7NuKVxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuY29uc3QgSldUX1NFQ1JFVCA9IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgXCJjbGF2ZS11bHRyYS1zZWNyZXRhLWRldlwiO1xyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIOKchSBGdW5jacOzbjogdmVyaWZpY2FyIGNvbnRyYXNlw7FhIGNvbiBiY3J5cHRcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlQYXNzd29yZChcclxuICBwbGFpblBhc3N3b3JkOiBzdHJpbmcsXHJcbiAgaGFzaGVkUGFzc3dvcmQ6IHN0cmluZ1xyXG4pOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICB0cnkge1xyXG4gICAgaWYgKCFwbGFpblBhc3N3b3JkIHx8ICFoYXNoZWRQYXNzd29yZCkgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgIC8vIFNpIGVzdMOhIGVuIG1vZG8gZGUgcHJ1ZWJhIHkgbm8gc2UgdXPDsyBoYXNoLCBjb21wYXJhciBkaXJlY3RhbWVudGVcclxuICAgIGlmICghaGFzaGVkUGFzc3dvcmQuc3RhcnRzV2l0aChcIiQyXCIpKSB7XHJcbiAgICAgIHJldHVybiBwbGFpblBhc3N3b3JkID09PSBoYXNoZWRQYXNzd29yZDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDb21wYXJhY2nDs24gc2VndXJhIGNvbiBiY3J5cHRcclxuICAgIHJldHVybiBhd2FpdCBiY3J5cHQuY29tcGFyZShwbGFpblBhc3N3b3JkLCBoYXNoZWRQYXNzd29yZCk7XHJcbiAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwi4p2MIEVycm9yIGFsIHZlcmlmaWNhciBjb250cmFzZcOxYTpcIiwgZXJyKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbn1cclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyDinIUgRnVuY2nDs246IGdlbmVyYXIgdG9rZW4gZGUgc2VzacOzbiBKV1RcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbmV4cG9ydCBmdW5jdGlvbiBzaWduU2Vzc2lvbihwYXlsb2FkOiBSZWNvcmQ8c3RyaW5nLCBhbnk+KTogc3RyaW5nIHtcclxuICB0cnkge1xyXG4gICAgLy8gRmlybWFyIHRva2VuIGNvbiBleHBpcmFjacOzbiBkZSA4IGhvcmFzXHJcbiAgICByZXR1cm4gand0LnNpZ24ocGF5bG9hZCwgSldUX1NFQ1JFVCwgeyBleHBpcmVzSW46IFwiOGhcIiB9KTtcclxuICB9IGNhdGNoIChlcnIpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgRXJyb3IgYWwgZmlybWFyIHRva2VuIEpXVDpcIiwgZXJyKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIk5vIHNlIHB1ZG8gZ2VuZXJhciBlbCB0b2tlbiBKV1RcIik7XHJcbiAgfVxyXG59XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8g4pyFIEZ1bmNpw7NuOiB2ZXJpZmljYXIgdG9rZW4gSldUXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5leHBvcnQgZnVuY3Rpb24gdmVyaWZ5VG9rZW4odG9rZW46IHN0cmluZyk6IEp3dFBheWxvYWQgfCBudWxsIHtcclxuICB0cnkge1xyXG4gICAgaWYgKCF0b2tlbikgcmV0dXJuIG51bGw7XHJcbiAgICByZXR1cm4gand0LnZlcmlmeSh0b2tlbiwgSldUX1NFQ1JFVCkgYXMgSnd0UGF5bG9hZDtcclxuICB9IGNhdGNoIChlcnIpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCLimqDvuI8gVG9rZW4gaW52w6FsaWRvIG8gZXhwaXJhZG86XCIsIGVycik7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyDinIUgRnVuY2nDs246IGRlY29kaWZpY2FyIHRva2VuIHNpbiB2ZXJpZmljYXIgKHNvbG8gbGVjdHVyYSByw6FwaWRhKVxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuZXhwb3J0IGZ1bmN0aW9uIGRlY29kZVRva2VuKHRva2VuOiBzdHJpbmcpOiBKd3RQYXlsb2FkIHwgbnVsbCB7XHJcbiAgdHJ5IHtcclxuICAgIGlmICghdG9rZW4pIHJldHVybiBudWxsO1xyXG4gICAgcmV0dXJuIGp3dC5kZWNvZGUodG9rZW4pIGFzIEp3dFBheWxvYWQ7XHJcbiAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwi4pqg77iPIEVycm9yIGFsIGRlY29kaWZpY2FyIHRva2VuOlwiLCBlcnIpO1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG59XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8g8J+UgSBGdW5jacOzbjogcmVmcmVzY2FyIHRva2VuIGN1YW5kbyBlc3TDoSBwb3IgZXhwaXJhclxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuZXhwb3J0IGZ1bmN0aW9uIHJlZnJlc2hTZXNzaW9uKHRva2VuOiBzdHJpbmcpOiBzdHJpbmcgfCBudWxsIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgZGVjb2RlZCA9IHZlcmlmeVRva2VuKHRva2VuKTtcclxuICAgIGlmICghZGVjb2RlZCkgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgY29uc3QgeyBpYXQsIGV4cCwgLi4ucGF5bG9hZCB9ID0gZGVjb2RlZDtcclxuICAgIHJldHVybiBzaWduU2Vzc2lvbihwYXlsb2FkKTtcclxuICB9IGNhdGNoIChlcnIpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCLimqDvuI8gTm8gc2UgcHVkbyByZWZyZXNjYXIgZWwgdG9rZW46XCIsIGVycik7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyDwn6epIEV4cG9ydGFjacOzbiBwb3IgZGVmZWN0b1xyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuZXhwb3J0IGRlZmF1bHQge1xyXG4gIHZlcmlmeVBhc3N3b3JkLFxyXG4gIHNpZ25TZXNzaW9uLFxyXG4gIHZlcmlmeVRva2VuLFxyXG4gIGRlY29kZVRva2VuLFxyXG4gIHJlZnJlc2hTZXNzaW9uLFxyXG59O1xyXG4iXSwibmFtZXMiOlsiYmNyeXB0Iiwiand0IiwiSldUX1NFQ1JFVCIsInByb2Nlc3MiLCJlbnYiLCJ2ZXJpZnlQYXNzd29yZCIsInBsYWluUGFzc3dvcmQiLCJoYXNoZWRQYXNzd29yZCIsInN0YXJ0c1dpdGgiLCJjb21wYXJlIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwic2lnblNlc3Npb24iLCJwYXlsb2FkIiwic2lnbiIsImV4cGlyZXNJbiIsIkVycm9yIiwidmVyaWZ5VG9rZW4iLCJ0b2tlbiIsInZlcmlmeSIsImRlY29kZVRva2VuIiwiZGVjb2RlIiwicmVmcmVzaFNlc3Npb24iLCJkZWNvZGVkIiwiaWF0IiwiZXhwIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/db.ts":
/*!***********************!*\
  !*** ./src/lib/db.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   getConnection: () => (/* binding */ getConnection),\n/* harmony export */   getGlobalStats: () => (/* binding */ getGlobalStats),\n/* harmony export */   getUserByEmail: () => (/* binding */ getUserByEmail),\n/* harmony export */   query: () => (/* binding */ query),\n/* harmony export */   verifyUserCredentials: () => (/* binding */ verifyUserCredentials),\n/* harmony export */   withTransaction: () => (/* binding */ withTransaction)\n/* harmony export */ });\n/* harmony import */ var mysql2_promise__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mysql2/promise */ \"(rsc)/./node_modules/mysql2/promise.js\");\n// ===============================================================\n// üì¶ Archivo: src/lib/db.ts\n// üß† Descripci√≥n: Configuraci√≥n central de conexi√≥n a MySQL y utilidades\n// ===============================================================\n\n// ===============================================================\n// üîó Conexi√≥n al pool MySQL (segura, reutilizable y escalable)\n// ===============================================================\nconst pool = mysql2_promise__WEBPACK_IMPORTED_MODULE_0__.createPool({\n    host: process.env.DB_HOST || \"localhost\",\n    user: process.env.DB_USER || \"root\",\n    password: process.env.DB_PASS || \"\",\n    database: process.env.DB_NAME || \"Anyssamed\",\n    waitForConnections: true,\n    connectionLimit: 10,\n    queueLimit: 0,\n    multipleStatements: false,\n    namedPlaceholders: true\n});\n// ===============================================================\n// üß© Funci√≥n gen√©rica para ejecutar consultas seguras\n// ===============================================================\nasync function query(sql, params = []) {\n    try {\n        const [rows] = await pool.query(sql, params);\n        return rows;\n    } catch (error) {\n        console.error(\"‚ùå Error en query MySQL:\", error.message);\n        throw new Error(`Error en consulta: ${error.message}`);\n    }\n}\n// ===============================================================\n// üë§ Obtener usuario por email o username (para login o validaciones)\n// ‚úÖ Versi√≥n que PRIORIZA el rol M√âDICO y solo toma roles activos\n// ===============================================================\nasync function getUserByEmail(emailOrUsername) {\n    const sql = `\r\n    SELECT \r\n      u.id_usuario,\r\n      u.email,\r\n      u.username,\r\n      u.nombre,\r\n      u.apellido_paterno,\r\n      u.password_hash,\r\n      -- si no hay rol, devolvemos 'Sin Rol'\r\n      COALESCE(r.nombre, 'Sin Rol') AS rol\r\n    FROM usuarios u\r\n    -- solo roles activos del usuario\r\n    LEFT JOIN usuarios_roles ur \r\n      ON u.id_usuario = ur.id_usuario\r\n      AND ur.activo = 1\r\n    -- solo roles activos en la tabla roles\r\n    LEFT JOIN roles r \r\n      ON ur.id_rol = r.id_rol\r\n      AND r.estado = 'activo'\r\n    WHERE (u.email = ? OR u.username = ?)\r\n      AND u.estado = 'activo'\r\n    -- PRIORIDAD de rol:\r\n    -- 1) m√©dico\r\n    -- 2) superadmin\r\n    -- 3) admin/administrativo\r\n    -- 4) secretaria\r\n    -- 5) t√©cnico\r\n    -- 6) lo que quede\r\n    ORDER BY\r\n      CASE\r\n        WHEN LOWER(r.nombre) LIKE '%medico%' THEN 1\r\n        WHEN LOWER(r.nombre) LIKE '%super%' THEN 2\r\n        WHEN LOWER(r.nombre) LIKE '%admin%' THEN 3\r\n        WHEN LOWER(r.nombre) LIKE '%secret%' THEN 4\r\n        WHEN LOWER(r.nombre) LIKE '%tecnic%' THEN 5\r\n        ELSE 99\r\n      END,\r\n      r.nivel_jerarquia DESC\r\n    LIMIT 1\r\n  `;\n    const [rows] = await pool.query(sql, [\n        emailOrUsername,\n        emailOrUsername\n    ]);\n    return Array.isArray(rows) && rows.length > 0 ? rows[0] : null;\n}\n// ===============================================================\n// üîí Verificar credenciales del usuario\n// ===============================================================\nasync function verifyUserCredentials(emailOrUsername, passwordHash) {\n    const user = await getUserByEmail(emailOrUsername);\n    if (!user) return null;\n    if (user.password_hash !== passwordHash) return null;\n    return user;\n}\n// ===============================================================\n// üìä Ejemplo de utilidad: obtener estad√≠sticas globales\n// ===============================================================\nasync function getGlobalStats() {\n    const [[stats]] = await pool.query(`\r\n    SELECT \r\n      (SELECT COUNT(*) FROM usuarios) AS total_usuarios,\r\n      (SELECT COUNT(*) FROM pacientes) AS total_pacientes,\r\n      (SELECT COUNT(*) FROM medicos) AS total_medicos,\r\n      (SELECT COUNT(*) FROM centros_medicos) AS total_centros\r\n  `);\n    return stats;\n}\n// ===============================================================\n// üîå NUEVO: obtener una conexi√≥n dedicada (para transacciones)\n// ===============================================================\nasync function getConnection() {\n    const conn = await pool.getConnection();\n    try {\n        await conn.ping(); // valida la conexi√≥n\n    } catch (e) {\n        conn.release();\n        throw e;\n    }\n    return conn;\n}\n// ===============================================================\n// üîÅ NUEVO (opcional): helper para ejecutar en transacci√≥n\n// ===============================================================\nasync function withTransaction(fn) {\n    const conn = await getConnection();\n    try {\n        await conn.beginTransaction();\n        const result = await fn(conn);\n        await conn.commit();\n        return result;\n    } catch (err) {\n        try {\n            await conn.rollback();\n        } catch  {}\n        throw err;\n    } finally{\n        try {\n            conn.release();\n        } catch  {}\n    }\n}\n// ===============================================================\n// üîÅ Exportar conexi√≥n global\n// ===============================================================\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (pool);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VSxRQUFRO1FBQUksRUFBRSxPQUFNLENBQUM7UUFDdEMsTUFBTUQ7SUFDUixTQUFVO1FBQ1IsSUFBSTtZQUFFVCxLQUFLRyxPQUFPO1FBQUksRUFBRSxPQUFNLENBQUM7SUFDakM7QUFDRjtBQUVBLGtFQUFrRTtBQUNsRSw4QkFBOEI7QUFDOUIsa0VBQWtFO0FBQ2xFLGlFQUFldkMsSUFBSUEsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL21lZGlzdWl0ZS1wcm8vLi9zcmMvbGliL2RiLnRzPzllNGYiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIPCfk6YgQXJjaGl2bzogc3JjL2xpYi9kYi50c1xyXG4vLyDwn6egIERlc2NyaXBjacOzbjogQ29uZmlndXJhY2nDs24gY2VudHJhbCBkZSBjb25leGnDs24gYSBNeVNRTCB5IHV0aWxpZGFkZXNcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5pbXBvcnQgbXlzcWwgZnJvbSBcIm15c3FsMi9wcm9taXNlXCI7XHJcbmltcG9ydCB0eXBlIHsgUG9vbENvbm5lY3Rpb24gfSBmcm9tIFwibXlzcWwyL3Byb21pc2VcIjsgLy8g4oaQIChzb2xvIHRpcG8pXHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8g8J+UlyBDb25leGnDs24gYWwgcG9vbCBNeVNRTCAoc2VndXJhLCByZXV0aWxpemFibGUgeSBlc2NhbGFibGUpXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5jb25zdCBwb29sID0gbXlzcWwuY3JlYXRlUG9vbCh7XHJcbiAgaG9zdDogcHJvY2Vzcy5lbnYuREJfSE9TVCB8fCBcImxvY2FsaG9zdFwiLFxyXG4gIHVzZXI6IHByb2Nlc3MuZW52LkRCX1VTRVIgfHwgXCJyb290XCIsXHJcbiAgcGFzc3dvcmQ6IHByb2Nlc3MuZW52LkRCX1BBU1MgfHwgXCJcIixcclxuICBkYXRhYmFzZTogcHJvY2Vzcy5lbnYuREJfTkFNRSB8fCBcIkFueXNzYW1lZFwiLFxyXG4gIHdhaXRGb3JDb25uZWN0aW9uczogdHJ1ZSxcclxuICBjb25uZWN0aW9uTGltaXQ6IDEwLFxyXG4gIHF1ZXVlTGltaXQ6IDAsXHJcbiAgbXVsdGlwbGVTdGF0ZW1lbnRzOiBmYWxzZSxcclxuICBuYW1lZFBsYWNlaG9sZGVyczogdHJ1ZSxcclxufSk7XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8g8J+nqSBGdW5jacOzbiBnZW7DqXJpY2EgcGFyYSBlamVjdXRhciBjb25zdWx0YXMgc2VndXJhc1xyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHF1ZXJ5KHNxbDogc3RyaW5nLCBwYXJhbXM6IGFueVtdID0gW10pIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgW3Jvd3NdID0gYXdhaXQgcG9vbC5xdWVyeShzcWwsIHBhcmFtcyk7XHJcbiAgICByZXR1cm4gcm93cztcclxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwi4p2MIEVycm9yIGVuIHF1ZXJ5IE15U1FMOlwiLCBlcnJvci5tZXNzYWdlKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3IgZW4gY29uc3VsdGE6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICB9XHJcbn1cclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyDwn5GkIE9idGVuZXIgdXN1YXJpbyBwb3IgZW1haWwgbyB1c2VybmFtZSAocGFyYSBsb2dpbiBvIHZhbGlkYWNpb25lcylcclxuLy8g4pyFIFZlcnNpw7NuIHF1ZSBQUklPUklaQSBlbCByb2wgTcOJRElDTyB5IHNvbG8gdG9tYSByb2xlcyBhY3Rpdm9zXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VXNlckJ5RW1haWwoZW1haWxPclVzZXJuYW1lOiBzdHJpbmcpIHtcclxuICBjb25zdCBzcWwgPSBgXHJcbiAgICBTRUxFQ1QgXHJcbiAgICAgIHUuaWRfdXN1YXJpbyxcclxuICAgICAgdS5lbWFpbCxcclxuICAgICAgdS51c2VybmFtZSxcclxuICAgICAgdS5ub21icmUsXHJcbiAgICAgIHUuYXBlbGxpZG9fcGF0ZXJubyxcclxuICAgICAgdS5wYXNzd29yZF9oYXNoLFxyXG4gICAgICAtLSBzaSBubyBoYXkgcm9sLCBkZXZvbHZlbW9zICdTaW4gUm9sJ1xyXG4gICAgICBDT0FMRVNDRShyLm5vbWJyZSwgJ1NpbiBSb2wnKSBBUyByb2xcclxuICAgIEZST00gdXN1YXJpb3MgdVxyXG4gICAgLS0gc29sbyByb2xlcyBhY3Rpdm9zIGRlbCB1c3VhcmlvXHJcbiAgICBMRUZUIEpPSU4gdXN1YXJpb3Nfcm9sZXMgdXIgXHJcbiAgICAgIE9OIHUuaWRfdXN1YXJpbyA9IHVyLmlkX3VzdWFyaW9cclxuICAgICAgQU5EIHVyLmFjdGl2byA9IDFcclxuICAgIC0tIHNvbG8gcm9sZXMgYWN0aXZvcyBlbiBsYSB0YWJsYSByb2xlc1xyXG4gICAgTEVGVCBKT0lOIHJvbGVzIHIgXHJcbiAgICAgIE9OIHVyLmlkX3JvbCA9IHIuaWRfcm9sXHJcbiAgICAgIEFORCByLmVzdGFkbyA9ICdhY3Rpdm8nXHJcbiAgICBXSEVSRSAodS5lbWFpbCA9ID8gT1IgdS51c2VybmFtZSA9ID8pXHJcbiAgICAgIEFORCB1LmVzdGFkbyA9ICdhY3Rpdm8nXHJcbiAgICAtLSBQUklPUklEQUQgZGUgcm9sOlxyXG4gICAgLS0gMSkgbcOpZGljb1xyXG4gICAgLS0gMikgc3VwZXJhZG1pblxyXG4gICAgLS0gMykgYWRtaW4vYWRtaW5pc3RyYXRpdm9cclxuICAgIC0tIDQpIHNlY3JldGFyaWFcclxuICAgIC0tIDUpIHTDqWNuaWNvXHJcbiAgICAtLSA2KSBsbyBxdWUgcXVlZGVcclxuICAgIE9SREVSIEJZXHJcbiAgICAgIENBU0VcclxuICAgICAgICBXSEVOIExPV0VSKHIubm9tYnJlKSBMSUtFICclbWVkaWNvJScgVEhFTiAxXHJcbiAgICAgICAgV0hFTiBMT1dFUihyLm5vbWJyZSkgTElLRSAnJXN1cGVyJScgVEhFTiAyXHJcbiAgICAgICAgV0hFTiBMT1dFUihyLm5vbWJyZSkgTElLRSAnJWFkbWluJScgVEhFTiAzXHJcbiAgICAgICAgV0hFTiBMT1dFUihyLm5vbWJyZSkgTElLRSAnJXNlY3JldCUnIFRIRU4gNFxyXG4gICAgICAgIFdIRU4gTE9XRVIoci5ub21icmUpIExJS0UgJyV0ZWNuaWMlJyBUSEVOIDVcclxuICAgICAgICBFTFNFIDk5XHJcbiAgICAgIEVORCxcclxuICAgICAgci5uaXZlbF9qZXJhcnF1aWEgREVTQ1xyXG4gICAgTElNSVQgMVxyXG4gIGA7XHJcbiAgY29uc3QgW3Jvd3NdOiBhbnkgPSBhd2FpdCBwb29sLnF1ZXJ5KHNxbCwgW2VtYWlsT3JVc2VybmFtZSwgZW1haWxPclVzZXJuYW1lXSk7XHJcbiAgcmV0dXJuIEFycmF5LmlzQXJyYXkocm93cykgJiYgcm93cy5sZW5ndGggPiAwID8gcm93c1swXSA6IG51bGw7XHJcbn1cclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyDwn5SSIFZlcmlmaWNhciBjcmVkZW5jaWFsZXMgZGVsIHVzdWFyaW9cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlVc2VyQ3JlZGVudGlhbHMoZW1haWxPclVzZXJuYW1lOiBzdHJpbmcsIHBhc3N3b3JkSGFzaDogc3RyaW5nKSB7XHJcbiAgY29uc3QgdXNlciA9IGF3YWl0IGdldFVzZXJCeUVtYWlsKGVtYWlsT3JVc2VybmFtZSk7XHJcbiAgaWYgKCF1c2VyKSByZXR1cm4gbnVsbDtcclxuICBpZiAodXNlci5wYXNzd29yZF9oYXNoICE9PSBwYXNzd29yZEhhc2gpIHJldHVybiBudWxsO1xyXG4gIHJldHVybiB1c2VyO1xyXG59XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8g8J+TiiBFamVtcGxvIGRlIHV0aWxpZGFkOiBvYnRlbmVyIGVzdGFkw61zdGljYXMgZ2xvYmFsZXNcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRHbG9iYWxTdGF0cygpIHtcclxuICBjb25zdCBbW3N0YXRzXV06IGFueSA9IGF3YWl0IHBvb2wucXVlcnkoYFxyXG4gICAgU0VMRUNUIFxyXG4gICAgICAoU0VMRUNUIENPVU5UKCopIEZST00gdXN1YXJpb3MpIEFTIHRvdGFsX3VzdWFyaW9zLFxyXG4gICAgICAoU0VMRUNUIENPVU5UKCopIEZST00gcGFjaWVudGVzKSBBUyB0b3RhbF9wYWNpZW50ZXMsXHJcbiAgICAgIChTRUxFQ1QgQ09VTlQoKikgRlJPTSBtZWRpY29zKSBBUyB0b3RhbF9tZWRpY29zLFxyXG4gICAgICAoU0VMRUNUIENPVU5UKCopIEZST00gY2VudHJvc19tZWRpY29zKSBBUyB0b3RhbF9jZW50cm9zXHJcbiAgYCk7XHJcbiAgcmV0dXJuIHN0YXRzO1xyXG59XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8g8J+UjCBOVUVWTzogb2J0ZW5lciB1bmEgY29uZXhpw7NuIGRlZGljYWRhIChwYXJhIHRyYW5zYWNjaW9uZXMpXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29ubmVjdGlvbigpOiBQcm9taXNlPFBvb2xDb25uZWN0aW9uPiB7XHJcbiAgY29uc3QgY29ubiA9IGF3YWl0IHBvb2wuZ2V0Q29ubmVjdGlvbigpO1xyXG4gIHRyeSB7XHJcbiAgICBhd2FpdCBjb25uLnBpbmcoKTsgLy8gdmFsaWRhIGxhIGNvbmV4acOzblxyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIGNvbm4ucmVsZWFzZSgpO1xyXG4gICAgdGhyb3cgZTtcclxuICB9XHJcbiAgcmV0dXJuIGNvbm47XHJcbn1cclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyDwn5SBIE5VRVZPIChvcGNpb25hbCk6IGhlbHBlciBwYXJhIGVqZWN1dGFyIGVuIHRyYW5zYWNjacOzblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHdpdGhUcmFuc2FjdGlvbjxUPihcclxuICBmbjogKGNvbm46IFBvb2xDb25uZWN0aW9uKSA9PiBQcm9taXNlPFQ+XHJcbik6IFByb21pc2U8VD4ge1xyXG4gIGNvbnN0IGNvbm4gPSBhd2FpdCBnZXRDb25uZWN0aW9uKCk7XHJcbiAgdHJ5IHtcclxuICAgIGF3YWl0IGNvbm4uYmVnaW5UcmFuc2FjdGlvbigpO1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZm4oY29ubik7XHJcbiAgICBhd2FpdCBjb25uLmNvbW1pdCgpO1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9IGNhdGNoIChlcnIpIHtcclxuICAgIHRyeSB7IGF3YWl0IGNvbm4ucm9sbGJhY2soKTsgfSBjYXRjaCB7fVxyXG4gICAgdGhyb3cgZXJyO1xyXG4gIH0gZmluYWxseSB7XHJcbiAgICB0cnkgeyBjb25uLnJlbGVhc2UoKTsgfSBjYXRjaCB7fVxyXG4gIH1cclxufVxyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIPCflIEgRXhwb3J0YXIgY29uZXhpw7NuIGdsb2JhbFxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuZXhwb3J0IGRlZmF1bHQgcG9vbDtcclxuXHJcbi8vIChvcGNpb25hbCkgcmUtZXhwb3J0IGRlbCB0aXBvIHBhcmEgdXNhcmxvIGVuIHJ1dGFzIHNpIHF1aWVyZXMgdGlwYXIgcGFyw6FtZXRyb3NcclxuZXhwb3J0IHR5cGUgeyBQb29sQ29ubmVjdGlvbiB9O1xyXG4iXSwibmFtZXMiOlsibXlzcWwiLCJwb29sIiwiY3JlYXRlUG9vbCIsImhvc3QiLCJwcm9jZXNzIiwiZW52IiwiREJfSE9TVCIsInVzZXIiLCJEQl9VU0VSIiwicGFzc3dvcmQiLCJEQl9QQVNTIiwiZGF0YWJhc2UiLCJEQl9OQU1FIiwid2FpdEZvckNvbm5lY3Rpb25zIiwiY29ubmVjdGlvbkxpbWl0IiwicXVldWVMaW1pdCIsIm11bHRpcGxlU3RhdGVtZW50cyIsIm5hbWVkUGxhY2Vob2xkZXJzIiwicXVlcnkiLCJzcWwiLCJwYXJhbXMiLCJyb3dzIiwiZXJyb3IiLCJjb25zb2xlIiwibWVzc2FnZSIsIkVycm9yIiwiZ2V0VXNlckJ5RW1haWwiLCJlbWFpbE9yVXNlcm5hbWUiLCJBcnJheSIsImlzQXJyYXkiLCJsZW5ndGgiLCJ2ZXJpZnlVc2VyQ3JlZGVudGlhbHMiLCJwYXNzd29yZEhhc2giLCJwYXNzd29yZF9oYXNoIiwiZ2V0R2xvYmFsU3RhdHMiLCJzdGF0cyIsImdldENvbm5lY3Rpb24iLCJjb25uIiwicGluZyIsImUiLCJyZWxlYXNlIiwid2l0aFRyYW5zYWN0aW9uIiwiZm4iLCJiZWdpblRyYW5zYWN0aW9uIiwicmVzdWx0IiwiY29tbWl0IiwiZXJyIiwicm9sbGJhY2siXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/db.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/mysql2","vendor-chunks/iconv-lite","vendor-chunks/aws-ssl-profiles","vendor-chunks/long","vendor-chunks/named-placeholders","vendor-chunks/denque","vendor-chunks/is-property","vendor-chunks/lru.min","vendor-chunks/sqlstring","vendor-chunks/seq-queue","vendor-chunks/generate-function","vendor-chunks/safer-buffer","vendor-chunks/semver","vendor-chunks/jsonwebtoken","vendor-chunks/jws","vendor-chunks/ecdsa-sig-formatter","vendor-chunks/bcryptjs","vendor-chunks/safe-buffer","vendor-chunks/ms","vendor-chunks/lodash.once","vendor-chunks/lodash.isstring","vendor-chunks/lodash.isplainobject","vendor-chunks/lodash.isnumber","vendor-chunks/lodash.isinteger","vendor-chunks/lodash.isboolean","vendor-chunks/lodash.includes","vendor-chunks/jwa","vendor-chunks/buffer-equal-constant-time"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2Fsession%2Froute&page=%2Fapi%2Fauth%2Fsession%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fsession%2Froute.ts&appDir=C%3A%5CReactProjects%5Cmedisuite-pro%5Cfrontend%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CReactProjects%5Cmedisuite-pro%5Cfrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();