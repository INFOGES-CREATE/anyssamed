/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/medico/agenda/route";
exports.ids = ["app/api/medico/agenda/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/mysql2/lib sync recursive ^cardinal.*$":
/*!****************************************************!*\
  !*** ./node_modules/mysql2/lib/ sync ^cardinal.*$ ***!
  \****************************************************/
/***/ ((module) => {

function webpackEmptyContext(req) {
	var e = new Error("Cannot find module '" + req + "'");
	e.code = 'MODULE_NOT_FOUND';
	throw e;
}
webpackEmptyContext.keys = () => ([]);
webpackEmptyContext.resolve = webpackEmptyContext;
webpackEmptyContext.id = "(rsc)/./node_modules/mysql2/lib sync recursive ^cardinal.*$";
module.exports = webpackEmptyContext;

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("net");

/***/ }),

/***/ "process":
/*!**************************!*\
  !*** external "process" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("process");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "string_decoder":
/*!*********************************!*\
  !*** external "string_decoder" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("string_decoder");

/***/ }),

/***/ "timers":
/*!*************************!*\
  !*** external "timers" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("timers");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fmedico%2Fagenda%2Froute&page=%2Fapi%2Fmedico%2Fagenda%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmedico%2Fagenda%2Froute.ts&appDir=C%3A%5CReactProjects%5Cmedisuite-pro%5Cfrontend%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CReactProjects%5Cmedisuite-pro%5Cfrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fmedico%2Fagenda%2Froute&page=%2Fapi%2Fmedico%2Fagenda%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmedico%2Fagenda%2Froute.ts&appDir=C%3A%5CReactProjects%5Cmedisuite-pro%5Cfrontend%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CReactProjects%5Cmedisuite-pro%5Cfrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_ReactProjects_medisuite_pro_frontend_src_app_api_medico_agenda_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/medico/agenda/route.ts */ \"(rsc)/./src/app/api/medico/agenda/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/medico/agenda/route\",\n        pathname: \"/api/medico/agenda\",\n        filename: \"route\",\n        bundlePath: \"app/api/medico/agenda/route\"\n    },\n    resolvedPagePath: \"C:\\\\ReactProjects\\\\medisuite-pro\\\\frontend\\\\src\\\\app\\\\api\\\\medico\\\\agenda\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_ReactProjects_medisuite_pro_frontend_src_app_api_medico_agenda_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/medico/agenda/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZtZWRpY28lMkZhZ2VuZGElMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRm1lZGljbyUyRmFnZW5kYSUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRm1lZGljbyUyRmFnZW5kYSUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDUmVhY3RQcm9qZWN0cyU1Q21lZGlzdWl0ZS1wcm8lNUNmcm9udGVuZCU1Q3NyYyU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q1JlYWN0UHJvamVjdHMlNUNtZWRpc3VpdGUtcHJvJTVDZnJvbnRlbmQmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDbUM7QUFDaEg7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSx1R0FBdUc7QUFDL0c7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUM2Sjs7QUFFN0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tZWRpc3VpdGUtcHJvLz9iYjIzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkM6XFxcXFJlYWN0UHJvamVjdHNcXFxcbWVkaXN1aXRlLXByb1xcXFxmcm9udGVuZFxcXFxzcmNcXFxcYXBwXFxcXGFwaVxcXFxtZWRpY29cXFxcYWdlbmRhXFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9tZWRpY28vYWdlbmRhL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvbWVkaWNvL2FnZW5kYVwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvbWVkaWNvL2FnZW5kYS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXFJlYWN0UHJvamVjdHNcXFxcbWVkaXN1aXRlLXByb1xcXFxmcm9udGVuZFxcXFxzcmNcXFxcYXBwXFxcXGFwaVxcXFxtZWRpY29cXFxcYWdlbmRhXFxcXHJvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL21lZGljby9hZ2VuZGEvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0LCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fmedico%2Fagenda%2Froute&page=%2Fapi%2Fmedico%2Fagenda%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmedico%2Fagenda%2Froute.ts&appDir=C%3A%5CReactProjects%5Cmedisuite-pro%5Cfrontend%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CReactProjects%5Cmedisuite-pro%5Cfrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/medico/agenda/route.ts":
/*!********************************************!*\
  !*** ./src/app/api/medico/agenda/route.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DELETE: () => (/* binding */ DELETE),\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   PUT: () => (/* binding */ PUT)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/db */ \"(rsc)/./src/lib/db.ts\");\n// app/api/medico/agenda/route.ts\n\n\n// ========================================\n// HELPER PARA OBTENER EL TOKEN\n// ========================================\nconst SESSION_COOKIE_CANDIDATES = [\n    \"session\",\n    \"session_token\",\n    \"medisalud_session\",\n    \"auth_session\",\n    \"next-auth.session-token\",\n    \"__Secure-next-auth.session-token\"\n];\nfunction getSessionToken(request) {\n    const cookieHeader = request.headers.get(\"cookie\") || \"\";\n    if (cookieHeader) {\n        const cookies = cookieHeader.split(\";\").map((c)=>c.trim()).filter(Boolean).reduce((acc, c)=>{\n            const [k, ...rest] = c.split(\"=\");\n            acc[k] = rest.join(\"=\");\n            return acc;\n        }, {});\n        for (const name of SESSION_COOKIE_CANDIDATES){\n            if (cookies[name]) {\n                return decodeURIComponent(cookies[name]);\n            }\n        }\n    }\n    const auth = request.headers.get(\"authorization\");\n    if (auth?.startsWith(\"Bearer \")) {\n        return auth.slice(7);\n    }\n    return null;\n}\n// ========================================\n// FUNCIONES AUXILIARES\n// ========================================\n/**\r\n * Obtiene la información del médico autenticado\r\n */ async function obtenerMedicoAutenticado(idUsuario) {\n    try {\n        const [rows] = await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`\r\n      SELECT \r\n        m.id_medico,\r\n        m.id_usuario,\r\n        m.id_centro_principal\r\n      FROM medicos m\r\n      WHERE m.id_usuario = ? AND m.estado = 'activo'\r\n      LIMIT 1\r\n      `, [\n            idUsuario\n        ]);\n        if (rows.length === 0) {\n            return null;\n        }\n        return rows[0];\n    } catch (error) {\n        console.error(\"Error al obtener m\\xe9dico:\", error);\n        throw error;\n    }\n}\n/**\r\n * Obtiene las citas del médico según filtros\r\n */ async function obtenerCitas(idMedico, fechaInicio, fechaFin, estados, tipos, paciente) {\n    try {\n        let query = `\r\n      SELECT \r\n        c.id_cita,\r\n        c.id_paciente,\r\n        c.id_medico,\r\n        c.id_centro,\r\n        c.id_sucursal,\r\n        c.fecha_hora_inicio,\r\n        c.fecha_hora_fin,\r\n        c.duracion_minutos,\r\n        c.tipo_cita,\r\n        c.motivo,\r\n        c.estado,\r\n        c.prioridad,\r\n        c.id_especialidad,\r\n        c.origen,\r\n        c.pagada,\r\n        c.monto,\r\n        c.id_sala,\r\n        c.notas,\r\n        c.notas_privadas,\r\n        c.recordatorio_enviado,\r\n        c.fecha_recordatorio,\r\n        c.confirmacion_enviada,\r\n        c.fecha_confirmacion,\r\n        c.confirmado_por_paciente,\r\n        \r\n        -- Datos del paciente\r\n        p.id_paciente,\r\n        CONCAT(p.nombre, ' ', p.apellido_paterno, ' ', COALESCE(p.apellido_materno, '')) as paciente_nombre_completo,\r\n        TIMESTAMPDIFF(YEAR, p.fecha_nacimiento, CURDATE()) as paciente_edad,\r\n        p.genero as paciente_genero,\r\n        p.telefono as paciente_telefono,\r\n        p.email as paciente_email,\r\n        p.foto_url as paciente_foto_url,\r\n        p.grupo_sanguineo as paciente_grupo_sanguineo,\r\n        \r\n        -- Contar alergias críticas\r\n        (\r\n          SELECT COUNT(*)\r\n          FROM alergias\r\n          WHERE id_paciente = p.id_paciente\r\n            AND estado = 'activa'\r\n            AND severidad IN ('severa', 'fatal')\r\n        ) as paciente_alergias_criticas,\r\n        \r\n        -- Datos de la sala\r\n        s.id_sala,\r\n        s.nombre as sala_nombre,\r\n        s.tipo as sala_tipo,\r\n        \r\n        -- Datos de la especialidad\r\n        e.id_especialidad,\r\n        e.nombre as especialidad_nombre\r\n        \r\n      FROM citas c\r\n      INNER JOIN pacientes p ON c.id_paciente = p.id_paciente\r\n      LEFT JOIN salas s ON c.id_sala = s.id_sala\r\n      LEFT JOIN especialidades e ON c.id_especialidad = e.id_especialidad\r\n      WHERE c.id_medico = ?\r\n        AND DATE(c.fecha_hora_inicio) BETWEEN ? AND ?\r\n    `;\n        const params = [\n            idMedico,\n            fechaInicio,\n            fechaFin\n        ];\n        // Filtro por estados\n        if (estados && estados.length > 0) {\n            query += ` AND c.estado IN (${estados.map(()=>\"?\").join(\",\")})`;\n            params.push(...estados);\n        }\n        // Filtro por tipos\n        if (tipos && tipos.length > 0) {\n            query += ` AND c.tipo_cita IN (${tipos.map(()=>\"?\").join(\",\")})`;\n            params.push(...tipos);\n        }\n        // Filtro por paciente\n        if (paciente && paciente.trim()) {\n            query += ` AND (\r\n        CONCAT(p.nombre, ' ', p.apellido_paterno, ' ', COALESCE(p.apellido_materno, '')) LIKE ?\r\n        OR p.rut LIKE ?\r\n        OR p.email LIKE ?\r\n      )`;\n            const searchTerm = `%${paciente}%`;\n            params.push(searchTerm, searchTerm, searchTerm);\n        }\n        query += ` ORDER BY c.fecha_hora_inicio ASC`;\n        const [rows] = await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(query, params);\n        // Formatear los resultados\n        return rows.map((row)=>({\n                id_cita: row.id_cita,\n                id_paciente: row.id_paciente,\n                id_medico: row.id_medico,\n                id_centro: row.id_centro,\n                id_sucursal: row.id_sucursal,\n                fecha_hora_inicio: row.fecha_hora_inicio,\n                fecha_hora_fin: row.fecha_hora_fin,\n                duracion_minutos: row.duracion_minutos,\n                tipo_cita: row.tipo_cita,\n                motivo: row.motivo,\n                estado: row.estado,\n                prioridad: row.prioridad,\n                id_especialidad: row.id_especialidad,\n                origen: row.origen,\n                pagada: row.pagada === 1,\n                monto: row.monto,\n                id_sala: row.id_sala,\n                notas: row.notas,\n                notas_privadas: row.notas_privadas,\n                recordatorio_enviado: row.recordatorio_enviado === 1,\n                fecha_recordatorio: row.fecha_recordatorio,\n                confirmacion_enviada: row.confirmacion_enviada === 1,\n                fecha_confirmacion: row.fecha_confirmacion,\n                confirmado_por_paciente: row.confirmado_por_paciente === 1,\n                paciente: {\n                    id_paciente: row.id_paciente,\n                    nombre_completo: row.paciente_nombre_completo,\n                    edad: row.paciente_edad,\n                    genero: row.paciente_genero,\n                    telefono: row.paciente_telefono,\n                    email: row.paciente_email,\n                    foto_url: row.paciente_foto_url,\n                    grupo_sanguineo: row.paciente_grupo_sanguineo || \"N/A\",\n                    alergias_criticas: row.paciente_alergias_criticas\n                },\n                sala: row.id_sala ? {\n                    id_sala: row.id_sala,\n                    nombre: row.sala_nombre,\n                    tipo: row.sala_tipo\n                } : null,\n                especialidad: row.id_especialidad ? {\n                    id_especialidad: row.id_especialidad,\n                    nombre: row.especialidad_nombre\n                } : null\n            }));\n    } catch (error) {\n        console.error(\"Error al obtener citas:\", error);\n        throw error;\n    }\n}\n/**\r\n * Obtiene los bloques horarios del médico\r\n */ async function obtenerBloquesHorarios(idMedico, fechaInicio, fechaFin) {\n    try {\n        const [rows] = await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`\r\n      SELECT \r\n        b.id_bloque,\r\n        b.id_medico,\r\n        b.fecha_inicio,\r\n        b.fecha_fin,\r\n        b.duracion_minutos,\r\n        b.estado,\r\n        b.tipo_atencion,\r\n        b.id_sala,\r\n        b.cupo_maximo,\r\n        b.cupo_actual,\r\n        b.visible_web,\r\n        s.nombre as sala_nombre\r\n      FROM bloques_horarios b\r\n      LEFT JOIN salas s ON b.id_sala = s.id_sala\r\n      WHERE b.id_medico = ?\r\n        AND DATE(b.fecha_inicio) BETWEEN ? AND ?\r\n      ORDER BY b.fecha_inicio ASC\r\n      `, [\n            idMedico,\n            fechaInicio,\n            fechaFin\n        ]);\n        return rows.map((row)=>({\n                id_bloque: row.id_bloque,\n                id_medico: row.id_medico,\n                fecha_inicio: row.fecha_inicio,\n                fecha_fin: row.fecha_fin,\n                duracion_minutos: row.duracion_minutos,\n                estado: row.estado,\n                tipo_atencion: row.tipo_atencion,\n                id_sala: row.id_sala,\n                cupo_maximo: row.cupo_maximo,\n                cupo_actual: row.cupo_actual,\n                visible_web: row.visible_web === 1,\n                sala_nombre: row.sala_nombre\n            }));\n    } catch (error) {\n        console.error(\"Error al obtener bloques horarios:\", error);\n        throw error;\n    }\n}\n/**\r\n * Calcula las estadísticas de la agenda\r\n */ async function calcularEstadisticas(idMedico, fechaInicio, fechaFin) {\n    try {\n        const [estadisticas] = await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`\r\n      SELECT \r\n        COUNT(*) as total_citas,\r\n        SUM(CASE WHEN estado = 'confirmada' THEN 1 ELSE 0 END) as confirmadas,\r\n        SUM(CASE WHEN estado IN ('programada', 'pendiente') THEN 1 ELSE 0 END) as pendientes,\r\n        SUM(CASE WHEN estado = 'completada' THEN 1 ELSE 0 END) as completadas,\r\n        SUM(CASE WHEN estado = 'cancelada' THEN 1 ELSE 0 END) as canceladas,\r\n        SUM(CASE WHEN estado = 'no_asistio' THEN 1 ELSE 0 END) as no_asistio,\r\n        SUM(CASE WHEN estado = 'en_sala_espera' THEN 1 ELSE 0 END) as en_sala_espera,\r\n        SUM(CASE WHEN confirmado_por_paciente = 1 THEN 1 ELSE 0 END) as total_confirmadas,\r\n        AVG(duracion_minutos) as duracion_promedio,\r\n        SUM(duracion_minutos) / 60 as horas_agendadas,\r\n        SUM(CASE WHEN pagada = 1 THEN monto ELSE 0 END) as ingresos_reales,\r\n        SUM(monto) as ingresos_estimados\r\n      FROM citas\r\n      WHERE id_medico = ?\r\n        AND DATE(fecha_hora_inicio) BETWEEN ? AND ?\r\n      `, [\n            idMedico,\n            fechaInicio,\n            fechaFin\n        ]);\n        const stats = estadisticas[0];\n        // Calcular horas disponibles (8 horas por día hábil)\n        const diasHabiles = calcularDiasHabiles(fechaInicio, fechaFin);\n        const horas_disponibles = diasHabiles * 8;\n        // Calcular tasas\n        const tasa_asistencia = stats.total_citas > 0 ? stats.completadas / stats.total_citas * 100 : 0;\n        const tasa_confirmacion = stats.total_citas > 0 ? stats.total_confirmadas / stats.total_citas * 100 : 0;\n        const ocupacion = horas_disponibles > 0 ? stats.horas_agendadas / horas_disponibles * 100 : 0;\n        return {\n            total_citas: stats.total_citas || 0,\n            confirmadas: stats.confirmadas || 0,\n            pendientes: stats.pendientes || 0,\n            completadas: stats.completadas || 0,\n            canceladas: stats.canceladas || 0,\n            no_asistio: stats.no_asistio || 0,\n            en_sala_espera: stats.en_sala_espera || 0,\n            tasa_asistencia: parseFloat(tasa_asistencia.toFixed(2)),\n            tasa_confirmacion: parseFloat(tasa_confirmacion.toFixed(2)),\n            duracion_promedio: parseFloat((stats.duracion_promedio || 0).toFixed(2)),\n            tiempo_promedio_espera: 0,\n            horas_agendadas: parseFloat((stats.horas_agendadas || 0).toFixed(2)),\n            horas_disponibles: horas_disponibles,\n            ocupacion: parseFloat(ocupacion.toFixed(2)),\n            ingresos_estimados: parseFloat(stats.ingresos_estimados || 0),\n            ingresos_reales: parseFloat(stats.ingresos_reales || 0)\n        };\n    } catch (error) {\n        console.error(\"Error al calcular estad\\xedsticas:\", error);\n        throw error;\n    }\n}\n/**\r\n * Calcula días hábiles entre dos fechas\r\n */ function calcularDiasHabiles(fechaInicio, fechaFin) {\n    const inicio = new Date(fechaInicio);\n    const fin = new Date(fechaFin);\n    let dias = 0;\n    for(let d = new Date(inicio); d <= fin; d.setDate(d.getDate() + 1)){\n        const diaSemana = d.getDay();\n        if (diaSemana !== 0 && diaSemana !== 6) {\n            // No es domingo ni sábado\n            dias++;\n        }\n    }\n    return dias;\n}\n/**\r\n * Valida disponibilidad para una nueva cita\r\n */ async function validarDisponibilidad(idMedico, fechaInicio, fechaFin, idCitaExcluir) {\n    try {\n        let query = `\r\n      SELECT COUNT(*) as conflictos\r\n      FROM citas\r\n      WHERE id_medico = ?\r\n        AND estado NOT IN ('cancelada', 'no_asistio')\r\n        AND (\r\n          (fecha_hora_inicio <= ? AND fecha_hora_fin > ?)\r\n          OR (fecha_hora_inicio < ? AND fecha_hora_fin >= ?)\r\n          OR (fecha_hora_inicio >= ? AND fecha_hora_fin <= ?)\r\n        )\r\n    `;\n        const params = [\n            idMedico,\n            fechaInicio,\n            fechaInicio,\n            fechaFin,\n            fechaFin,\n            fechaInicio,\n            fechaFin\n        ];\n        if (idCitaExcluir) {\n            query += ` AND id_cita != ?`;\n            params.push(idCitaExcluir);\n        }\n        const [rows] = await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(query, params);\n        return rows[0].conflictos === 0;\n    } catch (error) {\n        console.error(\"Error al validar disponibilidad:\", error);\n        throw error;\n    }\n}\n// ========================================\n// HANDLER GET - Obtener citas\n// ========================================\nasync function GET(request) {\n    try {\n        // 1. Obtener token\n        const sessionToken = getSessionToken(request);\n        if (!sessionToken) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"No hay sesi\\xf3n activa\"\n            }, {\n                status: 401\n            });\n        }\n        // 2. Verificar sesión\n        const [sesiones] = await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`\r\n      SELECT su.id_usuario\r\n      FROM sesiones_usuarios su\r\n      INNER JOIN usuarios u ON su.id_usuario = u.id_usuario\r\n      WHERE su.token = ?\r\n        AND su.activa = 1\r\n        AND su.fecha_expiracion > NOW()\r\n        AND u.estado = 'activo'\r\n      LIMIT 1\r\n      `, [\n            sessionToken\n        ]);\n        if (sesiones.length === 0) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"Sesi\\xf3n inv\\xe1lida o expirada\"\n            }, {\n                status: 401\n            });\n        }\n        const idUsuario = sesiones[0].id_usuario;\n        // 3. Verificar que sea médico\n        const medico = await obtenerMedicoAutenticado(idUsuario);\n        if (!medico) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"No tienes un registro de m\\xe9dico activo\"\n            }, {\n                status: 403\n            });\n        }\n        // 4. Obtener parámetros de consulta\n        const searchParams = request.nextUrl.searchParams;\n        const fechaInicio = searchParams.get(\"fecha_inicio\") || new Date().toISOString().split(\"T\")[0];\n        const fechaFin = searchParams.get(\"fecha_fin\") || new Date().toISOString().split(\"T\")[0];\n        const estados = searchParams.get(\"estados\")?.split(\",\");\n        const tipos = searchParams.get(\"tipos\")?.split(\",\");\n        const paciente = searchParams.get(\"paciente\") || \"\";\n        // 5. Actualizar última actividad\n        await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`UPDATE sesiones_usuarios SET ultima_actividad = NOW() WHERE token = ?`, [\n            sessionToken\n        ]);\n        // 6. Obtener datos\n        const [citas, bloquesHorarios, estadisticas] = await Promise.all([\n            obtenerCitas(medico.id_medico, fechaInicio, fechaFin, estados, tipos, paciente),\n            obtenerBloquesHorarios(medico.id_medico, fechaInicio, fechaFin),\n            calcularEstadisticas(medico.id_medico, fechaInicio, fechaFin)\n        ]);\n        // 7. Respuesta exitosa\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: true,\n            citas,\n            bloques_horarios: bloquesHorarios,\n            estadisticas,\n            filtros: {\n                fecha_inicio: fechaInicio,\n                fecha_fin: fechaFin,\n                estados: estados || [],\n                tipos: tipos || [],\n                paciente: paciente || \"\"\n            },\n            timestamp: new Date().toISOString()\n        }, {\n            status: 200\n        });\n    } catch (error) {\n        console.error(\"❌ Error en GET /api/medico/agenda:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: false,\n            error: \"Error interno del servidor\",\n            details:  true ? error.message : 0\n        }, {\n            status: 500\n        });\n    }\n}\n// ========================================\n// HANDLER POST - Crear nueva cita\n// ========================================\nasync function POST(request) {\n    try {\n        // 1. Obtener token\n        const sessionToken = getSessionToken(request);\n        if (!sessionToken) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"No hay sesi\\xf3n activa\"\n            }, {\n                status: 401\n            });\n        }\n        // 2. Verificar sesión\n        const [sesiones] = await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`\r\n      SELECT su.id_usuario\r\n      FROM sesiones_usuarios su\r\n      INNER JOIN usuarios u ON su.id_usuario = u.id_usuario\r\n      WHERE su.token = ?\r\n        AND su.activa = 1\r\n        AND su.fecha_expiracion > NOW()\r\n        AND u.estado = 'activo'\r\n      LIMIT 1\r\n      `, [\n            sessionToken\n        ]);\n        if (sesiones.length === 0) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"Sesi\\xf3n inv\\xe1lida o expirada\"\n            }, {\n                status: 401\n            });\n        }\n        const idUsuario = sesiones[0].id_usuario;\n        // 3. Verificar que sea médico\n        const medico = await obtenerMedicoAutenticado(idUsuario);\n        if (!medico) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"No tienes un registro de m\\xe9dico activo\"\n            }, {\n                status: 403\n            });\n        }\n        // 4. Obtener datos del body\n        const body = await request.json();\n        const { id_paciente, fecha_hora_inicio, duracion_minutos = 30, tipo_cita = \"control\", motivo, notas, id_especialidad, id_sala, prioridad = \"normal\", origen = \"web\", monto } = body;\n        // 5. Validar datos requeridos\n        if (!id_paciente || !fecha_hora_inicio) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"Faltan datos requeridos\"\n            }, {\n                status: 400\n            });\n        }\n        // 6. Calcular fecha de fin\n        const fechaInicio = new Date(fecha_hora_inicio);\n        const fechaFin = new Date(fechaInicio.getTime() + duracion_minutos * 60000);\n        // 7. Validar disponibilidad\n        const disponible = await validarDisponibilidad(medico.id_medico, fechaInicio.toISOString(), fechaFin.toISOString());\n        if (!disponible) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"El horario seleccionado no est\\xe1 disponible\"\n            }, {\n                status: 409\n            });\n        }\n        // 8. Insertar cita\n        const [result] = await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`\r\n      INSERT INTO citas (\r\n        id_paciente,\r\n        id_medico,\r\n        id_centro,\r\n        id_sucursal,\r\n        fecha_hora_inicio,\r\n        fecha_hora_fin,\r\n        duracion_minutos,\r\n        tipo_cita,\r\n        motivo,\r\n        estado,\r\n        prioridad,\r\n        id_especialidad,\r\n        origen,\r\n        pagada,\r\n        monto,\r\n        id_sala,\r\n        notas,\r\n        creado_por\r\n      ) VALUES (?, ?, ?, NULL, ?, ?, ?, ?, ?, 'programada', ?, ?, ?, 0, ?, ?, ?, ?)\r\n      `, [\n            id_paciente,\n            medico.id_medico,\n            medico.id_centro_principal,\n            fechaInicio.toISOString(),\n            fechaFin.toISOString(),\n            duracion_minutos,\n            tipo_cita,\n            motivo || null,\n            prioridad,\n            id_especialidad || null,\n            origen,\n            monto || null,\n            id_sala || null,\n            notas || null,\n            idUsuario\n        ]);\n        // 9. Obtener la cita creada\n        const [citaNueva] = await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`SELECT * FROM citas WHERE id_cita = ?`, [\n            result.insertId\n        ]);\n        // 10. Respuesta exitosa\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: true,\n            message: \"Cita creada exitosamente\",\n            cita: citaNueva[0],\n            id_cita: result.insertId\n        }, {\n            status: 201\n        });\n    } catch (error) {\n        console.error(\"❌ Error en POST /api/medico/agenda:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: false,\n            error: \"Error interno del servidor\",\n            details:  true ? error.message : 0\n        }, {\n            status: 500\n        });\n    }\n}\n// ========================================\n// HANDLER PUT - Actualizar cita\n// ========================================\nasync function PUT(request) {\n    try {\n        // 1. Obtener token\n        const sessionToken = getSessionToken(request);\n        if (!sessionToken) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"No hay sesi\\xf3n activa\"\n            }, {\n                status: 401\n            });\n        }\n        // 2. Verificar sesión\n        const [sesiones] = await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`\r\n      SELECT su.id_usuario\r\n      FROM sesiones_usuarios su\r\n      INNER JOIN usuarios u ON su.id_usuario = u.id_usuario\r\n      WHERE su.token = ?\r\n        AND su.activa = 1\r\n        AND su.fecha_expiracion > NOW()\r\n        AND u.estado = 'activo'\r\n      LIMIT 1\r\n      `, [\n            sessionToken\n        ]);\n        if (sesiones.length === 0) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"Sesi\\xf3n inv\\xe1lida o expirada\"\n            }, {\n                status: 401\n            });\n        }\n        const idUsuario = sesiones[0].id_usuario;\n        // 3. Verificar que sea médico\n        const medico = await obtenerMedicoAutenticado(idUsuario);\n        if (!medico) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"No tienes un registro de m\\xe9dico activo\"\n            }, {\n                status: 403\n            });\n        }\n        // 4. Obtener datos del body\n        const body = await request.json();\n        const { id_cita, fecha_hora_inicio, duracion_minutos, tipo_cita, motivo, notas, estado, prioridad, id_especialidad, id_sala, monto } = body;\n        // 5. Validar que la cita existe y pertenece al médico\n        const [citaActual] = await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`SELECT * FROM citas WHERE id_cita = ? AND id_medico = ?`, [\n            id_cita,\n            medico.id_medico\n        ]);\n        if (citaActual.length === 0) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"Cita no encontrada\"\n            }, {\n                status: 404\n            });\n        }\n        // 6. Si se cambia el horario, validar disponibilidad\n        if (fecha_hora_inicio || duracion_minutos) {\n            const fechaInicio = fecha_hora_inicio ? new Date(fecha_hora_inicio) : new Date(citaActual[0].fecha_hora_inicio);\n            const duracion = duracion_minutos || citaActual[0].duracion_minutos;\n            const fechaFin = new Date(fechaInicio.getTime() + duracion * 60000);\n            const disponible = await validarDisponibilidad(medico.id_medico, fechaInicio.toISOString(), fechaFin.toISOString(), id_cita);\n            if (!disponible) {\n                return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                    success: false,\n                    error: \"El horario seleccionado no est\\xe1 disponible\"\n                }, {\n                    status: 409\n                });\n            }\n        }\n        // 7. Construir query de actualización\n        const updates = [];\n        const params = [];\n        if (fecha_hora_inicio) {\n            updates.push(\"fecha_hora_inicio = ?\");\n            params.push(fecha_hora_inicio);\n            const duracion = duracion_minutos || citaActual[0].duracion_minutos;\n            const fechaFin = new Date(new Date(fecha_hora_inicio).getTime() + duracion * 60000);\n            updates.push(\"fecha_hora_fin = ?\");\n            params.push(fechaFin.toISOString());\n        }\n        if (duracion_minutos) {\n            updates.push(\"duracion_minutos = ?\");\n            params.push(duracion_minutos);\n            if (!fecha_hora_inicio) {\n                const fechaFin = new Date(new Date(citaActual[0].fecha_hora_inicio).getTime() + duracion_minutos * 60000);\n                updates.push(\"fecha_hora_fin = ?\");\n                params.push(fechaFin.toISOString());\n            }\n        }\n        if (tipo_cita) {\n            updates.push(\"tipo_cita = ?\");\n            params.push(tipo_cita);\n        }\n        if (motivo !== undefined) {\n            updates.push(\"motivo = ?\");\n            params.push(motivo);\n        }\n        if (notas !== undefined) {\n            updates.push(\"notas = ?\");\n            params.push(notas);\n        }\n        if (estado) {\n            updates.push(\"estado = ?\");\n            params.push(estado);\n        }\n        if (prioridad) {\n            updates.push(\"prioridad = ?\");\n            params.push(prioridad);\n        }\n        if (id_especialidad !== undefined) {\n            updates.push(\"id_especialidad = ?\");\n            params.push(id_especialidad);\n        }\n        if (id_sala !== undefined) {\n            updates.push(\"id_sala = ?\");\n            params.push(id_sala);\n        }\n        if (monto !== undefined) {\n            updates.push(\"monto = ?\");\n            params.push(monto);\n        }\n        updates.push(\"modificado_por = ?\");\n        params.push(idUsuario);\n        params.push(id_cita);\n        // 8. Ejecutar actualización\n        await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`UPDATE citas SET ${updates.join(\", \")} WHERE id_cita = ?`, params);\n        // 9. Obtener cita actualizada\n        const [citaActualizada] = await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`SELECT * FROM citas WHERE id_cita = ?`, [\n            id_cita\n        ]);\n        // 10. Respuesta exitosa\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: true,\n            message: \"Cita actualizada exitosamente\",\n            cita: citaActualizada[0]\n        }, {\n            status: 200\n        });\n    } catch (error) {\n        console.error(\"❌ Error en PUT /api/medico/agenda:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: false,\n            error: \"Error interno del servidor\",\n            details:  true ? error.message : 0\n        }, {\n            status: 500\n        });\n    }\n}\n// ========================================\n// HANDLER DELETE - Cancelar cita\n// ========================================\nasync function DELETE(request) {\n    try {\n        // 1. Obtener token\n        const sessionToken = getSessionToken(request);\n        if (!sessionToken) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"No hay sesi\\xf3n activa\"\n            }, {\n                status: 401\n            });\n        }\n        // 2. Verificar sesión\n        const [sesiones] = await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`\r\n      SELECT su.id_usuario\r\n      FROM sesiones_usuarios su\r\n      INNER JOIN usuarios u ON su.id_usuario = u.id_usuario\r\n      WHERE su.token = ?\r\n        AND su.activa = 1\r\n        AND su.fecha_expiracion > NOW()\r\n        AND u.estado = 'activo'\r\n      LIMIT 1\r\n      `, [\n            sessionToken\n        ]);\n        if (sesiones.length === 0) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"Sesi\\xf3n inv\\xe1lida o expirada\"\n            }, {\n                status: 401\n            });\n        }\n        const idUsuario = sesiones[0].id_usuario;\n        // 3. Verificar que sea médico\n        const medico = await obtenerMedicoAutenticado(idUsuario);\n        if (!medico) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"No tienes un registro de m\\xe9dico activo\"\n            }, {\n                status: 403\n            });\n        }\n        // 4. Obtener parámetros\n        const searchParams = request.nextUrl.searchParams;\n        const idCita = searchParams.get(\"id_cita\");\n        const motivo = searchParams.get(\"motivo\") || \"Cancelada por el m\\xe9dico\";\n        if (!idCita) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"ID de cita requerido\"\n            }, {\n                status: 400\n            });\n        }\n        // 5. Validar que la cita existe y pertenece al médico\n        const [cita] = await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`SELECT * FROM citas WHERE id_cita = ? AND id_medico = ?`, [\n            idCita,\n            medico.id_medico\n        ]);\n        if (cita.length === 0) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"Cita no encontrada\"\n            }, {\n                status: 404\n            });\n        }\n        // 6. Actualizar estado de la cita\n        await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`UPDATE citas SET estado = 'cancelada', modificado_por = ? WHERE id_cita = ?`, [\n            idUsuario,\n            idCita\n        ]);\n        // 7. Registrar la cancelación\n        await _lib_db__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query(`\r\n      INSERT INTO cancelaciones (\r\n        id_cita,\r\n        fecha_cancelacion,\r\n        motivo,\r\n        detalle_motivo,\r\n        cancelado_por,\r\n        cancelado_por_tipo\r\n      ) VALUES (?, NOW(), 'medico_solicita', ?, ?, 'medico')\r\n      `, [\n            idCita,\n            motivo,\n            idUsuario\n        ]);\n        // 8. Respuesta exitosa\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: true,\n            message: \"Cita cancelada exitosamente\"\n        }, {\n            status: 200\n        });\n    } catch (error) {\n        console.error(\"❌ Error en DELETE /api/medico/agenda:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: false,\n            error: \"Error interno del servidor\",\n            details:  true ? error.message : 0\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9tZWRpY28vYWdlbmRhL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLGlDQUFpQztBQUN1QjtBQUM1QjtBQWlENUIsMkNBQTJDO0FBQzNDLCtCQUErQjtBQUMvQiwyQ0FBMkM7QUFFM0MsTUFBTUUsNEJBQTRCO0lBQ2hDO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtDQUNEO0FBRUQsU0FBU0MsZ0JBQWdCQyxPQUFvQjtJQUMzQyxNQUFNQyxlQUFlRCxRQUFRRSxPQUFPLENBQUNDLEdBQUcsQ0FBQyxhQUFhO0lBRXRELElBQUlGLGNBQWM7UUFDaEIsTUFBTUcsVUFBVUgsYUFDYkksS0FBSyxDQUFDLEtBQ05DLEdBQUcsQ0FBQyxDQUFDQyxJQUFNQSxFQUFFQyxJQUFJLElBQ2pCQyxNQUFNLENBQUNDLFNBQ1BDLE1BQU0sQ0FBQyxDQUFDQyxLQUFLTDtZQUNaLE1BQU0sQ0FBQ00sR0FBRyxHQUFHQyxLQUFLLEdBQUdQLEVBQUVGLEtBQUssQ0FBQztZQUM3Qk8sR0FBRyxDQUFDQyxFQUFFLEdBQUdDLEtBQUtDLElBQUksQ0FBQztZQUNuQixPQUFPSDtRQUNULEdBQUcsQ0FBQztRQUVOLEtBQUssTUFBTUksUUFBUWxCLDBCQUEyQjtZQUM1QyxJQUFJTSxPQUFPLENBQUNZLEtBQUssRUFBRTtnQkFDakIsT0FBT0MsbUJBQW1CYixPQUFPLENBQUNZLEtBQUs7WUFDekM7UUFDRjtJQUNGO0lBRUEsTUFBTUUsT0FBT2xCLFFBQVFFLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDO0lBQ2pDLElBQUllLE1BQU1DLFdBQVcsWUFBWTtRQUMvQixPQUFPRCxLQUFLRSxLQUFLLENBQUM7SUFDcEI7SUFFQSxPQUFPO0FBQ1Q7QUFFQSwyQ0FBMkM7QUFDM0MsdUJBQXVCO0FBQ3ZCLDJDQUEyQztBQUUzQzs7Q0FFQyxHQUNELGVBQWVDLHlCQUNiQyxTQUFpQjtJQUVqQixJQUFJO1FBQ0YsTUFBTSxDQUFDQyxLQUFLLEdBQUcsTUFBTTFCLHFE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UUFDdkIsT0FBTzFCLGtGQUFZQSxDQUFDd0ksSUFBSSxDQUN0QjtZQUNFQyxTQUFTO1lBQ1RpQixTQUFTO1FBQ1gsR0FDQTtZQUFFaEIsUUFBUTtRQUFJO0lBRWxCLEVBQUUsT0FBTzVHLE9BQVk7UUFDbkJDLFFBQVFELEtBQUssQ0FBQyx5Q0FBeUNBO1FBRXZELE9BQU85QixrRkFBWUEsQ0FBQ3dJLElBQUksQ0FDdEI7WUFDRUMsU0FBUztZQUNUM0csT0FBTztZQUNQMEgsU0FDRUMsS0FBc0MsR0FBRzNILE1BQU00SCxPQUFPLEdBQUdDLENBQVNBO1FBQ3RFLEdBQ0E7WUFBRWpCLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbWVkaXN1aXRlLXByby8uL3NyYy9hcHAvYXBpL21lZGljby9hZ2VuZGEvcm91dGUudHM/YjdhOCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBhcHAvYXBpL21lZGljby9hZ2VuZGEvcm91dGUudHNcclxuaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xyXG5pbXBvcnQgcG9vbCBmcm9tIFwiQC9saWIvZGJcIjtcclxuaW1wb3J0IHsgUm93RGF0YVBhY2tldCwgUmVzdWx0U2V0SGVhZGVyIH0gZnJvbSBcIm15c3FsMlwiO1xyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBUSVBPU1xyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5pbnRlcmZhY2UgTWVkaWNvRGF0YSB7XHJcbiAgaWRfbWVkaWNvOiBudW1iZXI7XHJcbiAgaWRfdXN1YXJpbzogbnVtYmVyO1xyXG4gIGlkX2NlbnRyb19wcmluY2lwYWw6IG51bWJlcjtcclxufVxyXG5cclxuaW50ZXJmYWNlIENpdGEge1xyXG4gIGlkX2NpdGE6IG51bWJlcjtcclxuICBpZF9wYWNpZW50ZTogbnVtYmVyO1xyXG4gIGlkX21lZGljbzogbnVtYmVyO1xyXG4gIGZlY2hhX2hvcmFfaW5pY2lvOiBzdHJpbmc7XHJcbiAgZmVjaGFfaG9yYV9maW46IHN0cmluZztcclxuICBkdXJhY2lvbl9taW51dG9zOiBudW1iZXI7XHJcbiAgdGlwb19jaXRhOiBzdHJpbmc7XHJcbiAgZXN0YWRvOiBzdHJpbmc7XHJcbiAgcHJpb3JpZGFkOiBzdHJpbmc7XHJcbiAgbW90aXZvOiBzdHJpbmcgfCBudWxsO1xyXG4gIG5vdGFzOiBzdHJpbmcgfCBudWxsO1xyXG4gIGNvbmZpcm1hZG9fcG9yX3BhY2llbnRlOiBib29sZWFuO1xyXG4gIHBhZ2FkYTogYm9vbGVhbjtcclxuICBtb250bzogbnVtYmVyIHwgbnVsbDtcclxufVxyXG5cclxuaW50ZXJmYWNlIEVzdGFkaXN0aWNhc0FnZW5kYSB7XHJcbiAgdG90YWxfY2l0YXM6IG51bWJlcjtcclxuICBjb25maXJtYWRhczogbnVtYmVyO1xyXG4gIHBlbmRpZW50ZXM6IG51bWJlcjtcclxuICBjb21wbGV0YWRhczogbnVtYmVyO1xyXG4gIGNhbmNlbGFkYXM6IG51bWJlcjtcclxuICBub19hc2lzdGlvOiBudW1iZXI7XHJcbiAgZW5fc2FsYV9lc3BlcmE6IG51bWJlcjtcclxuICB0YXNhX2FzaXN0ZW5jaWE6IG51bWJlcjtcclxuICB0YXNhX2NvbmZpcm1hY2lvbjogbnVtYmVyO1xyXG4gIGR1cmFjaW9uX3Byb21lZGlvOiBudW1iZXI7XHJcbiAgdGllbXBvX3Byb21lZGlvX2VzcGVyYTogbnVtYmVyO1xyXG4gIGhvcmFzX2FnZW5kYWRhczogbnVtYmVyO1xyXG4gIGhvcmFzX2Rpc3BvbmlibGVzOiBudW1iZXI7XHJcbiAgb2N1cGFjaW9uOiBudW1iZXI7XHJcbiAgaW5ncmVzb3NfZXN0aW1hZG9zOiBudW1iZXI7XHJcbiAgaW5ncmVzb3NfcmVhbGVzOiBudW1iZXI7XHJcbn1cclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gSEVMUEVSIFBBUkEgT0JURU5FUiBFTCBUT0tFTlxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5jb25zdCBTRVNTSU9OX0NPT0tJRV9DQU5ESURBVEVTID0gW1xyXG4gIFwic2Vzc2lvblwiLFxyXG4gIFwic2Vzc2lvbl90b2tlblwiLFxyXG4gIFwibWVkaXNhbHVkX3Nlc3Npb25cIixcclxuICBcImF1dGhfc2Vzc2lvblwiLFxyXG4gIFwibmV4dC1hdXRoLnNlc3Npb24tdG9rZW5cIixcclxuICBcIl9fU2VjdXJlLW5leHQtYXV0aC5zZXNzaW9uLXRva2VuXCIsXHJcbl07XHJcblxyXG5mdW5jdGlvbiBnZXRTZXNzaW9uVG9rZW4ocmVxdWVzdDogTmV4dFJlcXVlc3QpOiBzdHJpbmcgfCBudWxsIHtcclxuICBjb25zdCBjb29raWVIZWFkZXIgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KFwiY29va2llXCIpIHx8IFwiXCI7XHJcblxyXG4gIGlmIChjb29raWVIZWFkZXIpIHtcclxuICAgIGNvbnN0IGNvb2tpZXMgPSBjb29raWVIZWFkZXJcclxuICAgICAgLnNwbGl0KFwiO1wiKVxyXG4gICAgICAubWFwKChjKSA9PiBjLnRyaW0oKSlcclxuICAgICAgLmZpbHRlcihCb29sZWFuKVxyXG4gICAgICAucmVkdWNlKChhY2MsIGMpID0+IHtcclxuICAgICAgICBjb25zdCBbaywgLi4ucmVzdF0gPSBjLnNwbGl0KFwiPVwiKTtcclxuICAgICAgICBhY2Nba10gPSByZXN0LmpvaW4oXCI9XCIpO1xyXG4gICAgICAgIHJldHVybiBhY2M7XHJcbiAgICAgIH0sIHt9IGFzIFJlY29yZDxzdHJpbmcsIHN0cmluZz4pO1xyXG5cclxuICAgIGZvciAoY29uc3QgbmFtZSBvZiBTRVNTSU9OX0NPT0tJRV9DQU5ESURBVEVTKSB7XHJcbiAgICAgIGlmIChjb29raWVzW25hbWVdKSB7XHJcbiAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChjb29raWVzW25hbWVdKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY29uc3QgYXV0aCA9IHJlcXVlc3QuaGVhZGVycy5nZXQoXCJhdXRob3JpemF0aW9uXCIpO1xyXG4gIGlmIChhdXRoPy5zdGFydHNXaXRoKFwiQmVhcmVyIFwiKSkge1xyXG4gICAgcmV0dXJuIGF1dGguc2xpY2UoNyk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gbnVsbDtcclxufVxyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBGVU5DSU9ORVMgQVVYSUxJQVJFU1xyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4vKipcclxuICogT2J0aWVuZSBsYSBpbmZvcm1hY2nDs24gZGVsIG3DqWRpY28gYXV0ZW50aWNhZG9cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIG9idGVuZXJNZWRpY29BdXRlbnRpY2FkbyhcclxuICBpZFVzdWFyaW86IG51bWJlclxyXG4pOiBQcm9taXNlPE1lZGljb0RhdGEgfCBudWxsPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IFtyb3dzXSA9IGF3YWl0IHBvb2wucXVlcnk8Um93RGF0YVBhY2tldFtdPihcclxuICAgICAgYFxyXG4gICAgICBTRUxFQ1QgXHJcbiAgICAgICAgbS5pZF9tZWRpY28sXHJcbiAgICAgICAgbS5pZF91c3VhcmlvLFxyXG4gICAgICAgIG0uaWRfY2VudHJvX3ByaW5jaXBhbFxyXG4gICAgICBGUk9NIG1lZGljb3MgbVxyXG4gICAgICBXSEVSRSBtLmlkX3VzdWFyaW8gPSA/IEFORCBtLmVzdGFkbyA9ICdhY3Rpdm8nXHJcbiAgICAgIExJTUlUIDFcclxuICAgICAgYCxcclxuICAgICAgW2lkVXN1YXJpb11cclxuICAgICk7XHJcblxyXG4gICAgaWYgKHJvd3MubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiByb3dzWzBdIGFzIE1lZGljb0RhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhbCBvYnRlbmVyIG3DqWRpY286XCIsIGVycm9yKTtcclxuICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIE9idGllbmUgbGFzIGNpdGFzIGRlbCBtw6lkaWNvIHNlZ8O6biBmaWx0cm9zXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBvYnRlbmVyQ2l0YXMoXHJcbiAgaWRNZWRpY286IG51bWJlcixcclxuICBmZWNoYUluaWNpbzogc3RyaW5nLFxyXG4gIGZlY2hhRmluOiBzdHJpbmcsXHJcbiAgZXN0YWRvcz86IHN0cmluZ1tdLFxyXG4gIHRpcG9zPzogc3RyaW5nW10sXHJcbiAgcGFjaWVudGU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTxhbnlbXT4ge1xyXG4gIHRyeSB7XHJcbiAgICBsZXQgcXVlcnkgPSBgXHJcbiAgICAgIFNFTEVDVCBcclxuICAgICAgICBjLmlkX2NpdGEsXHJcbiAgICAgICAgYy5pZF9wYWNpZW50ZSxcclxuICAgICAgICBjLmlkX21lZGljbyxcclxuICAgICAgICBjLmlkX2NlbnRybyxcclxuICAgICAgICBjLmlkX3N1Y3Vyc2FsLFxyXG4gICAgICAgIGMuZmVjaGFfaG9yYV9pbmljaW8sXHJcbiAgICAgICAgYy5mZWNoYV9ob3JhX2ZpbixcclxuICAgICAgICBjLmR1cmFjaW9uX21pbnV0b3MsXHJcbiAgICAgICAgYy50aXBvX2NpdGEsXHJcbiAgICAgICAgYy5tb3Rpdm8sXHJcbiAgICAgICAgYy5lc3RhZG8sXHJcbiAgICAgICAgYy5wcmlvcmlkYWQsXHJcbiAgICAgICAgYy5pZF9lc3BlY2lhbGlkYWQsXHJcbiAgICAgICAgYy5vcmlnZW4sXHJcbiAgICAgICAgYy5wYWdhZGEsXHJcbiAgICAgICAgYy5tb250byxcclxuICAgICAgICBjLmlkX3NhbGEsXHJcbiAgICAgICAgYy5ub3RhcyxcclxuICAgICAgICBjLm5vdGFzX3ByaXZhZGFzLFxyXG4gICAgICAgIGMucmVjb3JkYXRvcmlvX2VudmlhZG8sXHJcbiAgICAgICAgYy5mZWNoYV9yZWNvcmRhdG9yaW8sXHJcbiAgICAgICAgYy5jb25maXJtYWNpb25fZW52aWFkYSxcclxuICAgICAgICBjLmZlY2hhX2NvbmZpcm1hY2lvbixcclxuICAgICAgICBjLmNvbmZpcm1hZG9fcG9yX3BhY2llbnRlLFxyXG4gICAgICAgIFxyXG4gICAgICAgIC0tIERhdG9zIGRlbCBwYWNpZW50ZVxyXG4gICAgICAgIHAuaWRfcGFjaWVudGUsXHJcbiAgICAgICAgQ09OQ0FUKHAubm9tYnJlLCAnICcsIHAuYXBlbGxpZG9fcGF0ZXJubywgJyAnLCBDT0FMRVNDRShwLmFwZWxsaWRvX21hdGVybm8sICcnKSkgYXMgcGFjaWVudGVfbm9tYnJlX2NvbXBsZXRvLFxyXG4gICAgICAgIFRJTUVTVEFNUERJRkYoWUVBUiwgcC5mZWNoYV9uYWNpbWllbnRvLCBDVVJEQVRFKCkpIGFzIHBhY2llbnRlX2VkYWQsXHJcbiAgICAgICAgcC5nZW5lcm8gYXMgcGFjaWVudGVfZ2VuZXJvLFxyXG4gICAgICAgIHAudGVsZWZvbm8gYXMgcGFjaWVudGVfdGVsZWZvbm8sXHJcbiAgICAgICAgcC5lbWFpbCBhcyBwYWNpZW50ZV9lbWFpbCxcclxuICAgICAgICBwLmZvdG9fdXJsIGFzIHBhY2llbnRlX2ZvdG9fdXJsLFxyXG4gICAgICAgIHAuZ3J1cG9fc2FuZ3VpbmVvIGFzIHBhY2llbnRlX2dydXBvX3Nhbmd1aW5lbyxcclxuICAgICAgICBcclxuICAgICAgICAtLSBDb250YXIgYWxlcmdpYXMgY3LDrXRpY2FzXHJcbiAgICAgICAgKFxyXG4gICAgICAgICAgU0VMRUNUIENPVU5UKCopXHJcbiAgICAgICAgICBGUk9NIGFsZXJnaWFzXHJcbiAgICAgICAgICBXSEVSRSBpZF9wYWNpZW50ZSA9IHAuaWRfcGFjaWVudGVcclxuICAgICAgICAgICAgQU5EIGVzdGFkbyA9ICdhY3RpdmEnXHJcbiAgICAgICAgICAgIEFORCBzZXZlcmlkYWQgSU4gKCdzZXZlcmEnLCAnZmF0YWwnKVxyXG4gICAgICAgICkgYXMgcGFjaWVudGVfYWxlcmdpYXNfY3JpdGljYXMsXHJcbiAgICAgICAgXHJcbiAgICAgICAgLS0gRGF0b3MgZGUgbGEgc2FsYVxyXG4gICAgICAgIHMuaWRfc2FsYSxcclxuICAgICAgICBzLm5vbWJyZSBhcyBzYWxhX25vbWJyZSxcclxuICAgICAgICBzLnRpcG8gYXMgc2FsYV90aXBvLFxyXG4gICAgICAgIFxyXG4gICAgICAgIC0tIERhdG9zIGRlIGxhIGVzcGVjaWFsaWRhZFxyXG4gICAgICAgIGUuaWRfZXNwZWNpYWxpZGFkLFxyXG4gICAgICAgIGUubm9tYnJlIGFzIGVzcGVjaWFsaWRhZF9ub21icmVcclxuICAgICAgICBcclxuICAgICAgRlJPTSBjaXRhcyBjXHJcbiAgICAgIElOTkVSIEpPSU4gcGFjaWVudGVzIHAgT04gYy5pZF9wYWNpZW50ZSA9IHAuaWRfcGFjaWVudGVcclxuICAgICAgTEVGVCBKT0lOIHNhbGFzIHMgT04gYy5pZF9zYWxhID0gcy5pZF9zYWxhXHJcbiAgICAgIExFRlQgSk9JTiBlc3BlY2lhbGlkYWRlcyBlIE9OIGMuaWRfZXNwZWNpYWxpZGFkID0gZS5pZF9lc3BlY2lhbGlkYWRcclxuICAgICAgV0hFUkUgYy5pZF9tZWRpY28gPSA/XHJcbiAgICAgICAgQU5EIERBVEUoYy5mZWNoYV9ob3JhX2luaWNpbykgQkVUV0VFTiA/IEFORCA/XHJcbiAgICBgO1xyXG5cclxuICAgIGNvbnN0IHBhcmFtczogYW55W10gPSBbaWRNZWRpY28sIGZlY2hhSW5pY2lvLCBmZWNoYUZpbl07XHJcblxyXG4gICAgLy8gRmlsdHJvIHBvciBlc3RhZG9zXHJcbiAgICBpZiAoZXN0YWRvcyAmJiBlc3RhZG9zLmxlbmd0aCA+IDApIHtcclxuICAgICAgcXVlcnkgKz0gYCBBTkQgYy5lc3RhZG8gSU4gKCR7ZXN0YWRvcy5tYXAoKCkgPT4gXCI/XCIpLmpvaW4oXCIsXCIpfSlgO1xyXG4gICAgICBwYXJhbXMucHVzaCguLi5lc3RhZG9zKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBGaWx0cm8gcG9yIHRpcG9zXHJcbiAgICBpZiAodGlwb3MgJiYgdGlwb3MubGVuZ3RoID4gMCkge1xyXG4gICAgICBxdWVyeSArPSBgIEFORCBjLnRpcG9fY2l0YSBJTiAoJHt0aXBvcy5tYXAoKCkgPT4gXCI/XCIpLmpvaW4oXCIsXCIpfSlgO1xyXG4gICAgICBwYXJhbXMucHVzaCguLi50aXBvcyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRmlsdHJvIHBvciBwYWNpZW50ZVxyXG4gICAgaWYgKHBhY2llbnRlICYmIHBhY2llbnRlLnRyaW0oKSkge1xyXG4gICAgICBxdWVyeSArPSBgIEFORCAoXHJcbiAgICAgICAgQ09OQ0FUKHAubm9tYnJlLCAnICcsIHAuYXBlbGxpZG9fcGF0ZXJubywgJyAnLCBDT0FMRVNDRShwLmFwZWxsaWRvX21hdGVybm8sICcnKSkgTElLRSA/XHJcbiAgICAgICAgT1IgcC5ydXQgTElLRSA/XHJcbiAgICAgICAgT1IgcC5lbWFpbCBMSUtFID9cclxuICAgICAgKWA7XHJcbiAgICAgIGNvbnN0IHNlYXJjaFRlcm0gPSBgJSR7cGFjaWVudGV9JWA7XHJcbiAgICAgIHBhcmFtcy5wdXNoKHNlYXJjaFRlcm0sIHNlYXJjaFRlcm0sIHNlYXJjaFRlcm0pO1xyXG4gICAgfVxyXG5cclxuICAgIHF1ZXJ5ICs9IGAgT1JERVIgQlkgYy5mZWNoYV9ob3JhX2luaWNpbyBBU0NgO1xyXG5cclxuICAgIGNvbnN0IFtyb3dzXSA9IGF3YWl0IHBvb2wucXVlcnk8Um93RGF0YVBhY2tldFtdPihxdWVyeSwgcGFyYW1zKTtcclxuXHJcbiAgICAvLyBGb3JtYXRlYXIgbG9zIHJlc3VsdGFkb3NcclxuICAgIHJldHVybiByb3dzLm1hcCgocm93KSA9PiAoe1xyXG4gICAgICBpZF9jaXRhOiByb3cuaWRfY2l0YSxcclxuICAgICAgaWRfcGFjaWVudGU6IHJvdy5pZF9wYWNpZW50ZSxcclxuICAgICAgaWRfbWVkaWNvOiByb3cuaWRfbWVkaWNvLFxyXG4gICAgICBpZF9jZW50cm86IHJvdy5pZF9jZW50cm8sXHJcbiAgICAgIGlkX3N1Y3Vyc2FsOiByb3cuaWRfc3VjdXJzYWwsXHJcbiAgICAgIGZlY2hhX2hvcmFfaW5pY2lvOiByb3cuZmVjaGFfaG9yYV9pbmljaW8sXHJcbiAgICAgIGZlY2hhX2hvcmFfZmluOiByb3cuZmVjaGFfaG9yYV9maW4sXHJcbiAgICAgIGR1cmFjaW9uX21pbnV0b3M6IHJvdy5kdXJhY2lvbl9taW51dG9zLFxyXG4gICAgICB0aXBvX2NpdGE6IHJvdy50aXBvX2NpdGEsXHJcbiAgICAgIG1vdGl2bzogcm93Lm1vdGl2byxcclxuICAgICAgZXN0YWRvOiByb3cuZXN0YWRvLFxyXG4gICAgICBwcmlvcmlkYWQ6IHJvdy5wcmlvcmlkYWQsXHJcbiAgICAgIGlkX2VzcGVjaWFsaWRhZDogcm93LmlkX2VzcGVjaWFsaWRhZCxcclxuICAgICAgb3JpZ2VuOiByb3cub3JpZ2VuLFxyXG4gICAgICBwYWdhZGE6IHJvdy5wYWdhZGEgPT09IDEsXHJcbiAgICAgIG1vbnRvOiByb3cubW9udG8sXHJcbiAgICAgIGlkX3NhbGE6IHJvdy5pZF9zYWxhLFxyXG4gICAgICBub3Rhczogcm93Lm5vdGFzLFxyXG4gICAgICBub3Rhc19wcml2YWRhczogcm93Lm5vdGFzX3ByaXZhZGFzLFxyXG4gICAgICByZWNvcmRhdG9yaW9fZW52aWFkbzogcm93LnJlY29yZGF0b3Jpb19lbnZpYWRvID09PSAxLFxyXG4gICAgICBmZWNoYV9yZWNvcmRhdG9yaW86IHJvdy5mZWNoYV9yZWNvcmRhdG9yaW8sXHJcbiAgICAgIGNvbmZpcm1hY2lvbl9lbnZpYWRhOiByb3cuY29uZmlybWFjaW9uX2VudmlhZGEgPT09IDEsXHJcbiAgICAgIGZlY2hhX2NvbmZpcm1hY2lvbjogcm93LmZlY2hhX2NvbmZpcm1hY2lvbixcclxuICAgICAgY29uZmlybWFkb19wb3JfcGFjaWVudGU6IHJvdy5jb25maXJtYWRvX3Bvcl9wYWNpZW50ZSA9PT0gMSxcclxuICAgICAgcGFjaWVudGU6IHtcclxuICAgICAgICBpZF9wYWNpZW50ZTogcm93LmlkX3BhY2llbnRlLFxyXG4gICAgICAgIG5vbWJyZV9jb21wbGV0bzogcm93LnBhY2llbnRlX25vbWJyZV9jb21wbGV0byxcclxuICAgICAgICBlZGFkOiByb3cucGFjaWVudGVfZWRhZCxcclxuICAgICAgICBnZW5lcm86IHJvdy5wYWNpZW50ZV9nZW5lcm8sXHJcbiAgICAgICAgdGVsZWZvbm86IHJvdy5wYWNpZW50ZV90ZWxlZm9ubyxcclxuICAgICAgICBlbWFpbDogcm93LnBhY2llbnRlX2VtYWlsLFxyXG4gICAgICAgIGZvdG9fdXJsOiByb3cucGFjaWVudGVfZm90b191cmwsXHJcbiAgICAgICAgZ3J1cG9fc2FuZ3VpbmVvOiByb3cucGFjaWVudGVfZ3J1cG9fc2FuZ3VpbmVvIHx8IFwiTi9BXCIsXHJcbiAgICAgICAgYWxlcmdpYXNfY3JpdGljYXM6IHJvdy5wYWNpZW50ZV9hbGVyZ2lhc19jcml0aWNhcyxcclxuICAgICAgfSxcclxuICAgICAgc2FsYTogcm93LmlkX3NhbGFcclxuICAgICAgICA/IHtcclxuICAgICAgICAgICAgaWRfc2FsYTogcm93LmlkX3NhbGEsXHJcbiAgICAgICAgICAgIG5vbWJyZTogcm93LnNhbGFfbm9tYnJlLFxyXG4gICAgICAgICAgICB0aXBvOiByb3cuc2FsYV90aXBvLFxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIDogbnVsbCxcclxuICAgICAgZXNwZWNpYWxpZGFkOiByb3cuaWRfZXNwZWNpYWxpZGFkXHJcbiAgICAgICAgPyB7XHJcbiAgICAgICAgICAgIGlkX2VzcGVjaWFsaWRhZDogcm93LmlkX2VzcGVjaWFsaWRhZCxcclxuICAgICAgICAgICAgbm9tYnJlOiByb3cuZXNwZWNpYWxpZGFkX25vbWJyZSxcclxuICAgICAgICAgIH1cclxuICAgICAgICA6IG51bGwsXHJcbiAgICB9KSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhbCBvYnRlbmVyIGNpdGFzOlwiLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBPYnRpZW5lIGxvcyBibG9xdWVzIGhvcmFyaW9zIGRlbCBtw6lkaWNvXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBvYnRlbmVyQmxvcXVlc0hvcmFyaW9zKFxyXG4gIGlkTWVkaWNvOiBudW1iZXIsXHJcbiAgZmVjaGFJbmljaW86IHN0cmluZyxcclxuICBmZWNoYUZpbjogc3RyaW5nXHJcbik6IFByb21pc2U8YW55W10+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgW3Jvd3NdID0gYXdhaXQgcG9vbC5xdWVyeTxSb3dEYXRhUGFja2V0W10+KFxyXG4gICAgICBgXHJcbiAgICAgIFNFTEVDVCBcclxuICAgICAgICBiLmlkX2Jsb3F1ZSxcclxuICAgICAgICBiLmlkX21lZGljbyxcclxuICAgICAgICBiLmZlY2hhX2luaWNpbyxcclxuICAgICAgICBiLmZlY2hhX2ZpbixcclxuICAgICAgICBiLmR1cmFjaW9uX21pbnV0b3MsXHJcbiAgICAgICAgYi5lc3RhZG8sXHJcbiAgICAgICAgYi50aXBvX2F0ZW5jaW9uLFxyXG4gICAgICAgIGIuaWRfc2FsYSxcclxuICAgICAgICBiLmN1cG9fbWF4aW1vLFxyXG4gICAgICAgIGIuY3Vwb19hY3R1YWwsXHJcbiAgICAgICAgYi52aXNpYmxlX3dlYixcclxuICAgICAgICBzLm5vbWJyZSBhcyBzYWxhX25vbWJyZVxyXG4gICAgICBGUk9NIGJsb3F1ZXNfaG9yYXJpb3MgYlxyXG4gICAgICBMRUZUIEpPSU4gc2FsYXMgcyBPTiBiLmlkX3NhbGEgPSBzLmlkX3NhbGFcclxuICAgICAgV0hFUkUgYi5pZF9tZWRpY28gPSA/XHJcbiAgICAgICAgQU5EIERBVEUoYi5mZWNoYV9pbmljaW8pIEJFVFdFRU4gPyBBTkQgP1xyXG4gICAgICBPUkRFUiBCWSBiLmZlY2hhX2luaWNpbyBBU0NcclxuICAgICAgYCxcclxuICAgICAgW2lkTWVkaWNvLCBmZWNoYUluaWNpbywgZmVjaGFGaW5dXHJcbiAgICApO1xyXG5cclxuICAgIHJldHVybiByb3dzLm1hcCgocm93KSA9PiAoe1xyXG4gICAgICBpZF9ibG9xdWU6IHJvdy5pZF9ibG9xdWUsXHJcbiAgICAgIGlkX21lZGljbzogcm93LmlkX21lZGljbyxcclxuICAgICAgZmVjaGFfaW5pY2lvOiByb3cuZmVjaGFfaW5pY2lvLFxyXG4gICAgICBmZWNoYV9maW46IHJvdy5mZWNoYV9maW4sXHJcbiAgICAgIGR1cmFjaW9uX21pbnV0b3M6IHJvdy5kdXJhY2lvbl9taW51dG9zLFxyXG4gICAgICBlc3RhZG86IHJvdy5lc3RhZG8sXHJcbiAgICAgIHRpcG9fYXRlbmNpb246IHJvdy50aXBvX2F0ZW5jaW9uLFxyXG4gICAgICBpZF9zYWxhOiByb3cuaWRfc2FsYSxcclxuICAgICAgY3Vwb19tYXhpbW86IHJvdy5jdXBvX21heGltbyxcclxuICAgICAgY3Vwb19hY3R1YWw6IHJvdy5jdXBvX2FjdHVhbCxcclxuICAgICAgdmlzaWJsZV93ZWI6IHJvdy52aXNpYmxlX3dlYiA9PT0gMSxcclxuICAgICAgc2FsYV9ub21icmU6IHJvdy5zYWxhX25vbWJyZSxcclxuICAgIH0pKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGFsIG9idGVuZXIgYmxvcXVlcyBob3JhcmlvczpcIiwgZXJyb3IpO1xyXG4gICAgdGhyb3cgZXJyb3I7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogQ2FsY3VsYSBsYXMgZXN0YWTDrXN0aWNhcyBkZSBsYSBhZ2VuZGFcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGNhbGN1bGFyRXN0YWRpc3RpY2FzKFxyXG4gIGlkTWVkaWNvOiBudW1iZXIsXHJcbiAgZmVjaGFJbmljaW86IHN0cmluZyxcclxuICBmZWNoYUZpbjogc3RyaW5nXHJcbik6IFByb21pc2U8RXN0YWRpc3RpY2FzQWdlbmRhPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IFtlc3RhZGlzdGljYXNdID0gYXdhaXQgcG9vbC5xdWVyeTxSb3dEYXRhUGFja2V0W10+KFxyXG4gICAgICBgXHJcbiAgICAgIFNFTEVDVCBcclxuICAgICAgICBDT1VOVCgqKSBhcyB0b3RhbF9jaXRhcyxcclxuICAgICAgICBTVU0oQ0FTRSBXSEVOIGVzdGFkbyA9ICdjb25maXJtYWRhJyBUSEVOIDEgRUxTRSAwIEVORCkgYXMgY29uZmlybWFkYXMsXHJcbiAgICAgICAgU1VNKENBU0UgV0hFTiBlc3RhZG8gSU4gKCdwcm9ncmFtYWRhJywgJ3BlbmRpZW50ZScpIFRIRU4gMSBFTFNFIDAgRU5EKSBhcyBwZW5kaWVudGVzLFxyXG4gICAgICAgIFNVTShDQVNFIFdIRU4gZXN0YWRvID0gJ2NvbXBsZXRhZGEnIFRIRU4gMSBFTFNFIDAgRU5EKSBhcyBjb21wbGV0YWRhcyxcclxuICAgICAgICBTVU0oQ0FTRSBXSEVOIGVzdGFkbyA9ICdjYW5jZWxhZGEnIFRIRU4gMSBFTFNFIDAgRU5EKSBhcyBjYW5jZWxhZGFzLFxyXG4gICAgICAgIFNVTShDQVNFIFdIRU4gZXN0YWRvID0gJ25vX2FzaXN0aW8nIFRIRU4gMSBFTFNFIDAgRU5EKSBhcyBub19hc2lzdGlvLFxyXG4gICAgICAgIFNVTShDQVNFIFdIRU4gZXN0YWRvID0gJ2VuX3NhbGFfZXNwZXJhJyBUSEVOIDEgRUxTRSAwIEVORCkgYXMgZW5fc2FsYV9lc3BlcmEsXHJcbiAgICAgICAgU1VNKENBU0UgV0hFTiBjb25maXJtYWRvX3Bvcl9wYWNpZW50ZSA9IDEgVEhFTiAxIEVMU0UgMCBFTkQpIGFzIHRvdGFsX2NvbmZpcm1hZGFzLFxyXG4gICAgICAgIEFWRyhkdXJhY2lvbl9taW51dG9zKSBhcyBkdXJhY2lvbl9wcm9tZWRpbyxcclxuICAgICAgICBTVU0oZHVyYWNpb25fbWludXRvcykgLyA2MCBhcyBob3Jhc19hZ2VuZGFkYXMsXHJcbiAgICAgICAgU1VNKENBU0UgV0hFTiBwYWdhZGEgPSAxIFRIRU4gbW9udG8gRUxTRSAwIEVORCkgYXMgaW5ncmVzb3NfcmVhbGVzLFxyXG4gICAgICAgIFNVTShtb250bykgYXMgaW5ncmVzb3NfZXN0aW1hZG9zXHJcbiAgICAgIEZST00gY2l0YXNcclxuICAgICAgV0hFUkUgaWRfbWVkaWNvID0gP1xyXG4gICAgICAgIEFORCBEQVRFKGZlY2hhX2hvcmFfaW5pY2lvKSBCRVRXRUVOID8gQU5EID9cclxuICAgICAgYCxcclxuICAgICAgW2lkTWVkaWNvLCBmZWNoYUluaWNpbywgZmVjaGFGaW5dXHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IHN0YXRzID0gZXN0YWRpc3RpY2FzWzBdO1xyXG5cclxuICAgIC8vIENhbGN1bGFyIGhvcmFzIGRpc3BvbmlibGVzICg4IGhvcmFzIHBvciBkw61hIGjDoWJpbClcclxuICAgIGNvbnN0IGRpYXNIYWJpbGVzID0gY2FsY3VsYXJEaWFzSGFiaWxlcyhmZWNoYUluaWNpbywgZmVjaGFGaW4pO1xyXG4gICAgY29uc3QgaG9yYXNfZGlzcG9uaWJsZXMgPSBkaWFzSGFiaWxlcyAqIDg7XHJcblxyXG4gICAgLy8gQ2FsY3VsYXIgdGFzYXNcclxuICAgIGNvbnN0IHRhc2FfYXNpc3RlbmNpYSA9XHJcbiAgICAgIHN0YXRzLnRvdGFsX2NpdGFzID4gMFxyXG4gICAgICAgID8gKHN0YXRzLmNvbXBsZXRhZGFzIC8gc3RhdHMudG90YWxfY2l0YXMpICogMTAwXHJcbiAgICAgICAgOiAwO1xyXG4gICAgY29uc3QgdGFzYV9jb25maXJtYWNpb24gPVxyXG4gICAgICBzdGF0cy50b3RhbF9jaXRhcyA+IDBcclxuICAgICAgICA/IChzdGF0cy50b3RhbF9jb25maXJtYWRhcyAvIHN0YXRzLnRvdGFsX2NpdGFzKSAqIDEwMFxyXG4gICAgICAgIDogMDtcclxuICAgIGNvbnN0IG9jdXBhY2lvbiA9XHJcbiAgICAgIGhvcmFzX2Rpc3BvbmlibGVzID4gMFxyXG4gICAgICAgID8gKHN0YXRzLmhvcmFzX2FnZW5kYWRhcyAvIGhvcmFzX2Rpc3BvbmlibGVzKSAqIDEwMFxyXG4gICAgICAgIDogMDtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0b3RhbF9jaXRhczogc3RhdHMudG90YWxfY2l0YXMgfHwgMCxcclxuICAgICAgY29uZmlybWFkYXM6IHN0YXRzLmNvbmZpcm1hZGFzIHx8IDAsXHJcbiAgICAgIHBlbmRpZW50ZXM6IHN0YXRzLnBlbmRpZW50ZXMgfHwgMCxcclxuICAgICAgY29tcGxldGFkYXM6IHN0YXRzLmNvbXBsZXRhZGFzIHx8IDAsXHJcbiAgICAgIGNhbmNlbGFkYXM6IHN0YXRzLmNhbmNlbGFkYXMgfHwgMCxcclxuICAgICAgbm9fYXNpc3Rpbzogc3RhdHMubm9fYXNpc3RpbyB8fCAwLFxyXG4gICAgICBlbl9zYWxhX2VzcGVyYTogc3RhdHMuZW5fc2FsYV9lc3BlcmEgfHwgMCxcclxuICAgICAgdGFzYV9hc2lzdGVuY2lhOiBwYXJzZUZsb2F0KHRhc2FfYXNpc3RlbmNpYS50b0ZpeGVkKDIpKSxcclxuICAgICAgdGFzYV9jb25maXJtYWNpb246IHBhcnNlRmxvYXQodGFzYV9jb25maXJtYWNpb24udG9GaXhlZCgyKSksXHJcbiAgICAgIGR1cmFjaW9uX3Byb21lZGlvOiBwYXJzZUZsb2F0KChzdGF0cy5kdXJhY2lvbl9wcm9tZWRpbyB8fCAwKS50b0ZpeGVkKDIpKSxcclxuICAgICAgdGllbXBvX3Byb21lZGlvX2VzcGVyYTogMCwgLy8gVE9ETzogSW1wbGVtZW50YXIgY8OhbGN1bG9cclxuICAgICAgaG9yYXNfYWdlbmRhZGFzOiBwYXJzZUZsb2F0KChzdGF0cy5ob3Jhc19hZ2VuZGFkYXMgfHwgMCkudG9GaXhlZCgyKSksXHJcbiAgICAgIGhvcmFzX2Rpc3BvbmlibGVzOiBob3Jhc19kaXNwb25pYmxlcyxcclxuICAgICAgb2N1cGFjaW9uOiBwYXJzZUZsb2F0KG9jdXBhY2lvbi50b0ZpeGVkKDIpKSxcclxuICAgICAgaW5ncmVzb3NfZXN0aW1hZG9zOiBwYXJzZUZsb2F0KHN0YXRzLmluZ3Jlc29zX2VzdGltYWRvcyB8fCAwKSxcclxuICAgICAgaW5ncmVzb3NfcmVhbGVzOiBwYXJzZUZsb2F0KHN0YXRzLmluZ3Jlc29zX3JlYWxlcyB8fCAwKSxcclxuICAgIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhbCBjYWxjdWxhciBlc3RhZMOtc3RpY2FzOlwiLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDYWxjdWxhIGTDrWFzIGjDoWJpbGVzIGVudHJlIGRvcyBmZWNoYXNcclxuICovXHJcbmZ1bmN0aW9uIGNhbGN1bGFyRGlhc0hhYmlsZXMoZmVjaGFJbmljaW86IHN0cmluZywgZmVjaGFGaW46IHN0cmluZyk6IG51bWJlciB7XHJcbiAgY29uc3QgaW5pY2lvID0gbmV3IERhdGUoZmVjaGFJbmljaW8pO1xyXG4gIGNvbnN0IGZpbiA9IG5ldyBEYXRlKGZlY2hhRmluKTtcclxuICBsZXQgZGlhcyA9IDA7XHJcblxyXG4gIGZvciAobGV0IGQgPSBuZXcgRGF0ZShpbmljaW8pOyBkIDw9IGZpbjsgZC5zZXREYXRlKGQuZ2V0RGF0ZSgpICsgMSkpIHtcclxuICAgIGNvbnN0IGRpYVNlbWFuYSA9IGQuZ2V0RGF5KCk7XHJcbiAgICBpZiAoZGlhU2VtYW5hICE9PSAwICYmIGRpYVNlbWFuYSAhPT0gNikge1xyXG4gICAgICAvLyBObyBlcyBkb21pbmdvIG5pIHPDoWJhZG9cclxuICAgICAgZGlhcysrO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGRpYXM7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBWYWxpZGEgZGlzcG9uaWJpbGlkYWQgcGFyYSB1bmEgbnVldmEgY2l0YVxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gdmFsaWRhckRpc3BvbmliaWxpZGFkKFxyXG4gIGlkTWVkaWNvOiBudW1iZXIsXHJcbiAgZmVjaGFJbmljaW86IHN0cmluZyxcclxuICBmZWNoYUZpbjogc3RyaW5nLFxyXG4gIGlkQ2l0YUV4Y2x1aXI/OiBudW1iZXJcclxuKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgdHJ5IHtcclxuICAgIGxldCBxdWVyeSA9IGBcclxuICAgICAgU0VMRUNUIENPVU5UKCopIGFzIGNvbmZsaWN0b3NcclxuICAgICAgRlJPTSBjaXRhc1xyXG4gICAgICBXSEVSRSBpZF9tZWRpY28gPSA/XHJcbiAgICAgICAgQU5EIGVzdGFkbyBOT1QgSU4gKCdjYW5jZWxhZGEnLCAnbm9fYXNpc3RpbycpXHJcbiAgICAgICAgQU5EIChcclxuICAgICAgICAgIChmZWNoYV9ob3JhX2luaWNpbyA8PSA/IEFORCBmZWNoYV9ob3JhX2ZpbiA+ID8pXHJcbiAgICAgICAgICBPUiAoZmVjaGFfaG9yYV9pbmljaW8gPCA/IEFORCBmZWNoYV9ob3JhX2ZpbiA+PSA/KVxyXG4gICAgICAgICAgT1IgKGZlY2hhX2hvcmFfaW5pY2lvID49ID8gQU5EIGZlY2hhX2hvcmFfZmluIDw9ID8pXHJcbiAgICAgICAgKVxyXG4gICAgYDtcclxuXHJcbiAgICBjb25zdCBwYXJhbXM6IGFueVtdID0gW1xyXG4gICAgICBpZE1lZGljbyxcclxuICAgICAgZmVjaGFJbmljaW8sXHJcbiAgICAgIGZlY2hhSW5pY2lvLFxyXG4gICAgICBmZWNoYUZpbixcclxuICAgICAgZmVjaGFGaW4sXHJcbiAgICAgIGZlY2hhSW5pY2lvLFxyXG4gICAgICBmZWNoYUZpbixcclxuICAgIF07XHJcblxyXG4gICAgaWYgKGlkQ2l0YUV4Y2x1aXIpIHtcclxuICAgICAgcXVlcnkgKz0gYCBBTkQgaWRfY2l0YSAhPSA/YDtcclxuICAgICAgcGFyYW1zLnB1c2goaWRDaXRhRXhjbHVpcik7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgW3Jvd3NdID0gYXdhaXQgcG9vbC5xdWVyeTxSb3dEYXRhUGFja2V0W10+KHF1ZXJ5LCBwYXJhbXMpO1xyXG5cclxuICAgIHJldHVybiByb3dzWzBdLmNvbmZsaWN0b3MgPT09IDA7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhbCB2YWxpZGFyIGRpc3BvbmliaWxpZGFkOlwiLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn1cclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gSEFORExFUiBHRVQgLSBPYnRlbmVyIGNpdGFzXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICB0cnkge1xyXG4gICAgLy8gMS4gT2J0ZW5lciB0b2tlblxyXG4gICAgY29uc3Qgc2Vzc2lvblRva2VuID0gZ2V0U2Vzc2lvblRva2VuKHJlcXVlc3QpO1xyXG5cclxuICAgIGlmICghc2Vzc2lvblRva2VuKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIGVycm9yOiBcIk5vIGhheSBzZXNpw7NuIGFjdGl2YVwiLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gMi4gVmVyaWZpY2FyIHNlc2nDs25cclxuICAgIGNvbnN0IFtzZXNpb25lc10gPSBhd2FpdCBwb29sLnF1ZXJ5PFJvd0RhdGFQYWNrZXRbXT4oXHJcbiAgICAgIGBcclxuICAgICAgU0VMRUNUIHN1LmlkX3VzdWFyaW9cclxuICAgICAgRlJPTSBzZXNpb25lc191c3VhcmlvcyBzdVxyXG4gICAgICBJTk5FUiBKT0lOIHVzdWFyaW9zIHUgT04gc3UuaWRfdXN1YXJpbyA9IHUuaWRfdXN1YXJpb1xyXG4gICAgICBXSEVSRSBzdS50b2tlbiA9ID9cclxuICAgICAgICBBTkQgc3UuYWN0aXZhID0gMVxyXG4gICAgICAgIEFORCBzdS5mZWNoYV9leHBpcmFjaW9uID4gTk9XKClcclxuICAgICAgICBBTkQgdS5lc3RhZG8gPSAnYWN0aXZvJ1xyXG4gICAgICBMSU1JVCAxXHJcbiAgICAgIGAsXHJcbiAgICAgIFtzZXNzaW9uVG9rZW5dXHJcbiAgICApO1xyXG5cclxuICAgIGlmIChzZXNpb25lcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6IFwiU2VzacOzbiBpbnbDoWxpZGEgbyBleHBpcmFkYVwiLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgaWRVc3VhcmlvID0gc2VzaW9uZXNbMF0uaWRfdXN1YXJpbztcclxuXHJcbiAgICAvLyAzLiBWZXJpZmljYXIgcXVlIHNlYSBtw6lkaWNvXHJcbiAgICBjb25zdCBtZWRpY28gPSBhd2FpdCBvYnRlbmVyTWVkaWNvQXV0ZW50aWNhZG8oaWRVc3VhcmlvKTtcclxuXHJcbiAgICBpZiAoIW1lZGljbykge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogXCJObyB0aWVuZXMgdW4gcmVnaXN0cm8gZGUgbcOpZGljbyBhY3Rpdm9cIixcclxuICAgICAgICB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDMgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIDQuIE9idGVuZXIgcGFyw6FtZXRyb3MgZGUgY29uc3VsdGFcclxuICAgIGNvbnN0IHNlYXJjaFBhcmFtcyA9IHJlcXVlc3QubmV4dFVybC5zZWFyY2hQYXJhbXM7XHJcbiAgICBjb25zdCBmZWNoYUluaWNpbyA9IHNlYXJjaFBhcmFtcy5nZXQoXCJmZWNoYV9pbmljaW9cIikgfHwgbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KFwiVFwiKVswXTtcclxuICAgIGNvbnN0IGZlY2hhRmluID0gc2VhcmNoUGFyYW1zLmdldChcImZlY2hhX2ZpblwiKSB8fCBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoXCJUXCIpWzBdO1xyXG4gICAgY29uc3QgZXN0YWRvcyA9IHNlYXJjaFBhcmFtcy5nZXQoXCJlc3RhZG9zXCIpPy5zcGxpdChcIixcIik7XHJcbiAgICBjb25zdCB0aXBvcyA9IHNlYXJjaFBhcmFtcy5nZXQoXCJ0aXBvc1wiKT8uc3BsaXQoXCIsXCIpO1xyXG4gICAgY29uc3QgcGFjaWVudGUgPSBzZWFyY2hQYXJhbXMuZ2V0KFwicGFjaWVudGVcIikgfHwgXCJcIjtcclxuXHJcbiAgICAvLyA1LiBBY3R1YWxpemFyIMO6bHRpbWEgYWN0aXZpZGFkXHJcbiAgICBhd2FpdCBwb29sLnF1ZXJ5KFxyXG4gICAgICBgVVBEQVRFIHNlc2lvbmVzX3VzdWFyaW9zIFNFVCB1bHRpbWFfYWN0aXZpZGFkID0gTk9XKCkgV0hFUkUgdG9rZW4gPSA/YCxcclxuICAgICAgW3Nlc3Npb25Ub2tlbl1cclxuICAgICk7XHJcblxyXG4gICAgLy8gNi4gT2J0ZW5lciBkYXRvc1xyXG4gICAgY29uc3QgW2NpdGFzLCBibG9xdWVzSG9yYXJpb3MsIGVzdGFkaXN0aWNhc10gPSBhd2FpdCBQcm9taXNlLmFsbChbXHJcbiAgICAgIG9idGVuZXJDaXRhcyhtZWRpY28uaWRfbWVkaWNvLCBmZWNoYUluaWNpbywgZmVjaGFGaW4sIGVzdGFkb3MsIHRpcG9zLCBwYWNpZW50ZSksXHJcbiAgICAgIG9idGVuZXJCbG9xdWVzSG9yYXJpb3MobWVkaWNvLmlkX21lZGljbywgZmVjaGFJbmljaW8sIGZlY2hhRmluKSxcclxuICAgICAgY2FsY3VsYXJFc3RhZGlzdGljYXMobWVkaWNvLmlkX21lZGljbywgZmVjaGFJbmljaW8sIGZlY2hhRmluKSxcclxuICAgIF0pO1xyXG5cclxuICAgIC8vIDcuIFJlc3B1ZXN0YSBleGl0b3NhXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgIHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIGNpdGFzLFxyXG4gICAgICAgIGJsb3F1ZXNfaG9yYXJpb3M6IGJsb3F1ZXNIb3JhcmlvcyxcclxuICAgICAgICBlc3RhZGlzdGljYXMsXHJcbiAgICAgICAgZmlsdHJvczoge1xyXG4gICAgICAgICAgZmVjaGFfaW5pY2lvOiBmZWNoYUluaWNpbyxcclxuICAgICAgICAgIGZlY2hhX2ZpbjogZmVjaGFGaW4sXHJcbiAgICAgICAgICBlc3RhZG9zOiBlc3RhZG9zIHx8IFtdLFxyXG4gICAgICAgICAgdGlwb3M6IHRpcG9zIHx8IFtdLFxyXG4gICAgICAgICAgcGFjaWVudGU6IHBhY2llbnRlIHx8IFwiXCIsXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgfSxcclxuICAgICAgeyBzdGF0dXM6IDIwMCB9XHJcbiAgICApO1xyXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgRXJyb3IgZW4gR0VUIC9hcGkvbWVkaWNvL2FnZW5kYTpcIiwgZXJyb3IpO1xyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiBcIkVycm9yIGludGVybm8gZGVsIHNlcnZpZG9yXCIsXHJcbiAgICAgICAgZGV0YWlsczpcclxuICAgICAgICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcImRldmVsb3BtZW50XCIgPyBlcnJvci5tZXNzYWdlIDogdW5kZWZpbmVkLFxyXG4gICAgICB9LFxyXG4gICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIEhBTkRMRVIgUE9TVCAtIENyZWFyIG51ZXZhIGNpdGFcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICB0cnkge1xyXG4gICAgLy8gMS4gT2J0ZW5lciB0b2tlblxyXG4gICAgY29uc3Qgc2Vzc2lvblRva2VuID0gZ2V0U2Vzc2lvblRva2VuKHJlcXVlc3QpO1xyXG5cclxuICAgIGlmICghc2Vzc2lvblRva2VuKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIGVycm9yOiBcIk5vIGhheSBzZXNpw7NuIGFjdGl2YVwiLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gMi4gVmVyaWZpY2FyIHNlc2nDs25cclxuICAgIGNvbnN0IFtzZXNpb25lc10gPSBhd2FpdCBwb29sLnF1ZXJ5PFJvd0RhdGFQYWNrZXRbXT4oXHJcbiAgICAgIGBcclxuICAgICAgU0VMRUNUIHN1LmlkX3VzdWFyaW9cclxuICAgICAgRlJPTSBzZXNpb25lc191c3VhcmlvcyBzdVxyXG4gICAgICBJTk5FUiBKT0lOIHVzdWFyaW9zIHUgT04gc3UuaWRfdXN1YXJpbyA9IHUuaWRfdXN1YXJpb1xyXG4gICAgICBXSEVSRSBzdS50b2tlbiA9ID9cclxuICAgICAgICBBTkQgc3UuYWN0aXZhID0gMVxyXG4gICAgICAgIEFORCBzdS5mZWNoYV9leHBpcmFjaW9uID4gTk9XKClcclxuICAgICAgICBBTkQgdS5lc3RhZG8gPSAnYWN0aXZvJ1xyXG4gICAgICBMSU1JVCAxXHJcbiAgICAgIGAsXHJcbiAgICAgIFtzZXNzaW9uVG9rZW5dXHJcbiAgICApO1xyXG5cclxuICAgIGlmIChzZXNpb25lcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6IFwiU2VzacOzbiBpbnbDoWxpZGEgbyBleHBpcmFkYVwiLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgaWRVc3VhcmlvID0gc2VzaW9uZXNbMF0uaWRfdXN1YXJpbztcclxuXHJcbiAgICAvLyAzLiBWZXJpZmljYXIgcXVlIHNlYSBtw6lkaWNvXHJcbiAgICBjb25zdCBtZWRpY28gPSBhd2FpdCBvYnRlbmVyTWVkaWNvQXV0ZW50aWNhZG8oaWRVc3VhcmlvKTtcclxuXHJcbiAgICBpZiAoIW1lZGljbykge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogXCJObyB0aWVuZXMgdW4gcmVnaXN0cm8gZGUgbcOpZGljbyBhY3Rpdm9cIixcclxuICAgICAgICB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDMgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIDQuIE9idGVuZXIgZGF0b3MgZGVsIGJvZHlcclxuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKTtcclxuXHJcbiAgICBjb25zdCB7XHJcbiAgICAgIGlkX3BhY2llbnRlLFxyXG4gICAgICBmZWNoYV9ob3JhX2luaWNpbyxcclxuICAgICAgZHVyYWNpb25fbWludXRvcyA9IDMwLFxyXG4gICAgICB0aXBvX2NpdGEgPSBcImNvbnRyb2xcIixcclxuICAgICAgbW90aXZvLFxyXG4gICAgICBub3RhcyxcclxuICAgICAgaWRfZXNwZWNpYWxpZGFkLFxyXG4gICAgICBpZF9zYWxhLFxyXG4gICAgICBwcmlvcmlkYWQgPSBcIm5vcm1hbFwiLFxyXG4gICAgICBvcmlnZW4gPSBcIndlYlwiLFxyXG4gICAgICBtb250byxcclxuICAgIH0gPSBib2R5O1xyXG5cclxuICAgIC8vIDUuIFZhbGlkYXIgZGF0b3MgcmVxdWVyaWRvc1xyXG4gICAgaWYgKCFpZF9wYWNpZW50ZSB8fCAhZmVjaGFfaG9yYV9pbmljaW8pIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6IFwiRmFsdGFuIGRhdG9zIHJlcXVlcmlkb3NcIixcclxuICAgICAgICB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIDYuIENhbGN1bGFyIGZlY2hhIGRlIGZpblxyXG4gICAgY29uc3QgZmVjaGFJbmljaW8gPSBuZXcgRGF0ZShmZWNoYV9ob3JhX2luaWNpbyk7XHJcbiAgICBjb25zdCBmZWNoYUZpbiA9IG5ldyBEYXRlKGZlY2hhSW5pY2lvLmdldFRpbWUoKSArIGR1cmFjaW9uX21pbnV0b3MgKiA2MDAwMCk7XHJcblxyXG4gICAgLy8gNy4gVmFsaWRhciBkaXNwb25pYmlsaWRhZFxyXG4gICAgY29uc3QgZGlzcG9uaWJsZSA9IGF3YWl0IHZhbGlkYXJEaXNwb25pYmlsaWRhZChcclxuICAgICAgbWVkaWNvLmlkX21lZGljbyxcclxuICAgICAgZmVjaGFJbmljaW8udG9JU09TdHJpbmcoKSxcclxuICAgICAgZmVjaGFGaW4udG9JU09TdHJpbmcoKVxyXG4gICAgKTtcclxuXHJcbiAgICBpZiAoIWRpc3BvbmlibGUpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6IFwiRWwgaG9yYXJpbyBzZWxlY2Npb25hZG8gbm8gZXN0w6EgZGlzcG9uaWJsZVwiLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwOSB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gOC4gSW5zZXJ0YXIgY2l0YVxyXG4gICAgY29uc3QgW3Jlc3VsdF0gPSBhd2FpdCBwb29sLnF1ZXJ5PFJlc3VsdFNldEhlYWRlcj4oXHJcbiAgICAgIGBcclxuICAgICAgSU5TRVJUIElOVE8gY2l0YXMgKFxyXG4gICAgICAgIGlkX3BhY2llbnRlLFxyXG4gICAgICAgIGlkX21lZGljbyxcclxuICAgICAgICBpZF9jZW50cm8sXHJcbiAgICAgICAgaWRfc3VjdXJzYWwsXHJcbiAgICAgICAgZmVjaGFfaG9yYV9pbmljaW8sXHJcbiAgICAgICAgZmVjaGFfaG9yYV9maW4sXHJcbiAgICAgICAgZHVyYWNpb25fbWludXRvcyxcclxuICAgICAgICB0aXBvX2NpdGEsXHJcbiAgICAgICAgbW90aXZvLFxyXG4gICAgICAgIGVzdGFkbyxcclxuICAgICAgICBwcmlvcmlkYWQsXHJcbiAgICAgICAgaWRfZXNwZWNpYWxpZGFkLFxyXG4gICAgICAgIG9yaWdlbixcclxuICAgICAgICBwYWdhZGEsXHJcbiAgICAgICAgbW9udG8sXHJcbiAgICAgICAgaWRfc2FsYSxcclxuICAgICAgICBub3RhcyxcclxuICAgICAgICBjcmVhZG9fcG9yXHJcbiAgICAgICkgVkFMVUVTICg/LCA/LCA/LCBOVUxMLCA/LCA/LCA/LCA/LCA/LCAncHJvZ3JhbWFkYScsID8sID8sID8sIDAsID8sID8sID8sID8pXHJcbiAgICAgIGAsXHJcbiAgICAgIFtcclxuICAgICAgICBpZF9wYWNpZW50ZSxcclxuICAgICAgICBtZWRpY28uaWRfbWVkaWNvLFxyXG4gICAgICAgIG1lZGljby5pZF9jZW50cm9fcHJpbmNpcGFsLFxyXG4gICAgICAgIGZlY2hhSW5pY2lvLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgZmVjaGFGaW4udG9JU09TdHJpbmcoKSxcclxuICAgICAgICBkdXJhY2lvbl9taW51dG9zLFxyXG4gICAgICAgIHRpcG9fY2l0YSxcclxuICAgICAgICBtb3Rpdm8gfHwgbnVsbCxcclxuICAgICAgICBwcmlvcmlkYWQsXHJcbiAgICAgICAgaWRfZXNwZWNpYWxpZGFkIHx8IG51bGwsXHJcbiAgICAgICAgb3JpZ2VuLFxyXG4gICAgICAgIG1vbnRvIHx8IG51bGwsXHJcbiAgICAgICAgaWRfc2FsYSB8fCBudWxsLFxyXG4gICAgICAgIG5vdGFzIHx8IG51bGwsXHJcbiAgICAgICAgaWRVc3VhcmlvLFxyXG4gICAgICBdXHJcbiAgICApO1xyXG5cclxuICAgIC8vIDkuIE9idGVuZXIgbGEgY2l0YSBjcmVhZGFcclxuICAgIGNvbnN0IFtjaXRhTnVldmFdID0gYXdhaXQgcG9vbC5xdWVyeTxSb3dEYXRhUGFja2V0W10+KFxyXG4gICAgICBgU0VMRUNUICogRlJPTSBjaXRhcyBXSEVSRSBpZF9jaXRhID0gP2AsXHJcbiAgICAgIFtyZXN1bHQuaW5zZXJ0SWRdXHJcbiAgICApO1xyXG5cclxuICAgIC8vIDEwLiBSZXNwdWVzdGEgZXhpdG9zYVxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBtZXNzYWdlOiBcIkNpdGEgY3JlYWRhIGV4aXRvc2FtZW50ZVwiLFxyXG4gICAgICAgIGNpdGE6IGNpdGFOdWV2YVswXSxcclxuICAgICAgICBpZF9jaXRhOiByZXN1bHQuaW5zZXJ0SWQsXHJcbiAgICAgIH0sXHJcbiAgICAgIHsgc3RhdHVzOiAyMDEgfVxyXG4gICAgKTtcclxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwi4p2MIEVycm9yIGVuIFBPU1QgL2FwaS9tZWRpY28vYWdlbmRhOlwiLCBlcnJvcik7XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IFwiRXJyb3IgaW50ZXJubyBkZWwgc2Vydmlkb3JcIixcclxuICAgICAgICBkZXRhaWxzOlxyXG4gICAgICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwiZGV2ZWxvcG1lbnRcIiA/IGVycm9yLm1lc3NhZ2UgOiB1bmRlZmluZWQsXHJcbiAgICAgIH0sXHJcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gSEFORExFUiBQVVQgLSBBY3R1YWxpemFyIGNpdGFcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBVVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xyXG4gIHRyeSB7XHJcbiAgICAvLyAxLiBPYnRlbmVyIHRva2VuXHJcbiAgICBjb25zdCBzZXNzaW9uVG9rZW4gPSBnZXRTZXNzaW9uVG9rZW4ocmVxdWVzdCk7XHJcblxyXG4gICAgaWYgKCFzZXNzaW9uVG9rZW4pIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6IFwiTm8gaGF5IHNlc2nDs24gYWN0aXZhXCIsXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7IHN0YXR1czogNDAxIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyAyLiBWZXJpZmljYXIgc2VzacOzblxyXG4gICAgY29uc3QgW3Nlc2lvbmVzXSA9IGF3YWl0IHBvb2wucXVlcnk8Um93RGF0YVBhY2tldFtdPihcclxuICAgICAgYFxyXG4gICAgICBTRUxFQ1Qgc3UuaWRfdXN1YXJpb1xyXG4gICAgICBGUk9NIHNlc2lvbmVzX3VzdWFyaW9zIHN1XHJcbiAgICAgIElOTkVSIEpPSU4gdXN1YXJpb3MgdSBPTiBzdS5pZF91c3VhcmlvID0gdS5pZF91c3VhcmlvXHJcbiAgICAgIFdIRVJFIHN1LnRva2VuID0gP1xyXG4gICAgICAgIEFORCBzdS5hY3RpdmEgPSAxXHJcbiAgICAgICAgQU5EIHN1LmZlY2hhX2V4cGlyYWNpb24gPiBOT1coKVxyXG4gICAgICAgIEFORCB1LmVzdGFkbyA9ICdhY3Rpdm8nXHJcbiAgICAgIExJTUlUIDFcclxuICAgICAgYCxcclxuICAgICAgW3Nlc3Npb25Ub2tlbl1cclxuICAgICk7XHJcblxyXG4gICAgaWYgKHNlc2lvbmVzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogXCJTZXNpw7NuIGludsOhbGlkYSBvIGV4cGlyYWRhXCIsXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7IHN0YXR1czogNDAxIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBpZFVzdWFyaW8gPSBzZXNpb25lc1swXS5pZF91c3VhcmlvO1xyXG5cclxuICAgIC8vIDMuIFZlcmlmaWNhciBxdWUgc2VhIG3DqWRpY29cclxuICAgIGNvbnN0IG1lZGljbyA9IGF3YWl0IG9idGVuZXJNZWRpY29BdXRlbnRpY2FkbyhpZFVzdWFyaW8pO1xyXG5cclxuICAgIGlmICghbWVkaWNvKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIGVycm9yOiBcIk5vIHRpZW5lcyB1biByZWdpc3RybyBkZSBtw6lkaWNvIGFjdGl2b1wiLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMyB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gNC4gT2J0ZW5lciBkYXRvcyBkZWwgYm9keVxyXG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xyXG5cclxuICAgIGNvbnN0IHtcclxuICAgICAgaWRfY2l0YSxcclxuICAgICAgZmVjaGFfaG9yYV9pbmljaW8sXHJcbiAgICAgIGR1cmFjaW9uX21pbnV0b3MsXHJcbiAgICAgIHRpcG9fY2l0YSxcclxuICAgICAgbW90aXZvLFxyXG4gICAgICBub3RhcyxcclxuICAgICAgZXN0YWRvLFxyXG4gICAgICBwcmlvcmlkYWQsXHJcbiAgICAgIGlkX2VzcGVjaWFsaWRhZCxcclxuICAgICAgaWRfc2FsYSxcclxuICAgICAgbW9udG8sXHJcbiAgICB9ID0gYm9keTtcclxuXHJcbiAgICAvLyA1LiBWYWxpZGFyIHF1ZSBsYSBjaXRhIGV4aXN0ZSB5IHBlcnRlbmVjZSBhbCBtw6lkaWNvXHJcbiAgICBjb25zdCBbY2l0YUFjdHVhbF0gPSBhd2FpdCBwb29sLnF1ZXJ5PFJvd0RhdGFQYWNrZXRbXT4oXHJcbiAgICAgIGBTRUxFQ1QgKiBGUk9NIGNpdGFzIFdIRVJFIGlkX2NpdGEgPSA/IEFORCBpZF9tZWRpY28gPSA/YCxcclxuICAgICAgW2lkX2NpdGEsIG1lZGljby5pZF9tZWRpY29dXHJcbiAgICApO1xyXG5cclxuICAgIGlmIChjaXRhQWN0dWFsLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogXCJDaXRhIG5vIGVuY29udHJhZGFcIixcclxuICAgICAgICB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDQgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIDYuIFNpIHNlIGNhbWJpYSBlbCBob3JhcmlvLCB2YWxpZGFyIGRpc3BvbmliaWxpZGFkXHJcbiAgICBpZiAoZmVjaGFfaG9yYV9pbmljaW8gfHwgZHVyYWNpb25fbWludXRvcykge1xyXG4gICAgICBjb25zdCBmZWNoYUluaWNpbyA9IGZlY2hhX2hvcmFfaW5pY2lvXHJcbiAgICAgICAgPyBuZXcgRGF0ZShmZWNoYV9ob3JhX2luaWNpbylcclxuICAgICAgICA6IG5ldyBEYXRlKGNpdGFBY3R1YWxbMF0uZmVjaGFfaG9yYV9pbmljaW8pO1xyXG4gICAgICBjb25zdCBkdXJhY2lvbiA9IGR1cmFjaW9uX21pbnV0b3MgfHwgY2l0YUFjdHVhbFswXS5kdXJhY2lvbl9taW51dG9zO1xyXG4gICAgICBjb25zdCBmZWNoYUZpbiA9IG5ldyBEYXRlKGZlY2hhSW5pY2lvLmdldFRpbWUoKSArIGR1cmFjaW9uICogNjAwMDApO1xyXG5cclxuICAgICAgY29uc3QgZGlzcG9uaWJsZSA9IGF3YWl0IHZhbGlkYXJEaXNwb25pYmlsaWRhZChcclxuICAgICAgICBtZWRpY28uaWRfbWVkaWNvLFxyXG4gICAgICAgIGZlY2hhSW5pY2lvLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgZmVjaGFGaW4udG9JU09TdHJpbmcoKSxcclxuICAgICAgICBpZF9jaXRhXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBpZiAoIWRpc3BvbmlibGUpIHtcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBlcnJvcjogXCJFbCBob3JhcmlvIHNlbGVjY2lvbmFkbyBubyBlc3TDoSBkaXNwb25pYmxlXCIsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgeyBzdGF0dXM6IDQwOSB9XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIDcuIENvbnN0cnVpciBxdWVyeSBkZSBhY3R1YWxpemFjacOzblxyXG4gICAgY29uc3QgdXBkYXRlczogc3RyaW5nW10gPSBbXTtcclxuICAgIGNvbnN0IHBhcmFtczogYW55W10gPSBbXTtcclxuXHJcbiAgICBpZiAoZmVjaGFfaG9yYV9pbmljaW8pIHtcclxuICAgICAgdXBkYXRlcy5wdXNoKFwiZmVjaGFfaG9yYV9pbmljaW8gPSA/XCIpO1xyXG4gICAgICBwYXJhbXMucHVzaChmZWNoYV9ob3JhX2luaWNpbyk7XHJcblxyXG4gICAgICBjb25zdCBkdXJhY2lvbiA9IGR1cmFjaW9uX21pbnV0b3MgfHwgY2l0YUFjdHVhbFswXS5kdXJhY2lvbl9taW51dG9zO1xyXG4gICAgICBjb25zdCBmZWNoYUZpbiA9IG5ldyBEYXRlKFxyXG4gICAgICAgIG5ldyBEYXRlKGZlY2hhX2hvcmFfaW5pY2lvKS5nZXRUaW1lKCkgKyBkdXJhY2lvbiAqIDYwMDAwXHJcbiAgICAgICk7XHJcbiAgICAgIHVwZGF0ZXMucHVzaChcImZlY2hhX2hvcmFfZmluID0gP1wiKTtcclxuICAgICAgcGFyYW1zLnB1c2goZmVjaGFGaW4udG9JU09TdHJpbmcoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGR1cmFjaW9uX21pbnV0b3MpIHtcclxuICAgICAgdXBkYXRlcy5wdXNoKFwiZHVyYWNpb25fbWludXRvcyA9ID9cIik7XHJcbiAgICAgIHBhcmFtcy5wdXNoKGR1cmFjaW9uX21pbnV0b3MpO1xyXG5cclxuICAgICAgaWYgKCFmZWNoYV9ob3JhX2luaWNpbykge1xyXG4gICAgICAgIGNvbnN0IGZlY2hhRmluID0gbmV3IERhdGUoXHJcbiAgICAgICAgICBuZXcgRGF0ZShjaXRhQWN0dWFsWzBdLmZlY2hhX2hvcmFfaW5pY2lvKS5nZXRUaW1lKCkgK1xyXG4gICAgICAgICAgICBkdXJhY2lvbl9taW51dG9zICogNjAwMDBcclxuICAgICAgICApO1xyXG4gICAgICAgIHVwZGF0ZXMucHVzaChcImZlY2hhX2hvcmFfZmluID0gP1wiKTtcclxuICAgICAgICBwYXJhbXMucHVzaChmZWNoYUZpbi50b0lTT1N0cmluZygpKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aXBvX2NpdGEpIHtcclxuICAgICAgdXBkYXRlcy5wdXNoKFwidGlwb19jaXRhID0gP1wiKTtcclxuICAgICAgcGFyYW1zLnB1c2godGlwb19jaXRhKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAobW90aXZvICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlcy5wdXNoKFwibW90aXZvID0gP1wiKTtcclxuICAgICAgcGFyYW1zLnB1c2gobW90aXZvKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAobm90YXMgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVzLnB1c2goXCJub3RhcyA9ID9cIik7XHJcbiAgICAgIHBhcmFtcy5wdXNoKG5vdGFzKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZXN0YWRvKSB7XHJcbiAgICAgIHVwZGF0ZXMucHVzaChcImVzdGFkbyA9ID9cIik7XHJcbiAgICAgIHBhcmFtcy5wdXNoKGVzdGFkbyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHByaW9yaWRhZCkge1xyXG4gICAgICB1cGRhdGVzLnB1c2goXCJwcmlvcmlkYWQgPSA/XCIpO1xyXG4gICAgICBwYXJhbXMucHVzaChwcmlvcmlkYWQpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChpZF9lc3BlY2lhbGlkYWQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVzLnB1c2goXCJpZF9lc3BlY2lhbGlkYWQgPSA/XCIpO1xyXG4gICAgICBwYXJhbXMucHVzaChpZF9lc3BlY2lhbGlkYWQpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChpZF9zYWxhICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlcy5wdXNoKFwiaWRfc2FsYSA9ID9cIik7XHJcbiAgICAgIHBhcmFtcy5wdXNoKGlkX3NhbGEpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChtb250byAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZXMucHVzaChcIm1vbnRvID0gP1wiKTtcclxuICAgICAgcGFyYW1zLnB1c2gobW9udG8pO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZXMucHVzaChcIm1vZGlmaWNhZG9fcG9yID0gP1wiKTtcclxuICAgIHBhcmFtcy5wdXNoKGlkVXN1YXJpbyk7XHJcblxyXG4gICAgcGFyYW1zLnB1c2goaWRfY2l0YSk7XHJcblxyXG4gICAgLy8gOC4gRWplY3V0YXIgYWN0dWFsaXphY2nDs25cclxuICAgIGF3YWl0IHBvb2wucXVlcnkoXHJcbiAgICAgIGBVUERBVEUgY2l0YXMgU0VUICR7dXBkYXRlcy5qb2luKFwiLCBcIil9IFdIRVJFIGlkX2NpdGEgPSA/YCxcclxuICAgICAgcGFyYW1zXHJcbiAgICApO1xyXG5cclxuICAgIC8vIDkuIE9idGVuZXIgY2l0YSBhY3R1YWxpemFkYVxyXG4gICAgY29uc3QgW2NpdGFBY3R1YWxpemFkYV0gPSBhd2FpdCBwb29sLnF1ZXJ5PFJvd0RhdGFQYWNrZXRbXT4oXHJcbiAgICAgIGBTRUxFQ1QgKiBGUk9NIGNpdGFzIFdIRVJFIGlkX2NpdGEgPSA/YCxcclxuICAgICAgW2lkX2NpdGFdXHJcbiAgICApO1xyXG5cclxuICAgIC8vIDEwLiBSZXNwdWVzdGEgZXhpdG9zYVxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBtZXNzYWdlOiBcIkNpdGEgYWN0dWFsaXphZGEgZXhpdG9zYW1lbnRlXCIsXHJcbiAgICAgICAgY2l0YTogY2l0YUFjdHVhbGl6YWRhWzBdLFxyXG4gICAgICB9LFxyXG4gICAgICB7IHN0YXR1czogMjAwIH1cclxuICAgICk7XHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcihcIuKdjCBFcnJvciBlbiBQVVQgL2FwaS9tZWRpY28vYWdlbmRhOlwiLCBlcnJvcik7XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IFwiRXJyb3IgaW50ZXJubyBkZWwgc2Vydmlkb3JcIixcclxuICAgICAgICBkZXRhaWxzOlxyXG4gICAgICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwiZGV2ZWxvcG1lbnRcIiA/IGVycm9yLm1lc3NhZ2UgOiB1bmRlZmluZWQsXHJcbiAgICAgIH0sXHJcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gSEFORExFUiBERUxFVEUgLSBDYW5jZWxhciBjaXRhXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBERUxFVEUocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICB0cnkge1xyXG4gICAgLy8gMS4gT2J0ZW5lciB0b2tlblxyXG4gICAgY29uc3Qgc2Vzc2lvblRva2VuID0gZ2V0U2Vzc2lvblRva2VuKHJlcXVlc3QpO1xyXG5cclxuICAgIGlmICghc2Vzc2lvblRva2VuKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIGVycm9yOiBcIk5vIGhheSBzZXNpw7NuIGFjdGl2YVwiLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gMi4gVmVyaWZpY2FyIHNlc2nDs25cclxuICAgIGNvbnN0IFtzZXNpb25lc10gPSBhd2FpdCBwb29sLnF1ZXJ5PFJvd0RhdGFQYWNrZXRbXT4oXHJcbiAgICAgIGBcclxuICAgICAgU0VMRUNUIHN1LmlkX3VzdWFyaW9cclxuICAgICAgRlJPTSBzZXNpb25lc191c3VhcmlvcyBzdVxyXG4gICAgICBJTk5FUiBKT0lOIHVzdWFyaW9zIHUgT04gc3UuaWRfdXN1YXJpbyA9IHUuaWRfdXN1YXJpb1xyXG4gICAgICBXSEVSRSBzdS50b2tlbiA9ID9cclxuICAgICAgICBBTkQgc3UuYWN0aXZhID0gMVxyXG4gICAgICAgIEFORCBzdS5mZWNoYV9leHBpcmFjaW9uID4gTk9XKClcclxuICAgICAgICBBTkQgdS5lc3RhZG8gPSAnYWN0aXZvJ1xyXG4gICAgICBMSU1JVCAxXHJcbiAgICAgIGAsXHJcbiAgICAgIFtzZXNzaW9uVG9rZW5dXHJcbiAgICApO1xyXG5cclxuICAgIGlmIChzZXNpb25lcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6IFwiU2VzacOzbiBpbnbDoWxpZGEgbyBleHBpcmFkYVwiLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgaWRVc3VhcmlvID0gc2VzaW9uZXNbMF0uaWRfdXN1YXJpbztcclxuXHJcbiAgICAvLyAzLiBWZXJpZmljYXIgcXVlIHNlYSBtw6lkaWNvXHJcbiAgICBjb25zdCBtZWRpY28gPSBhd2FpdCBvYnRlbmVyTWVkaWNvQXV0ZW50aWNhZG8oaWRVc3VhcmlvKTtcclxuXHJcbiAgICBpZiAoIW1lZGljbykge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogXCJObyB0aWVuZXMgdW4gcmVnaXN0cm8gZGUgbcOpZGljbyBhY3Rpdm9cIixcclxuICAgICAgICB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDMgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIDQuIE9idGVuZXIgcGFyw6FtZXRyb3NcclxuICAgIGNvbnN0IHNlYXJjaFBhcmFtcyA9IHJlcXVlc3QubmV4dFVybC5zZWFyY2hQYXJhbXM7XHJcbiAgICBjb25zdCBpZENpdGEgPSBzZWFyY2hQYXJhbXMuZ2V0KFwiaWRfY2l0YVwiKTtcclxuICAgIGNvbnN0IG1vdGl2byA9IHNlYXJjaFBhcmFtcy5nZXQoXCJtb3Rpdm9cIikgfHwgXCJDYW5jZWxhZGEgcG9yIGVsIG3DqWRpY29cIjtcclxuXHJcbiAgICBpZiAoIWlkQ2l0YSkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogXCJJRCBkZSBjaXRhIHJlcXVlcmlkb1wiLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gNS4gVmFsaWRhciBxdWUgbGEgY2l0YSBleGlzdGUgeSBwZXJ0ZW5lY2UgYWwgbcOpZGljb1xyXG4gICAgY29uc3QgW2NpdGFdID0gYXdhaXQgcG9vbC5xdWVyeTxSb3dEYXRhUGFja2V0W10+KFxyXG4gICAgICBgU0VMRUNUICogRlJPTSBjaXRhcyBXSEVSRSBpZF9jaXRhID0gPyBBTkQgaWRfbWVkaWNvID0gP2AsXHJcbiAgICAgIFtpZENpdGEsIG1lZGljby5pZF9tZWRpY29dXHJcbiAgICApO1xyXG5cclxuICAgIGlmIChjaXRhLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogXCJDaXRhIG5vIGVuY29udHJhZGFcIixcclxuICAgICAgICB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDQgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIDYuIEFjdHVhbGl6YXIgZXN0YWRvIGRlIGxhIGNpdGFcclxuICAgIGF3YWl0IHBvb2wucXVlcnkoXHJcbiAgICAgIGBVUERBVEUgY2l0YXMgU0VUIGVzdGFkbyA9ICdjYW5jZWxhZGEnLCBtb2RpZmljYWRvX3BvciA9ID8gV0hFUkUgaWRfY2l0YSA9ID9gLFxyXG4gICAgICBbaWRVc3VhcmlvLCBpZENpdGFdXHJcbiAgICApO1xyXG5cclxuICAgIC8vIDcuIFJlZ2lzdHJhciBsYSBjYW5jZWxhY2nDs25cclxuICAgIGF3YWl0IHBvb2wucXVlcnkoXHJcbiAgICAgIGBcclxuICAgICAgSU5TRVJUIElOVE8gY2FuY2VsYWNpb25lcyAoXHJcbiAgICAgICAgaWRfY2l0YSxcclxuICAgICAgICBmZWNoYV9jYW5jZWxhY2lvbixcclxuICAgICAgICBtb3Rpdm8sXHJcbiAgICAgICAgZGV0YWxsZV9tb3Rpdm8sXHJcbiAgICAgICAgY2FuY2VsYWRvX3BvcixcclxuICAgICAgICBjYW5jZWxhZG9fcG9yX3RpcG9cclxuICAgICAgKSBWQUxVRVMgKD8sIE5PVygpLCAnbWVkaWNvX3NvbGljaXRhJywgPywgPywgJ21lZGljbycpXHJcbiAgICAgIGAsXHJcbiAgICAgIFtpZENpdGEsIG1vdGl2bywgaWRVc3VhcmlvXVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyA4LiBSZXNwdWVzdGEgZXhpdG9zYVxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBtZXNzYWdlOiBcIkNpdGEgY2FuY2VsYWRhIGV4aXRvc2FtZW50ZVwiLFxyXG4gICAgICB9LFxyXG4gICAgICB7IHN0YXR1czogMjAwIH1cclxuICAgICk7XHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcihcIuKdjCBFcnJvciBlbiBERUxFVEUgL2FwaS9tZWRpY28vYWdlbmRhOlwiLCBlcnJvcik7XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IFwiRXJyb3IgaW50ZXJubyBkZWwgc2Vydmlkb3JcIixcclxuICAgICAgICBkZXRhaWxzOlxyXG4gICAgICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwiZGV2ZWxvcG1lbnRcIiA/IGVycm9yLm1lc3NhZ2UgOiB1bmRlZmluZWQsXHJcbiAgICAgIH0sXHJcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgKTtcclxuICB9XHJcbn0iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwicG9vbCIsIlNFU1NJT05fQ09PS0lFX0NBTkRJREFURVMiLCJnZXRTZXNzaW9uVG9rZW4iLCJyZXF1ZXN0IiwiY29va2llSGVhZGVyIiwiaGVhZGVycyIsImdldCIsImNvb2tpZXMiLCJzcGxpdCIsIm1hcCIsImMiLCJ0cmltIiwiZmlsdGVyIiwiQm9vbGVhbiIsInJlZHVjZSIsImFjYyIsImsiLCJyZXN0Iiwiam9pbiIsIm5hbWUiLCJkZWNvZGVVUklDb21wb25lbnQiLCJhdXRoIiwic3RhcnRzV2l0aCIsInNsaWNlIiwib2J0ZW5lck1lZGljb0F1dGVudGljYWRvIiwiaWRVc3VhcmlvIiwicm93cyIsInF1ZXJ5IiwibGVuZ3RoIiwiZXJyb3IiLCJjb25zb2xlIiwib2J0ZW5lckNpdGFzIiwiaWRNZWRpY28iLCJmZWNoYUluaWNpbyIsImZlY2hhRmluIiwiZXN0YWRvcyIsInRpcG9zIiwicGFjaWVudGUiLCJwYXJhbXMiLCJwdXNoIiwic2VhcmNoVGVybSIsInJvdyIsImlkX2NpdGEiLCJpZF9wYWNpZW50ZSIsImlkX21lZGljbyIsImlkX2NlbnRybyIsImlkX3N1Y3Vyc2FsIiwiZmVjaGFfaG9yYV9pbmljaW8iLCJmZWNoYV9ob3JhX2ZpbiIsImR1cmFjaW9uX21pbnV0b3MiLCJ0aXBvX2NpdGEiLCJtb3Rpdm8iLCJlc3RhZG8iLCJwcmlvcmlkYWQiLCJpZF9lc3BlY2lhbGlkYWQiLCJvcmlnZW4iLCJwYWdhZGEiLCJtb250byIsImlkX3NhbGEiLCJub3RhcyIsIm5vdGFzX3ByaXZhZGFzIiwicmVjb3JkYXRvcmlvX2VudmlhZG8iLCJmZWNoYV9yZWNvcmRhdG9yaW8iLCJjb25maXJtYWNpb25fZW52aWFkYSIsImZlY2hhX2NvbmZpcm1hY2lvbiIsImNvbmZpcm1hZG9fcG9yX3BhY2llbnRlIiwibm9tYnJlX2NvbXBsZXRvIiwicGFjaWVudGVfbm9tYnJlX2NvbXBsZXRvIiwiZWRhZCIsInBhY2llbnRlX2VkYWQiLCJnZW5lcm8iLCJwYWNpZW50ZV9nZW5lcm8iLCJ0ZWxlZm9ubyIsInBhY2llbnRlX3RlbGVmb25vIiwiZW1haWwiLCJwYWNpZW50ZV9lbWFpbCIsImZvdG9fdXJsIiwicGFjaWVudGVfZm90b191cmwiLCJncnVwb19zYW5ndWluZW8iLCJwYWNpZW50ZV9ncnVwb19zYW5ndWluZW8iLCJhbGVyZ2lhc19jcml0aWNhcyIsInBhY2llbnRlX2FsZXJnaWFzX2NyaXRpY2FzIiwic2FsYSIsIm5vbWJyZSIsInNhbGFfbm9tYnJlIiwidGlwbyIsInNhbGFfdGlwbyIsImVzcGVjaWFsaWRhZCIsImVzcGVjaWFsaWRhZF9ub21icmUiLCJvYnRlbmVyQmxvcXVlc0hvcmFyaW9zIiwiaWRfYmxvcXVlIiwiZmVjaGFfaW5pY2lvIiwiZmVjaGFfZmluIiwidGlwb19hdGVuY2lvbiIsImN1cG9fbWF4aW1vIiwiY3Vwb19hY3R1YWwiLCJ2aXNpYmxlX3dlYiIsImNhbGN1bGFyRXN0YWRpc3RpY2FzIiwiZXN0YWRpc3RpY2FzIiwic3RhdHMiLCJkaWFzSGFiaWxlcyIsImNhbGN1bGFyRGlhc0hhYmlsZXMiLCJob3Jhc19kaXNwb25pYmxlcyIsInRhc2FfYXNpc3RlbmNpYSIsInRvdGFsX2NpdGFzIiwiY29tcGxldGFkYXMiLCJ0YXNhX2NvbmZpcm1hY2lvbiIsInRvdGFsX2NvbmZpcm1hZGFzIiwib2N1cGFjaW9uIiwiaG9yYXNfYWdlbmRhZGFzIiwiY29uZmlybWFkYXMiLCJwZW5kaWVudGVzIiwiY2FuY2VsYWRhcyIsIm5vX2FzaXN0aW8iLCJlbl9zYWxhX2VzcGVyYSIsInBhcnNlRmxvYXQiLCJ0b0ZpeGVkIiwiZHVyYWNpb25fcHJvbWVkaW8iLCJ0aWVtcG9fcHJvbWVkaW9fZXNwZXJhIiwiaW5ncmVzb3NfZXN0aW1hZG9zIiwiaW5ncmVzb3NfcmVhbGVzIiwiaW5pY2lvIiwiRGF0ZSIsImZpbiIsImRpYXMiLCJkIiwic2V0RGF0ZSIsImdldERhdGUiLCJkaWFTZW1hbmEiLCJnZXREYXkiLCJ2YWxpZGFyRGlzcG9uaWJpbGlkYWQiLCJpZENpdGFFeGNsdWlyIiwiY29uZmxpY3RvcyIsIkdFVCIsInNlc3Npb25Ub2tlbiIsImpzb24iLCJzdWNjZXNzIiwic3RhdHVzIiwic2VzaW9uZXMiLCJpZF91c3VhcmlvIiwibWVkaWNvIiwic2VhcmNoUGFyYW1zIiwibmV4dFVybCIsInRvSVNPU3RyaW5nIiwiY2l0YXMiLCJibG9xdWVzSG9yYXJpb3MiLCJQcm9taXNlIiwiYWxsIiwiYmxvcXVlc19ob3JhcmlvcyIsImZpbHRyb3MiLCJ0aW1lc3RhbXAiLCJkZXRhaWxzIiwicHJvY2VzcyIsIm1lc3NhZ2UiLCJ1bmRlZmluZWQiLCJQT1NUIiwiYm9keSIsImdldFRpbWUiLCJkaXNwb25pYmxlIiwicmVzdWx0IiwiaWRfY2VudHJvX3ByaW5jaXBhbCIsImNpdGFOdWV2YSIsImluc2VydElkIiwiY2l0YSIsIlBVVCIsImNpdGFBY3R1YWwiLCJkdXJhY2lvbiIsInVwZGF0ZXMiLCJjaXRhQWN0dWFsaXphZGEiLCJERUxFVEUiLCJpZENpdGEiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/medico/agenda/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/db.ts":
/*!***********************!*\
  !*** ./src/lib/db.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   getConnection: () => (/* binding */ getConnection),\n/* harmony export */   getGlobalStats: () => (/* binding */ getGlobalStats),\n/* harmony export */   getUserByEmail: () => (/* binding */ getUserByEmail),\n/* harmony export */   query: () => (/* binding */ query),\n/* harmony export */   verifyUserCredentials: () => (/* binding */ verifyUserCredentials),\n/* harmony export */   withTransaction: () => (/* binding */ withTransaction)\n/* harmony export */ });\n/* harmony import */ var mysql2_promise__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mysql2/promise */ \"(rsc)/./node_modules/mysql2/promise.js\");\n// ===============================================================\n// 📦 Archivo: src/lib/db.ts\n// 🧠 Descripción: Configuración central de conexión a MySQL y utilidades\n// ===============================================================\n\n// ===============================================================\n// 🔗 Conexión al pool MySQL (segura, reutilizable y escalable)\n// ===============================================================\nconst pool = mysql2_promise__WEBPACK_IMPORTED_MODULE_0__.createPool({\n    host: process.env.DB_HOST || \"localhost\",\n    user: process.env.DB_USER || \"root\",\n    password: process.env.DB_PASS || \"\",\n    database: process.env.DB_NAME || \"Anyssamed\",\n    waitForConnections: true,\n    connectionLimit: 10,\n    queueLimit: 0,\n    multipleStatements: false,\n    namedPlaceholders: true\n});\n// ===============================================================\n// 🧩 Función genérica para ejecutar consultas seguras\n// ===============================================================\nasync function query(sql, params = []) {\n    try {\n        const [rows] = await pool.query(sql, params);\n        return rows;\n    } catch (error) {\n        console.error(\"❌ Error en query MySQL:\", error.message);\n        throw new Error(`Error en consulta: ${error.message}`);\n    }\n}\n// ===============================================================\n// 👤 Obtener usuario por email o username (para login o validaciones)\n// ✅ Versión que PRIORIZA el rol MÉDICO y solo toma roles activos\n// ===============================================================\nasync function getUserByEmail(emailOrUsername) {\n    const sql = `\r\n    SELECT \r\n      u.id_usuario,\r\n      u.email,\r\n      u.username,\r\n      u.nombre,\r\n      u.apellido_paterno,\r\n      u.password_hash,\r\n      -- si no hay rol, devolvemos 'Sin Rol'\r\n      COALESCE(r.nombre, 'Sin Rol') AS rol\r\n    FROM usuarios u\r\n    -- solo roles activos del usuario\r\n    LEFT JOIN usuarios_roles ur \r\n      ON u.id_usuario = ur.id_usuario\r\n      AND ur.activo = 1\r\n    -- solo roles activos en la tabla roles\r\n    LEFT JOIN roles r \r\n      ON ur.id_rol = r.id_rol\r\n      AND r.estado = 'activo'\r\n    WHERE (u.email = ? OR u.username = ?)\r\n      AND u.estado = 'activo'\r\n    -- PRIORIDAD de rol:\r\n    -- 1) médico\r\n    -- 2) superadmin\r\n    -- 3) admin/administrativo\r\n    -- 4) secretaria\r\n    -- 5) técnico\r\n    -- 6) lo que quede\r\n    ORDER BY\r\n      CASE\r\n        WHEN LOWER(r.nombre) LIKE '%medico%' THEN 1\r\n        WHEN LOWER(r.nombre) LIKE '%super%' THEN 2\r\n        WHEN LOWER(r.nombre) LIKE '%admin%' THEN 3\r\n        WHEN LOWER(r.nombre) LIKE '%secret%' THEN 4\r\n        WHEN LOWER(r.nombre) LIKE '%tecnic%' THEN 5\r\n        ELSE 99\r\n      END,\r\n      r.nivel_jerarquia DESC\r\n    LIMIT 1\r\n  `;\n    const [rows] = await pool.query(sql, [\n        emailOrUsername,\n        emailOrUsername\n    ]);\n    return Array.isArray(rows) && rows.length > 0 ? rows[0] : null;\n}\n// ===============================================================\n// 🔒 Verificar credenciales del usuario\n// ===============================================================\nasync function verifyUserCredentials(emailOrUsername, passwordHash) {\n    const user = await getUserByEmail(emailOrUsername);\n    if (!user) return null;\n    if (user.password_hash !== passwordHash) return null;\n    return user;\n}\n// ===============================================================\n// 📊 Ejemplo de utilidad: obtener estadísticas globales\n// ===============================================================\nasync function getGlobalStats() {\n    const [[stats]] = await pool.query(`\r\n    SELECT \r\n      (SELECT COUNT(*) FROM usuarios) AS total_usuarios,\r\n      (SELECT COUNT(*) FROM pacientes) AS total_pacientes,\r\n      (SELECT COUNT(*) FROM medicos) AS total_medicos,\r\n      (SELECT COUNT(*) FROM centros_medicos) AS total_centros\r\n  `);\n    return stats;\n}\n// ===============================================================\n// 🔌 NUEVO: obtener una conexión dedicada (para transacciones)\n// ===============================================================\nasync function getConnection() {\n    const conn = await pool.getConnection();\n    try {\n        await conn.ping(); // valida la conexión\n    } catch (e) {\n        conn.release();\n        throw e;\n    }\n    return conn;\n}\n// ===============================================================\n// 🔁 NUEVO (opcional): helper para ejecutar en transacción\n// ===============================================================\nasync function withTransaction(fn) {\n    const conn = await getConnection();\n    try {\n        await conn.beginTransaction();\n        const result = await fn(conn);\n        await conn.commit();\n        return result;\n    } catch (err) {\n        try {\n            await conn.rollback();\n        } catch  {}\n        throw err;\n    } finally{\n        try {\n            conn.release();\n        } catch  {}\n    }\n}\n// ===============================================================\n// 🔁 Exportar conexión global\n// ===============================================================\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (pool);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VSxRQUFRO1FBQUksRUFBRSxPQUFNLENBQUM7UUFDdEMsTUFBTUQ7SUFDUixTQUFVO1FBQ1IsSUFBSTtZQUFFVCxLQUFLRyxPQUFPO1FBQUksRUFBRSxPQUFNLENBQUM7SUFDakM7QUFDRjtBQUVBLGtFQUFrRTtBQUNsRSw4QkFBOEI7QUFDOUIsa0VBQWtFO0FBQ2xFLGlFQUFldkMsSUFBSUEsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL21lZGlzdWl0ZS1wcm8vLi9zcmMvbGliL2RiLnRzPzllNGYiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIPCfk6YgQXJjaGl2bzogc3JjL2xpYi9kYi50c1xyXG4vLyDwn6egIERlc2NyaXBjacOzbjogQ29uZmlndXJhY2nDs24gY2VudHJhbCBkZSBjb25leGnDs24gYSBNeVNRTCB5IHV0aWxpZGFkZXNcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5pbXBvcnQgbXlzcWwgZnJvbSBcIm15c3FsMi9wcm9taXNlXCI7XHJcbmltcG9ydCB0eXBlIHsgUG9vbENvbm5lY3Rpb24gfSBmcm9tIFwibXlzcWwyL3Byb21pc2VcIjsgLy8g4oaQIChzb2xvIHRpcG8pXHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8g8J+UlyBDb25leGnDs24gYWwgcG9vbCBNeVNRTCAoc2VndXJhLCByZXV0aWxpemFibGUgeSBlc2NhbGFibGUpXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5jb25zdCBwb29sID0gbXlzcWwuY3JlYXRlUG9vbCh7XHJcbiAgaG9zdDogcHJvY2Vzcy5lbnYuREJfSE9TVCB8fCBcImxvY2FsaG9zdFwiLFxyXG4gIHVzZXI6IHByb2Nlc3MuZW52LkRCX1VTRVIgfHwgXCJyb290XCIsXHJcbiAgcGFzc3dvcmQ6IHByb2Nlc3MuZW52LkRCX1BBU1MgfHwgXCJcIixcclxuICBkYXRhYmFzZTogcHJvY2Vzcy5lbnYuREJfTkFNRSB8fCBcIkFueXNzYW1lZFwiLFxyXG4gIHdhaXRGb3JDb25uZWN0aW9uczogdHJ1ZSxcclxuICBjb25uZWN0aW9uTGltaXQ6IDEwLFxyXG4gIHF1ZXVlTGltaXQ6IDAsXHJcbiAgbXVsdGlwbGVTdGF0ZW1lbnRzOiBmYWxzZSxcclxuICBuYW1lZFBsYWNlaG9sZGVyczogdHJ1ZSxcclxufSk7XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8g8J+nqSBGdW5jacOzbiBnZW7DqXJpY2EgcGFyYSBlamVjdXRhciBjb25zdWx0YXMgc2VndXJhc1xyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHF1ZXJ5KHNxbDogc3RyaW5nLCBwYXJhbXM6IGFueVtdID0gW10pIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgW3Jvd3NdID0gYXdhaXQgcG9vbC5xdWVyeShzcWwsIHBhcmFtcyk7XHJcbiAgICByZXR1cm4gcm93cztcclxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwi4p2MIEVycm9yIGVuIHF1ZXJ5IE15U1FMOlwiLCBlcnJvci5tZXNzYWdlKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3IgZW4gY29uc3VsdGE6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICB9XHJcbn1cclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyDwn5GkIE9idGVuZXIgdXN1YXJpbyBwb3IgZW1haWwgbyB1c2VybmFtZSAocGFyYSBsb2dpbiBvIHZhbGlkYWNpb25lcylcclxuLy8g4pyFIFZlcnNpw7NuIHF1ZSBQUklPUklaQSBlbCByb2wgTcOJRElDTyB5IHNvbG8gdG9tYSByb2xlcyBhY3Rpdm9zXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VXNlckJ5RW1haWwoZW1haWxPclVzZXJuYW1lOiBzdHJpbmcpIHtcclxuICBjb25zdCBzcWwgPSBgXHJcbiAgICBTRUxFQ1QgXHJcbiAgICAgIHUuaWRfdXN1YXJpbyxcclxuICAgICAgdS5lbWFpbCxcclxuICAgICAgdS51c2VybmFtZSxcclxuICAgICAgdS5ub21icmUsXHJcbiAgICAgIHUuYXBlbGxpZG9fcGF0ZXJubyxcclxuICAgICAgdS5wYXNzd29yZF9oYXNoLFxyXG4gICAgICAtLSBzaSBubyBoYXkgcm9sLCBkZXZvbHZlbW9zICdTaW4gUm9sJ1xyXG4gICAgICBDT0FMRVNDRShyLm5vbWJyZSwgJ1NpbiBSb2wnKSBBUyByb2xcclxuICAgIEZST00gdXN1YXJpb3MgdVxyXG4gICAgLS0gc29sbyByb2xlcyBhY3Rpdm9zIGRlbCB1c3VhcmlvXHJcbiAgICBMRUZUIEpPSU4gdXN1YXJpb3Nfcm9sZXMgdXIgXHJcbiAgICAgIE9OIHUuaWRfdXN1YXJpbyA9IHVyLmlkX3VzdWFyaW9cclxuICAgICAgQU5EIHVyLmFjdGl2byA9IDFcclxuICAgIC0tIHNvbG8gcm9sZXMgYWN0aXZvcyBlbiBsYSB0YWJsYSByb2xlc1xyXG4gICAgTEVGVCBKT0lOIHJvbGVzIHIgXHJcbiAgICAgIE9OIHVyLmlkX3JvbCA9IHIuaWRfcm9sXHJcbiAgICAgIEFORCByLmVzdGFkbyA9ICdhY3Rpdm8nXHJcbiAgICBXSEVSRSAodS5lbWFpbCA9ID8gT1IgdS51c2VybmFtZSA9ID8pXHJcbiAgICAgIEFORCB1LmVzdGFkbyA9ICdhY3Rpdm8nXHJcbiAgICAtLSBQUklPUklEQUQgZGUgcm9sOlxyXG4gICAgLS0gMSkgbcOpZGljb1xyXG4gICAgLS0gMikgc3VwZXJhZG1pblxyXG4gICAgLS0gMykgYWRtaW4vYWRtaW5pc3RyYXRpdm9cclxuICAgIC0tIDQpIHNlY3JldGFyaWFcclxuICAgIC0tIDUpIHTDqWNuaWNvXHJcbiAgICAtLSA2KSBsbyBxdWUgcXVlZGVcclxuICAgIE9SREVSIEJZXHJcbiAgICAgIENBU0VcclxuICAgICAgICBXSEVOIExPV0VSKHIubm9tYnJlKSBMSUtFICclbWVkaWNvJScgVEhFTiAxXHJcbiAgICAgICAgV0hFTiBMT1dFUihyLm5vbWJyZSkgTElLRSAnJXN1cGVyJScgVEhFTiAyXHJcbiAgICAgICAgV0hFTiBMT1dFUihyLm5vbWJyZSkgTElLRSAnJWFkbWluJScgVEhFTiAzXHJcbiAgICAgICAgV0hFTiBMT1dFUihyLm5vbWJyZSkgTElLRSAnJXNlY3JldCUnIFRIRU4gNFxyXG4gICAgICAgIFdIRU4gTE9XRVIoci5ub21icmUpIExJS0UgJyV0ZWNuaWMlJyBUSEVOIDVcclxuICAgICAgICBFTFNFIDk5XHJcbiAgICAgIEVORCxcclxuICAgICAgci5uaXZlbF9qZXJhcnF1aWEgREVTQ1xyXG4gICAgTElNSVQgMVxyXG4gIGA7XHJcbiAgY29uc3QgW3Jvd3NdOiBhbnkgPSBhd2FpdCBwb29sLnF1ZXJ5KHNxbCwgW2VtYWlsT3JVc2VybmFtZSwgZW1haWxPclVzZXJuYW1lXSk7XHJcbiAgcmV0dXJuIEFycmF5LmlzQXJyYXkocm93cykgJiYgcm93cy5sZW5ndGggPiAwID8gcm93c1swXSA6IG51bGw7XHJcbn1cclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyDwn5SSIFZlcmlmaWNhciBjcmVkZW5jaWFsZXMgZGVsIHVzdWFyaW9cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlVc2VyQ3JlZGVudGlhbHMoZW1haWxPclVzZXJuYW1lOiBzdHJpbmcsIHBhc3N3b3JkSGFzaDogc3RyaW5nKSB7XHJcbiAgY29uc3QgdXNlciA9IGF3YWl0IGdldFVzZXJCeUVtYWlsKGVtYWlsT3JVc2VybmFtZSk7XHJcbiAgaWYgKCF1c2VyKSByZXR1cm4gbnVsbDtcclxuICBpZiAodXNlci5wYXNzd29yZF9oYXNoICE9PSBwYXNzd29yZEhhc2gpIHJldHVybiBudWxsO1xyXG4gIHJldHVybiB1c2VyO1xyXG59XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8g8J+TiiBFamVtcGxvIGRlIHV0aWxpZGFkOiBvYnRlbmVyIGVzdGFkw61zdGljYXMgZ2xvYmFsZXNcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRHbG9iYWxTdGF0cygpIHtcclxuICBjb25zdCBbW3N0YXRzXV06IGFueSA9IGF3YWl0IHBvb2wucXVlcnkoYFxyXG4gICAgU0VMRUNUIFxyXG4gICAgICAoU0VMRUNUIENPVU5UKCopIEZST00gdXN1YXJpb3MpIEFTIHRvdGFsX3VzdWFyaW9zLFxyXG4gICAgICAoU0VMRUNUIENPVU5UKCopIEZST00gcGFjaWVudGVzKSBBUyB0b3RhbF9wYWNpZW50ZXMsXHJcbiAgICAgIChTRUxFQ1QgQ09VTlQoKikgRlJPTSBtZWRpY29zKSBBUyB0b3RhbF9tZWRpY29zLFxyXG4gICAgICAoU0VMRUNUIENPVU5UKCopIEZST00gY2VudHJvc19tZWRpY29zKSBBUyB0b3RhbF9jZW50cm9zXHJcbiAgYCk7XHJcbiAgcmV0dXJuIHN0YXRzO1xyXG59XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8g8J+UjCBOVUVWTzogb2J0ZW5lciB1bmEgY29uZXhpw7NuIGRlZGljYWRhIChwYXJhIHRyYW5zYWNjaW9uZXMpXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29ubmVjdGlvbigpOiBQcm9taXNlPFBvb2xDb25uZWN0aW9uPiB7XHJcbiAgY29uc3QgY29ubiA9IGF3YWl0IHBvb2wuZ2V0Q29ubmVjdGlvbigpO1xyXG4gIHRyeSB7XHJcbiAgICBhd2FpdCBjb25uLnBpbmcoKTsgLy8gdmFsaWRhIGxhIGNvbmV4acOzblxyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIGNvbm4ucmVsZWFzZSgpO1xyXG4gICAgdGhyb3cgZTtcclxuICB9XHJcbiAgcmV0dXJuIGNvbm47XHJcbn1cclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyDwn5SBIE5VRVZPIChvcGNpb25hbCk6IGhlbHBlciBwYXJhIGVqZWN1dGFyIGVuIHRyYW5zYWNjacOzblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHdpdGhUcmFuc2FjdGlvbjxUPihcclxuICBmbjogKGNvbm46IFBvb2xDb25uZWN0aW9uKSA9PiBQcm9taXNlPFQ+XHJcbik6IFByb21pc2U8VD4ge1xyXG4gIGNvbnN0IGNvbm4gPSBhd2FpdCBnZXRDb25uZWN0aW9uKCk7XHJcbiAgdHJ5IHtcclxuICAgIGF3YWl0IGNvbm4uYmVnaW5UcmFuc2FjdGlvbigpO1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZm4oY29ubik7XHJcbiAgICBhd2FpdCBjb25uLmNvbW1pdCgpO1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9IGNhdGNoIChlcnIpIHtcclxuICAgIHRyeSB7IGF3YWl0IGNvbm4ucm9sbGJhY2soKTsgfSBjYXRjaCB7fVxyXG4gICAgdGhyb3cgZXJyO1xyXG4gIH0gZmluYWxseSB7XHJcbiAgICB0cnkgeyBjb25uLnJlbGVhc2UoKTsgfSBjYXRjaCB7fVxyXG4gIH1cclxufVxyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIPCflIEgRXhwb3J0YXIgY29uZXhpw7NuIGdsb2JhbFxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuZXhwb3J0IGRlZmF1bHQgcG9vbDtcclxuXHJcbi8vIChvcGNpb25hbCkgcmUtZXhwb3J0IGRlbCB0aXBvIHBhcmEgdXNhcmxvIGVuIHJ1dGFzIHNpIHF1aWVyZXMgdGlwYXIgcGFyw6FtZXRyb3NcclxuZXhwb3J0IHR5cGUgeyBQb29sQ29ubmVjdGlvbiB9O1xyXG4iXSwibmFtZXMiOlsibXlzcWwiLCJwb29sIiwiY3JlYXRlUG9vbCIsImhvc3QiLCJwcm9jZXNzIiwiZW52IiwiREJfSE9TVCIsInVzZXIiLCJEQl9VU0VSIiwicGFzc3dvcmQiLCJEQl9QQVNTIiwiZGF0YWJhc2UiLCJEQl9OQU1FIiwid2FpdEZvckNvbm5lY3Rpb25zIiwiY29ubmVjdGlvbkxpbWl0IiwicXVldWVMaW1pdCIsIm11bHRpcGxlU3RhdGVtZW50cyIsIm5hbWVkUGxhY2Vob2xkZXJzIiwicXVlcnkiLCJzcWwiLCJwYXJhbXMiLCJyb3dzIiwiZXJyb3IiLCJjb25zb2xlIiwibWVzc2FnZSIsIkVycm9yIiwiZ2V0VXNlckJ5RW1haWwiLCJlbWFpbE9yVXNlcm5hbWUiLCJBcnJheSIsImlzQXJyYXkiLCJsZW5ndGgiLCJ2ZXJpZnlVc2VyQ3JlZGVudGlhbHMiLCJwYXNzd29yZEhhc2giLCJwYXNzd29yZF9oYXNoIiwiZ2V0R2xvYmFsU3RhdHMiLCJzdGF0cyIsImdldENvbm5lY3Rpb24iLCJjb25uIiwicGluZyIsImUiLCJyZWxlYXNlIiwid2l0aFRyYW5zYWN0aW9uIiwiZm4iLCJiZWdpblRyYW5zYWN0aW9uIiwicmVzdWx0IiwiY29tbWl0IiwiZXJyIiwicm9sbGJhY2siXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/db.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/mysql2","vendor-chunks/iconv-lite","vendor-chunks/aws-ssl-profiles","vendor-chunks/long","vendor-chunks/named-placeholders","vendor-chunks/denque","vendor-chunks/is-property","vendor-chunks/lru.min","vendor-chunks/sqlstring","vendor-chunks/seq-queue","vendor-chunks/generate-function","vendor-chunks/safer-buffer"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fmedico%2Fagenda%2Froute&page=%2Fapi%2Fmedico%2Fagenda%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmedico%2Fagenda%2Froute.ts&appDir=C%3A%5CReactProjects%5Cmedisuite-pro%5Cfrontend%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CReactProjects%5Cmedisuite-pro%5Cfrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();